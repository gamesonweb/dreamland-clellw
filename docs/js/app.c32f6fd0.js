(function(){"use strict";var e={47340:function(e,t,i){var n=i(53751),a=i(20641);function s(e,t,i,n,s,r){var o=(0,a.g2)("NemasuProject");return(0,a.uX)(),(0,a.Wv)(o)}function r(e,t,i,n,s,r){return(0,a.uX)(),(0,a.CE)("div",null,t[0]||(t[0]=[(0,a.Lk)("canvas",null,null,-1)]))}var o=i(31635),c=i(89511),l=(i(57496),i(4037)),h=i(79501),u=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Sumireko",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageFiveScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"CreateStageFiveScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t);var n=c.PeD.CreateGround("ground");n.scaling=new c.Pq0(50,50,50),n.checkCollisions=!0;var a=new h.Z("texture",256,t),s=new c.FUi("mat",t);s.diffuseTexture=a,n.material=s,a.speed=new c.I9Y(.1,.1),a.fireColors=[new c.v9j(0,0,1),new c.v9j(0,1,1),new c.v9j(0,1,0),new c.v9j(0,1,1),new c.v9j(1,0,0),new c.v9j(1,1,0)],this.CreateStageFiveReimu(),this.CreateStageFiveMap();var r=document.createElement("div"),o=document.createTextNode("The End");return r.appendChild(o),r.style.position="absolute",r.style.top="60%",r.style.left="50%",r.style.transform="translate(-50%, -0%)",r.style.margin="auto",r.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",r.style.fontSize="20px",r.style.width="500px",r.style.height="150px",r.style.borderRadius="20px",r.style.textAlign="center",r.style.alignContent="center",r.style.borderColor="magenta",r.style.borderStyle="ridge ",r.style.fontFamily="Bahnschrift",document.body.appendChild(r),t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(5,1,0),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(-Math.PI/25,3*Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateStageFiveMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","sumireko.glb")];case 1:return e=i.sent(),this.Sumireko=e.meshes[0],this.Sumireko.scaling.setAll(.4),this.Sumireko.position=new c.Pq0(13,0,-3),this.Sumireko.rotate(c.Pq0.Up(),-3*Math.PI/4),[4,(0,c.KcJ)("music","audio/09.UndellaTown(Autumn-Winter-Spring).mp3",{volume:.25})];case 2:return t=i.sent(),t.play(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateStageFiveReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(12,0,-5),this.Reimu.rotate(c.Pq0.Up(),-3*Math.PI/4),this.Reimu.position._z-=.5,this.Reimu.scaling.setAll(.4),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),e}(),m=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shooting",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageFiveScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateStageFiveScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.engine.stopRenderLoop();var e=new c.Z58(this.engine),t=new c.g4z("hemiLight",new c.Pq0(0,1,0),e);t.intensity=1,this.CreateCamera(e),this.camera.position=new c.Pq0(10,10,0);var i=c.PeD.CreateGround("ground");i.scaling=new c.Pq0(50,50,50),i.checkCollisions=!0;var n=new h.Z("texture",256,e),a=new c.FUi("mat",e);a.diffuseTexture=n,i.material=a,n.speed=new c.I9Y(.1,.1),n.fireColors=[new c.v9j(0,0,1),new c.v9j(0,1,1),new c.v9j(0,1,0),new c.v9j(0,1,1),new c.v9j(1,0,0),new c.v9j(1,1,0)];var s=c.PeD.CreateBox("wall",{size:60});s.position=new c.Pq0(0,10,-55),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:60});r.position=new c.Pq0(0,10,55),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:60});o.position=new c.Pq0(-55,10,0),o.checkCollisions=!0,o.visibility=0;var l=c.PeD.CreateBox("wall",{size:60});l.position=new c.Pq0(55,10,0),l.checkCollisions=!0,l.visibility=0;var u=c.PeD.CreateBox("wall",{size:60});return u.position=new c.Pq0(0,60,0),u.checkCollisions=!0,u.visibility=0,this.CreateStageFiveReimu(),this.CreateStageFiveMap(),e}}),Object.defineProperty(e.prototype,"CreateStageFiveMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){function e(e){h.width="".concat(e/100*240,"px")}var t,i,n,a,s,r,h,u=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","sumireko.glb")];case 1:return t=o.sent(),t.meshes[0].scaling.setAll(.5),t.meshes[0].position=new c.Pq0(-10,7,0),t.meshes[0].rotate(c.Pq0.Up(),3.1),i=55,[4,(0,c.KcJ)("music","audio/14.LastOccultism~EsotericistofthePresentWorld.mp3",{volume:.25})];case 2:return n=o.sent(),n.play(),[4,c.cng.ImportMeshAsync("","./models/","needles.glb")];case 3:return a=o.sent(),s=l.vs.CreateFullscreenUI("UI"),r=new l.tN,r.width="250px",r.height="20px",r.color="white",r.thickness=2,r.background="black",r.verticalAlignment=l.Ec.VERTICAL_ALIGNMENT_TOP,s.addControl(r),h=new l.tN,h.width="240px",h.height="14px",h.horizontalAlignment=l.Ec.HORIZONTAL_ALIGNMENT_LEFT,h.background="purple",r.addControl(h),this.scene.onPointerDown=function(e){if(0===e.button&&0==u.shooting){u.engine.enterPointerlock();var t=u.Reimu.position._x,i=u.Reimu.position._y,n=u.Reimu.position._z;a.meshes[0].position._x=t,a.meshes[0].position._y=i,a.meshes[0].position._z=n}1===e.button&&u.engine.exitPointerlock()},a.meshes[0].scaling.setAll(1),a.meshes[0].position=new c.Pq0(30,200,-20),setTimeout((function(){u.scene.onBeforeRenderObservable.add((function(){if(a.meshes[0].moveWithCollisions(a.meshes[0].right.scaleInPlace(.7)),a.meshes[2].intersectsMesh(t.meshes[2])&&(a.meshes[0].position=new c.Pq0(30,200,-20),i-=1,e(100*i/55)),a.meshes[0].position._x<=-14&&(a.meshes[0].position=new c.Pq0(30,200,-20)),0==i){i--,t.meshes[0].visibility=0;var s=document.createElement("div"),r=document.createTextNode("Boss Defeated");s.appendChild(r),s.style.position="absolute",s.style.top="60%",s.style.left="50%",s.style.transform="translate(-50%, -0%)",s.style.margin="auto",s.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",s.style.fontSize="20px",s.style.width="500px",s.style.height="150px",s.style.borderRadius="20px",s.style.textAlign="center",s.style.alignContent="center",s.style.borderColor="red",s.style.borderStyle="ridge",s.style.fontFamily="Lucida Console",document.body.appendChild(s),setTimeout((function(){document.body.removeChild(s),n.stop(),u.switchToEndingScene()}),3e3)}}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateStageFiveReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v,C,q,M,A,I,x,R,T,S,O,k,N,_,D,z,j,L,K,E,B,U,H,F,Y,X,W,G,Z,V,$,J,Q,ee,te,ie,ne=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(12,3,0),this.Reimu.position._z-=.5,this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.shooting=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f-=2,ne.shooting=f>=10?1:0,ne.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),ne.Reimu.moveWithCollisions(ne.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),ne.Reimu.moveWithCollisions(ne.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),ne.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),ne.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),ne.Reimu.moveWithCollisions(ne.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),ne.Reimu.moveWithCollisions(ne.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),v=new c.FUi("mat"),v.diffuseColor=new c.v9j(1,0,0),C=new c.FUi("mat"),C.diffuseColor=new c.v9j(0,0,1),q=new c.FUi("mat"),q.diffuseColor=new c.v9j(1,0,1),M=c.PeD.CreateSphere("bull"),M.position=new c.Pq0(-10,8,3),M.material=v,A=c.PeD.CreateSphere("bull"),A.position=new c.Pq0(-10,8,-3),A.position._z-=.5,A.material=C,I=c.PeD.CreateSphere("bull"),I.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),I.material=q,x=c.PeD.CreateSphere("bull"),x.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),x.material=q,R=c.PeD.CreateSphere("bull"),R.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),R.material=q,T=c.PeD.CreateSphere("bull"),T.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),T.material=q,S=c.PeD.CreateSphere("bull"),S.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),S.material=q,O=c.PeD.CreateSphere("bull"),O.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),O.material=q,k=c.PeD.CreateSphere("bull"),k.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),k.material=q,N=c.PeD.CreateSphere("bull"),N.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),N.material=q,_=c.PeD.CreateSphere("bull"),_.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),_.material=q,D=c.PeD.CreateSphere("bull"),D.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),D.material=q,z=c.PeD.CreateSphere("bull"),z.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),z.material=q,j=this.Reimu.position.subtract(M.position).normalize(),L=this.Reimu.position.subtract(A.position).normalize(),K=.05,E=5e-4,B=.05,U=.08,H=c.PeD.CreateSphere("boss"),H.position=new c.Pq0(-10,8,0),H.position._z-=.5,H.visibility=0,F=.01,Y=H.position.subtract(this.Reimu.position).normalize(),X=H.position.subtract(I.position).normalize(),W=H.position.subtract(x.position).normalize(),G=H.position.subtract(R.position).normalize(),Z=H.position.subtract(T.position).normalize(),V=H.position.subtract(S.position).normalize(),$=H.position.subtract(O.position).normalize(),J=H.position.subtract(k.position).normalize(),Q=H.position.subtract(N.position).normalize(),ee=H.position.subtract(_.position).normalize(),te=H.position.subtract(D.position).normalize(),ie=H.position.subtract(z.position).normalize(),setTimeout((function(){ne.scene.onBeforeRenderObservable.add((function(){Y=H.position.subtract(ne.Reimu.position).normalize(),j=ne.Reimu.position.subtract(M.position).normalize(),L=ne.Reimu.position.subtract(A.position).normalize(),Math.abs(K)>=.1&&(E*=-1),K+=E,0==f&&(M.position.addInPlace(j.scale(Math.abs(K))),A.position.addInPlace(L.scale(B))),I.intersectsMesh(H)&&(I.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),X=H.position.subtract(I.position).normalize()),x.intersectsMesh(H)&&(x.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),W=H.position.subtract(x.position).normalize()),R.intersectsMesh(H)&&(R.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),G=H.position.subtract(R.position).normalize()),T.intersectsMesh(H)&&(T.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),Z=H.position.subtract(T.position).normalize()),S.intersectsMesh(H)&&(S.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),V=H.position.subtract(S.position).normalize()),O.intersectsMesh(H)&&(O.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),$=H.position.subtract(O.position).normalize()),k.intersectsMesh(H)&&(k.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),J=H.position.subtract(k.position).normalize()),N.intersectsMesh(H)&&(N.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),Q=H.position.subtract(N.position).normalize()),_.intersectsMesh(H)&&(_.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),ee=H.position.subtract(_.position).normalize()),D.intersectsMesh(H)&&(D.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),te=H.position.subtract(D.position).normalize()),z.intersectsMesh(H)&&(z.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),ie=H.position.subtract(z.position).normalize()),I.position.addInPlace(X.scale(U*c.Pq0.Distance(I.position,H.position))),x.position.addInPlace(W.scale(.7*U*c.Pq0.Distance(x.position,H.position))),R.position.addInPlace(G.scale(.3*U*c.Pq0.Distance(R.position,H.position))),T.position.addInPlace(Z.scale(U)),S.position.addInPlace(V.scale(U)),O.position.addInPlace($.scale(U)),k.position.addInPlace(J.scale(U)),N.position.addInPlace(Q.scale(U)),_.position.addInPlace(ee.scale(U)),D.position.addInPlace(te.scale(U)),z.position.addInPlace(ie.scale(U)),ne.Reimu.position.addInPlace(Y.scale(F)),(t[2].intersectsMesh(M)||t[2].intersectsMesh(A))&&0==f&&(f=256,M.position=new c.Pq0(-10,8,3),A.position=new c.Pq0(-10,8,-3)),t[2].intersectsMesh(I)&&0==f&&(f=256,I.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),X=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(x)&&0==f&&(f=256,x.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),W=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(R)&&0==f&&(f=256,R.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),G=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(T)&&0==f&&(f=256,T.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),Z=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(S)&&0==f&&(f=256,S.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),V=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(O)&&0==f&&(f=256,O.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),$=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(k)&&0==f&&(f=256,k.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),J=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(N)&&0==f&&(f=256,N.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),Q=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(_)&&0==f&&(f=256,_.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),ee=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(D)&&0==f&&(f=256,D.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),te=H.position.subtract(I.position).normalize()),t[2].intersectsMesh(z)&&0==f&&(f=256,z.position=new c.Pq0(100*Math.random()/3,100*Math.random()/3,100*Math.random()/3-16),ie=H.position.subtract(I.position).normalize())}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",0,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"switchToEndingScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new u(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),p=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Sumireko",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageFiveScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"CreateStageFiveScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t);var n=c.PeD.CreateGround("ground");n.scaling=new c.Pq0(50,50,50),n.checkCollisions=!0;var a=new h.Z("texture",256,t),s=new c.FUi("mat",t);s.diffuseTexture=a,n.material=s,a.speed=new c.I9Y(.1,.1),a.fireColors=[new c.v9j(0,0,1),new c.v9j(0,1,1),new c.v9j(0,1,0),new c.v9j(0,1,1),new c.v9j(1,0,0),new c.v9j(1,1,0)];var r=c.PeD.CreateBox("wall",{size:60});r.position=new c.Pq0(0,10,-55),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:60});o.position=new c.Pq0(0,10,55),o.checkCollisions=!0,o.visibility=0;var l=c.PeD.CreateBox("wall",{size:60});l.position=new c.Pq0(-55,10,0),l.checkCollisions=!0,l.visibility=0;var u=c.PeD.CreateBox("wall",{size:60});u.position=new c.Pq0(55,10,0),u.checkCollisions=!0,u.visibility=0;var m=c.PeD.CreateBox("wall",{size:60});return m.position=new c.Pq0(0,60,0),m.checkCollisions=!0,m.visibility=0,this.CreateStageFiveReimu(),this.CreateStageFiveMap(),t}}),Object.defineProperty(e.prototype,"CreateStageFiveMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e;return(0,o.YH)(this,(function(t){switch(t.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","sumireko.glb")];case 1:return e=t.sent(),this.Sumireko=e.meshes[0],this.Sumireko.scaling.setAll(.4),this.Sumireko.position=new c.Pq0(3,0,0),this.Sumireko.rotate(c.Pq0.Up(),3.1),this.Sumireko.rotate(c.Pq0.Up(),-Math.PI/2),this.Sumireko.rotate(c.Pq0.Forward(),Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateStageFiveReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(12,0,0),this.Reimu.position._z-=.5,this.Reimu.scaling.setAll(.4),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(5,1,0),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(0,Math.PI/2,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: To think I'm currently inside of Sumireko's dream..."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_casual.png",n.appendChild(a),a.style.height="190px",n.style.top="55%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge ",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/13.SheerMountainRange.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0,value:new c.Pq0(5,1,0)}),s.push({frame:5*e,value:new c.Pq0(5,1,0)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: That might be more impressive than the four previous times."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: And for once, the sky isn't messed up. That's neat."),t.appendChild(i),a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [The place you're in is very unstable Reimu, and things aren't getting better outside!]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [You have to find Sumireko before things start getting out of control!]"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Well finding her isn't the problem. It was always pretty easy."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [Then what's the problem?]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Well..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s.push({frame:0*e,value:new c.Pq0(5,1,0)}),s.push({frame:4*e,value:new c.Pq0(2,1,5)}),s.push({frame:5*e,value:new c.Pq0(2,1,5)}),l.push({frame:0,value:new c.Pq0(0,Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: zzZZZZZzz"),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(2,1,5)}),s.push({frame:5*e,value:new c.Pq0(2,1,5)}),l.push({frame:0*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: She is currently DREAMING "),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 11:return o.sent(),a.style.height="210px",t.removeChild(i),i=document.createTextNode("Reimu: INSIDE "),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 12:return o.sent(),a.style.height="250px",t.removeChild(i),i=document.createTextNode("Reimu: HER DREAM'S DREAM'S DREAM!!"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 13:return o.sent(),a.style.height="190px",t.removeChild(i),i=document.createTextNode("Reimu: How is that possible?"),t.appendChild(i),a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [Oh! You see, it's actually very plausible! If you consider a dream like a-]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I DON'T WANNA KNOW THAT!!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",a.style.height="250px",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 16:return o.sent(),a.style.height="190px",t.removeChild(i),i=document.createTextNode("Reimu: HOW do I wake her up?"),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(2,1,5)}),s.push({frame:2*e,value:new c.Pq0(9,1,2)}),s.push({frame:5*e,value:new c.Pq0(9,1,2)}),l.push({frame:0*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [W-Well, you could enter her dream's dream's dream's dream.]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(9,1,2)}),s.push({frame:5*e,value:new c.Pq0(9,1,2)}),l.push({frame:0*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Can't you have brighter ideas?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 19:return o.sent(),this.Sumireko.rotate(c.Pq0.Forward(),-Math.PI/2),this.Sumireko.rotate(c.Pq0.Up(),Math.PI/2),t.removeChild(i),i=document.createTextNode("Sumireko: Why are you screaming like that, Reimers?"),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 20:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: You sure took your time, sleepy head!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(13,1,2)}),s.push({frame:4*e,value:new c.Pq0(13,1,2)}),l.push({frame:0*e,value:new c.Pq0(0,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(0,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Do you realise the mess you created out there?"),t.appendChild(i),a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 22:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: Yes, I am aware of what I'm accountable for."),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 23:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: I was conscious about everything that was happening. It was not a great feelling."),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(13,1,2)}),s.push({frame:2*e,value:new c.Pq0(7,1,1)}),s.push({frame:5*e,value:new c.Pq0(7,1,1)}),l.push({frame:0*e,value:new c.Pq0(0,5*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(0,5.5*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,5.5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 24:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: It started when Okins asked me to help her with a task."),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(7,1,1)}),s.push({frame:5*e,value:new c.Pq0(7,1,1)}),l.push({frame:0*e,value:new c.Pq0(0,5.5*Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,5.5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 25:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Okins? You mean the Secret God?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 26:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: Yep."),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_casual.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 27:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I should have gotten rid of her when I had the chance."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 28:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: She gave me weird powers, and I started feeling sleepy."),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 29:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: Next thing you know, I started dreaming INSIDE my dream, and that started everything."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 30:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: That must be one of her stupid tests again, she's so annoying."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 31:return o.sent(),this.Reimu.position=new c.Pq0(12,3,0),t.removeChild(i),i=document.createTextNode("Reimu: Well, you don't have to worry. I'm gonna get us all out of here!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 32:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: Does that imply...?"),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 33:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Yep! Beating you up!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(7,1,1)}),s.push({frame:1*e,value:new c.Pq0(8,4,4)}),s.push({frame:4*e,value:new c.Pq0(8,4,4)}),l.push({frame:0*e,value:new c.Pq0(0,5.5*Math.PI/4,0)}),l.push({frame:1*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 34:return o.sent(),this.Sumireko.position=new c.Pq0(-10,7,0),t.removeChild(i),i=document.createTextNode("Sumireko: I should not expect less from you, Reimers."),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(8,4,4)}),s.push({frame:4*e,value:new c.Pq0(8,4,4)}),l.push({frame:0*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(0,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 35:return o.sent(),t.removeChild(i),i=document.createTextNode("Sumireko: At least, that means I get to fight you! I will not back down!"),t.appendChild(i),t.style.borderColor="brown",a.src="portraits/Sumireko_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(8,4,4)}),s.push({frame:3*e,value:new c.Pq0(19,4,0)}),s.push({frame:6*e,value:new c.Pq0(19,4,0)}),l.push({frame:0*e,value:new c.Pq0(0,3*Math.PI/4,0)}),l.push({frame:3*e,value:new c.Pq0(0,3*Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(0,3*Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 36:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFifthStageScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"switchToFifthStageScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new m(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),d=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return n.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=n.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(9,0,-23),e.meshes[0].position.y+=.5,e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 3:return t=n.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(11,0,-23),t.meshes[0].position.y+=.5,t.meshes[0].position.z-=.5,t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","sumireko.glb")];case 4:return i=n.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(9,0,-25),i.meshes[0].position._y+=.5,i.meshes[0].position._z-=.5,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(10,0,-24),this.Reimu.position._z+=.8,this.Reimu.position._y+=.5,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/2),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(5,3,-25),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/8,Math.PI/2,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: How did she get inside the boat in the first place?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_bored.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/11.IntheFuture.mp3",{volume:.25})];case 1:return l=o.sent(),l.play(),s=[],s.push({frame:0*e,value:new c.Pq0(5,3,-25)}),s.push({frame:6*e,value:new c.Pq0(5,3,-25)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Maybe she wanted to take a little boat trip in the lake."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I travelled in this area all day, but I haven't seen her on this boat."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: She may have fallen asleep while you were in my dream?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Since we are in her dream, the origin of this space is centered around her."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: She hasn't moved at all, but this space was moved to her location."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: This information will not help us get out of here."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: We just have to repeat the process: Enter her dream, beat her up!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I will accompany you this time, Reimu! Let's do this together!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I fear that It's impossible to send you both."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Really? Why?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Sumireko's dream is very unstable, and sending you both inside might shatter it."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: And Reimu has more experience now, so it's better if she goes inside."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: That means I have to stay in the backline?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Don't worry, Sanae. I will ensure that everything goes back to normal."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Alright Reimu, good luck! Though you may not need it."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),l.stop(),this.switchToFifthStageCutscene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFifthStageCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new p(this.canvas).scene;this.scene=e}}),e}(),b=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine=new c.N$8(this.canvas,!0);var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=2,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()};var n=60,a=-9.81;t.collisionsEnabled=!0,t.enablePhysics(new c.Pq0(0,a/n,0)),this.CreateCamera(t),this.CreateMap(),this.CreateReimu();var s=c.PeD.CreateBox("wall",{size:100});s.position=new c.Pq0(56,50,-143),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:100});r.position=new c.Pq0(56,50,89),r.checkCollisions=!0,r.visibility=0;var l=c.PeD.CreateBox("wall",{size:150});l.position=new c.Pq0(181,50,-30),l.checkCollisions=!0,l.visibility=0;var h=c.PeD.CreateBox("wall",{size:150});h.position=new c.Pq0(-69,50,-30),h.checkCollisions=!0,h.visibility=0;var u=c.PeD.CreateBox("wall",{size:300});return u.position=new c.Pq0(20,250,-20),u.checkCollisions=!0,u.visibility=0,function(){(0,o.sH)(e,void 0,void 0,(function(){var e,t,i=this;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,c.KcJ)("music","audio/12.UpperSteamCave.mp3",{volume:.15,loop:!0})];case 1:return e=n.sent(),e.play(),t=c.PeD.CreateSphere("trigger",{diameter:15}),t.visibility=0,t.position=new c.Pq0(9,0,-23),setTimeout((function(){i.scene.registerBeforeRender((function(){t.intersectsMesh(i.Reimu)&&(e.stop(),i.switchToTransitionCutsceneSumireko())}))}),2e3),[2]}}))}))}(),t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",Math.PI/2,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(96,13,-72),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f--,v.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),v.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),v.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return e=o.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return t=o.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[2].checkCollisions=!0,t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].position._y-=.2,t.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 3:return i=o.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(25,0,-78),i.meshes[2].checkCollisions=!0,i.meshes[0].position._y-=.2,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 4:return n=o.sent(),n.meshes[0].scaling.setAll(.4),n.meshes[0].position=new c.Pq0(9,0,-23),n.meshes[0].rotate(c.Pq0.Up(),3.1),n.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 5:return a=o.sent(),a.meshes[0].scaling.setAll(.4),a.meshes[2].checkCollisions=!0,a.meshes[0].position=new c.Pq0(66,0,18),a.meshes[0].rotate(c.Pq0.Up(),3.1),a.meshes[0].rotate(c.Pq0.Up(),Math.PI),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 6:return s=o.sent(),s.meshes[0].scaling.setAll(.4),s.meshes[2].checkCollisions=!0,s.meshes[0].position=new c.Pq0(88,20,-28),s.meshes[0].rotate(c.Pq0.Up(),3.1),s.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 7:return r=o.sent(),r.meshes[0].scaling.setAll(.4),r.meshes[2].checkCollisions=!0,r.meshes[0].position=new c.Pq0(97,12,-70),r.meshes[0].rotate(c.Pq0.Up(),3.1),r.meshes[0].rotate(c.Pq0.Up(),3*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","sumireko.glb")];case 8:return l=o.sent(),l.meshes[0].scaling.setAll(.4),l.meshes[0].position=new c.Pq0(9,0,-25),l.meshes[0].position._y+=.5,l.meshes[0].position._z-=.5,l.meshes[0].rotate(c.Pq0.Up(),3.1),l.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToTransitionCutsceneSumireko",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new d(this.canvas);this.engine.stopRenderLoop(),this.scene&&this.scene.dispose(),this.scene=e.scene}}),e}(),y=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Sanae",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skyboxMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),window.addEventListener("resize",(function(){e.engine.resize})),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return i.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=i.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(95,12,-72),e.meshes[0].position._x-=.3,e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),15*Math.PI/8),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 3:return t=i.sent(),this.Sanae=t.meshes[0],this.Sanae.scaling.setAll(.4),this.Sanae.position=new c.Pq0(98,12,-71),this.Sanae.rotate(c.Pq0.Up(),3.1),this.Sanae.rotate(c.Pq0.Up(),3*Math.PI/4),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(96,12,-70),this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-3*Math.PI/5),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(97,14,-75),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/12,-Math.PI/16,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Now, where do we need to go, Doremy?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_casual.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),s=[],l=[],[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0*e,value:new c.Pq0(97,14,-75)}),s.push({frame:6*e,value:new c.Pq0(97,14,-75)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 2:return o.sent(),document.body.appendChild(t),document.body.appendChild(n),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Well, I don't sense anyone dreaming right now."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Great! That means we can start looking for the culprit."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Where do we start? do I have to fall asleep to drag him to me?"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Maybe that could-"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,1*e).waitAsync()];case 7:return o.sent(),this.Sanae.rotate(c.Pq0.Up(),Math.PI/8),t.removeChild(i),i=document.createTextNode("Sanae: OBJECTION!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: W-why did you scream at me?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Sorry! I really wanted to say that."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: But there is actually no need for you to fall asleep, Reimu. In fact..."),t.appendChild(i),a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 11:return o.sent(),this.Sanae.rotate(c.Pq0.Up(),Math.PI/8),t.removeChild(i),i=document.createTextNode("Sanae: You are already inside a dream!"),t.appendChild(i),a.src="portraits/Sanae_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(97,14,-75)}),s.push({frame:2*e,value:new c.Pq0(97,13,-75)}),s.push({frame:4*e,value:new c.Pq0(97,13,-75)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/12,-Math.PI/16,0)}),l.push({frame:2*e,value:new c.Pq0(0,-Math.PI/16,0)}),l.push({frame:4*e,value:new c.Pq0(0,-Math.PI/16,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),u.stop(),t.removeChild(i),i=document.createTextNode("Reimu: ..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(97,13,-75)}),s.push({frame:6*e,value:new c.Pq0(96.2,13,-72)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/16,0)}),l.push({frame:6*e,value:new c.Pq0(0,-Math.PI/16,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: W-What?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(96.2,13,-72)}),s.push({frame:6*e,value:new c.Pq0(96.2,13,-72)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/16,0)}),l.push({frame:6*e,value:new c.Pq0(0,-Math.PI/16,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 14:return o.sent(),this.SwitchSkybox(),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(96.2,13,-72)}),s.push({frame:2*e,value:new c.Pq0(98,14.5,-75)}),s.push({frame:6*e,value:new c.Pq0(98,14.5,-75)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/16,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,-Math.PI/8,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/8,-Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 15:return o.sent(),[4,(0,c.KcJ)("music","audio/11.IntheFuture.mp3",{volume:.25})];case 16:return u=o.sent(),u.play(),t.removeChild(i),i=document.createTextNode("Doremy: Wait... Are we really!?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(98,14.5,-75)}),s.push({frame:6*e,value:new c.Pq0(98,14.5,-75)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/8,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/8,-Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),this.Sanae.rotate(c.Pq0.Up(),-Math.PI/8),t.removeChild(i),i=document.createTextNode("Sanae: When I realised something seemed off with this place, I decided to fall asleep to try and find out what's happening."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Turns out the feeling I had in my dream is the same I have right now!"),t.appendChild(i),a.src="portraits/Sanae_angry.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 19:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: You didn't realise it Reimu because the dreams you were in were not 'yours'."),t.appendChild(i),a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 20:return o.sent(),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/5),t.removeChild(i),i=document.createTextNode("Reimu: I didn't get that last part, but when you said 'something seemed off', you meant...?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Yes, this place has a lot of oddities."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 22:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: The Moriya Shrine and the Scarlet Devil Mansion are absent, the Youkai mountain is shaped differently, and more."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 23:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I then realised we might be inside a dream, because dreams are not exactly like reality!"),t.appendChild(i),a.src="portraits/Sanae_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 24:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: How did I not realise that? I fell ashamed of myself."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 25:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Don't feel like that. You were just fooled by your interpretation of this place, like all of us."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 26:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: But who is responsible for..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 27:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Dreams... like reality?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 28:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Did you realise something, Reimu?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 29:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: We know someone who is able to reach Gensokyo, but only inside of her dreams."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 30:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: If something happened to her, it must be what started this mess."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 31:return o.sent(),this.Reimu.rotate(c.Pq0.Up(),Math.PI/3),t.removeChild(i),i=document.createTextNode("Reimu: Doremy, don't you feel anything?"),t.appendChild(i),a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 32:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Well, actually, someone dreaming is actually getting closer to us!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 33:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: She is moving while sleeping? That sounds cool!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 34:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Wait. She's sleeping? does that mean she is dreaming inside the dream of her dream?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_surprised.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 35:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: It doesn't matter. We may now be able to escape this dream."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 36:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I will try and get her exact location. When I find her, get to us as fast as you can!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 37:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFifthHubScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene);this.skyboxMaterial=new c.FUi("skyBox",this.scene),this.skyboxMaterial.backFaceCulling=!1,this.skyboxMaterial.disableLighting=!0,e.material=this.skyboxMaterial,e.infiniteDistance=!0,this.skyboxMaterial.disableLighting=!0,this.skyboxMaterial.reflectionTexture=new c.b4q("textures/skybox",this.scene),this.skyboxMaterial.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"SwitchSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.skyboxMaterial.reflectionTexture=new c.b4q("textures/skybox_d",this.scene)}}),Object.defineProperty(e.prototype,"switchToFifthHubScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop(),this.scene=new b(this.canvas).scene}}),e}(),w=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shooting",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageFourScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateStageFourScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.engine.stopRenderLoop();var e=new c.Z58(this.engine),t=new c.g4z("hemiLight",new c.Pq0(0,1,1),e);t.intensity=1,this.CreateCamera(e),this.camera.position=new c.Pq0(10,10,0),this.CreateStageFourMap(),this.CreateReimuStageFour();var i=c.PeD.CreateBox("wall",{size:40});i.position=new c.Pq0(20,10,-50),i.checkCollisions=!0,i.visibility=0;var n=c.PeD.CreateBox("wall",{size:40});n.position=new c.Pq0(20,10,25),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:40});a.position=new c.Pq0(-12,10,-10),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:40});s.position=new c.Pq0(53,10,-10),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:40});r.position=new c.Pq0(17,50,-10),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:40});return o.position=new c.Pq0(17,-20,-10),o.checkCollisions=!0,o.visibility=0,e}}),Object.defineProperty(e.prototype,"CreateStageFourMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){function e(e){u.width="".concat(e/100*180,"px")}var t,i,n,a,s,r,h,u,m=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_4.glb")];case 1:return t=o.sent(),t.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 2:return i=o.sent(),i.meshes[0].scaling.setAll(.1),i.meshes[0].position=new c.Pq0(23,2,-17),i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),n=40,[4,(0,c.KcJ)("music","audio/10.FaithIsfortheTransientPeople.mp3",{volume:.25})];case 3:return a=o.sent(),a.play(),[4,c.cng.ImportMeshAsync("","./models/","needles.glb")];case 4:return s=o.sent(),r=l.vs.CreateFullscreenUI("UI"),h=new l.tN,h.width="190px",h.height="20px",h.color="white",h.thickness=2,h.background="black",h.verticalAlignment=l.Ec.VERTICAL_ALIGNMENT_TOP,r.addControl(h),u=new l.tN,u.width="180px",u.height="14px",u.horizontalAlignment=l.Ec.HORIZONTAL_ALIGNMENT_LEFT,u.background="green",h.addControl(u),this.scene.onPointerDown=function(e){if(0===e.button&&0==m.shooting){m.engine.enterPointerlock();var t=m.Reimu.position._x,i=m.Reimu.position._y,n=m.Reimu.position._z;s.meshes[0].position._x=t,s.meshes[0].position._y=i,s.meshes[0].position._z=n-.5}1===e.button&&m.engine.exitPointerlock()},s.meshes[0].scaling.setAll(.2),s.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),s.meshes[0].position=new c.Pq0(30,200,-20),setTimeout((function(){m.scene.onBeforeRenderObservable.add((function(){if(s.meshes[0].moveWithCollisions(s.meshes[0].right.scaleInPlace(.3)),s.meshes[2].intersectsMesh(i.meshes[2])&&(s.meshes[0].position=new c.Pq0(30,200,-20),n-=1,e(100*n/40)),t.meshes.forEach((function(e){(s.meshes[2].intersectsMesh(e)||s.meshes[0].position._z<=-17)&&(s.meshes[0].position=new c.Pq0(30,200,-20))})),0==n){n--,i.meshes[0].visibility=0;var r=document.createElement("div"),o=document.createTextNode("Boss Defeated");r.appendChild(o),r.style.position="absolute",r.style.top="60%",r.style.left="50%",r.style.transform="translate(-50%, -0%)",r.style.margin="auto",r.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",r.style.fontSize="20px",r.style.width="500px",r.style.height="150px",r.style.borderRadius="20px",r.style.textAlign="center",r.style.alignContent="center",r.style.borderColor="red",r.style.borderStyle="ridge",r.style.fontFamily="Lucida Console",document.body.appendChild(r),setTimeout((function(){document.body.removeChild(r),a.stop(),m.switchTransitionCutsceneSanaeEnd()}),3e3)}}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageFour",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v,C,q,M,A,I,x,R,T,S,O,k,N,_,D,z,j,L,K,E,B,U,H,F,Y,X,W,G=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(23,2,-8),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/2),this.Reimu.scaling.setAll(.1),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.05,r=.05,l=.03,h=.03,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.shooting=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f-=2,G.shooting=f>=10?1:0,G.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.0025,-s),G.Reimu.moveWithCollisions(G.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.0025,p),G.Reimu.moveWithCollisions(G.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-5e-4,-h),G.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+5e-4,h),G.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.005,r),G.Reimu.moveWithCollisions(G.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.005,-r),G.Reimu.moveWithCollisions(G.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.005,0):b<0&&(b=Math.min(b+.005,0))),g.q||g.d||(w>0&&(w=Math.max(w-5e-4,0)),w<0&&(w=Math.min(w+5e-4,0))),g.c||g.v||(y>0&&(y=Math.max(y-.005,0)),y<0&&(y=Math.min(y+.005,0))))})),v=new c.FUi("mat"),v.diffuseColor=new c.v9j(0,0,1),C=c.PeD.CreateSphere("bull"),C.position=new c.Pq0(21,4,-15),C.material=v,q=c.PeD.CreateSphere("bull"),q.position=new c.Pq0(22,4,-15),q.material=v,q.position._x+=.4,M=c.PeD.CreateSphere("bull"),M.position=new c.Pq0(24,4,-15),M.material=v,M.position._x-=.4,A=c.PeD.CreateSphere("bull"),A.position=new c.Pq0(25,4,-15),A.material=v,I=c.PeD.CreateSphere("bull"),I.position=new c.Pq0(24,3,-15),I.material=v,x=c.PeD.CreateSphere("bull"),x.position=new c.Pq0(23,2,-15),x.material=v,x.position._y+=.5,R=c.PeD.CreateSphere("bull"),R.position=new c.Pq0(22,2,-15),R.material=v,R.position._x-=.4,T=c.PeD.CreateSphere("bull"),T.position=new c.Pq0(22,3,-15),T.material=v,S=c.PeD.CreateSphere("bull"),S.position=new c.Pq0(23,5,-15),S.material=v,O=c.PeD.CreateSphere("bull"),O.position=new c.Pq0(24,2,-15),O.material=v,O.position._x+=.4,k=1e3,N=.4,_=.004,D=.004,z=.004,j=.004,L=this.Reimu.position.subtract(C.position).normalize(),K=this.Reimu.position.subtract(q.position).normalize(),E=this.Reimu.position.subtract(M.position).normalize(),B=this.Reimu.position.subtract(A.position).normalize(),U=this.Reimu.position.subtract(I.position).normalize(),H=this.Reimu.position.subtract(x.position).normalize(),F=this.Reimu.position.subtract(R.position).normalize(),Y=this.Reimu.position.subtract(T.position).normalize(),X=this.Reimu.position.subtract(S.position).normalize(),W=this.Reimu.position.subtract(O.position).normalize(),setTimeout((function(){G.scene.onBeforeRenderObservable.add((function(){0==k&&(C.position=new c.Pq0(21,4,-15),L=G.Reimu.position.subtract(C.position).normalize(),k=1e3,_=.004,D=.004,z=.004,j=.004),980==k&&(q.position=new c.Pq0(22,4,-15),q.position._x+=.4),960==k&&(M.position=new c.Pq0(24,4,-15),M.position._x-=.4),940==k&&(A.position=new c.Pq0(25,4,-15)),924==k&&(I.position=new c.Pq0(24,3,-15)),910==k&&(x.position=new c.Pq0(23,2,-15),x.position._y+=.5),894==k&&(R.position=new c.Pq0(22,2,-15),R.position._x-=.4),884==k&&(T.position=new c.Pq0(22,3,-15)),874==k&&(S.position=new c.Pq0(23,5,-15)),870==k&&(O.position=new c.Pq0(24,2,-15),O.position._x+=.4),800==k&&(L=G.Reimu.position.subtract(C.position).normalize()),k<=800&&(C.position.addInPlace(L.scale(_)),_=Math.min(_+8e-4,N)),760==k&&(K=G.Reimu.position.subtract(q.position).normalize()),k<=760&&q.position.addInPlace(K.scale(_)),720==k&&(E=G.Reimu.position.subtract(M.position).normalize()),k<=720&&M.position.addInPlace(E.scale(_)),680==k&&(B=G.Reimu.position.subtract(A.position).normalize()),k<=680&&A.position.addInPlace(B.scale(_)),640==k&&(U=G.Reimu.position.subtract(I.position).normalize()),k<=640&&(I.position.addInPlace(U.scale(D)),D=Math.min(D+8e-4,N)),600==k&&(H=G.Reimu.position.subtract(x.position).normalize()),k<=600&&x.position.addInPlace(H.scale(D)),560==k&&(F=G.Reimu.position.subtract(R.position).normalize()),k<=560&&R.position.addInPlace(F.scale(D)),520==k&&(Y=G.Reimu.position.subtract(T.position).normalize()),k<=520&&(T.position.addInPlace(Y.scale(z)),z=Math.min(z+8e-4,N)),480==k&&(X=G.Reimu.position.subtract(S.position).normalize()),k<=480&&S.position.addInPlace(X.scale(z)),440==k&&(W=G.Reimu.position.subtract(O.position).normalize()),k<=440&&(O.position.addInPlace(W.scale(j)),j=Math.min(j+8e-4,N)),k-=2,t[2].intersectsMesh(C)&&0==f&&(f=256,C.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(q)&&0==f&&(f=256,q.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(M)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(A)&&0==f&&(f=256,A.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(x)&&0==f&&(f=256,x.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(R)&&0==f&&(f=256,R.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(T)&&0==f&&(f=256,T.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(S)&&0==f&&(f=256,S.position=new c.Pq0(14,200,-20))}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchTransitionCutsceneSanaeEnd",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new y(this.canvas).scene;this.scene=e}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",0,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=100,this.camera.minZ=.3,this.camera.lowerRadiusLimit=1,this.camera.upperRadiusLimit=5,this.camera.panningSensibility=0}}),e}(),g=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Sanae",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageFourScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateStageFourScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()};var n=60,a=-9.81;t.collisionsEnabled=!0,t.enablePhysics(new c.Pq0(0,a/n,0)),this.CreateCamera(t),this.CreateStageFourMap(),this.CreateReimuStageFour();var s=c.PeD.CreateBox("wall",{size:40});s.position=new c.Pq0(20,10,-50),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:40});r.position=new c.Pq0(20,10,25),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:40});o.position=new c.Pq0(-12,10,-10),o.checkCollisions=!0,o.visibility=0;var l=c.PeD.CreateBox("wall",{size:40});l.position=new c.Pq0(53,10,-10),l.checkCollisions=!0,l.visibility=0;var h=c.PeD.CreateBox("wall",{size:40});h.position=new c.Pq0(17,50,-10),h.checkCollisions=!0,h.visibility=0;var u=c.PeD.CreateBox("wall",{size:40});return u.position=new c.Pq0(17,-20,-10),u.checkCollisions=!0,u.visibility=0,t}}),Object.defineProperty(e.prototype,"CreateStageFourMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_4.glb")];case 1:return e=i.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 2:return t=i.sent(),this.Sanae=t.meshes[0],this.Sanae.scaling.setAll(.1),this.Sanae.position=new c.Pq0(20,0,-15),this.Sanae.rotate(c.Pq0.Up(),3.1),this.Sanae.rotate(c.Pq0.Up(),-Math.PI/2),this.Sanae.rotate(c.Pq0.Forward(),Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageFour",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(25,0,-17),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/2),this.Reimu.scaling.setAll(.1),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(25,1,-15),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(Math.PI/8,Math.PI,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Hey, Doremy! Have you ever been to the outside world before?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_casual.png",n.appendChild(a),a.style.height="190px",n.style.top="55%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge ",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/09.UndellaTown(Autumn-Winter-Spring).mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0,value:new c.Pq0(25,1,-15)}),s.push({frame:6*e,value:new c.Pq0(25,1,-15)}),l.push({frame:0,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [Never, but I saw it's people's dreams a few times. Why do you ask?]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Do you know what's that building?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(25,1,-15)}),s.push({frame:4*e,value:new c.Pq0(25,1,-15)}),l.push({frame:0,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:2*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [That looks like a school.]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(25,1,-15)}),s.push({frame:4*e,value:new c.Pq0(25,1,-15)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Schools are next to the sea in the outside world? That's sounds cool!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(25,1,-15)}),s.push({frame:2*e,value:new c.Pq0(31,9,-11)}),s.push({frame:4*e,value:new c.Pq0(31,9,-11)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/4,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Hey, Reimu! fancy meetting you here!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(31,9,-11)}),s.push({frame:2*e,value:new c.Pq0(21,1,-15)}),s.push({frame:4*e,value:new c.Pq0(21,1,-15)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,5*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/4,3*Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,3*Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Did you came here to take a sun bath like me?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(21,1,-15)}),s.push({frame:4*e,value:new c.Pq0(21,1,-15)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,3*Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,3*Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Not really, but shouldn't you be in a classroom right now?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",this.Reimu.position=new c.Pq0(21,0,-17),this.Reimu.rotate(c.Pq0.Up(),3*Math.PI/4),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(21,1,-15)}),s.push({frame:2*e,value:new c.Pq0(23,1,-13)}),s.push({frame:4*e,value:new c.Pq0(23,1,-13)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,3*Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,10*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/16,10*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Today is our day off!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(23,1,-13)}),s.push({frame:4*e,value:new c.Pq0(23,1,-13)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,10*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/16,10*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Then why are you here?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: To take a sun bath!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Well, that makes sense."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I love this place so much! I would never give it away for anything!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(23,1,-13)}),s.push({frame:4*e,value:new c.Pq0(23,1,-13)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,10*Math.PI/8,0)}),l.push({frame:2*e,value:new c.Pq0(0,2*Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(0,2*Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: If not for the messed up sky, I'm sure this place would look nice."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(23,1,-13)}),s.push({frame:4*e,value:new c.Pq0(23,1,-13)}),l.push({frame:0*e,value:new c.Pq0(0,2*Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(0,2*Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: ..."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 16:return o.sent(),this.Sanae.rotate(c.Pq0.Forward(),-Math.PI/2),t.removeChild(i),i=document.createTextNode("Sanae: All of this isn't real, isn't it?"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Huh? You realized?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: Even if it's not exactly the same, this place looks like the one I remember from the outside world."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(23,1,-15)}),s.push({frame:2*e,value:new c.Pq0(20,1,-13)}),s.push({frame:5*e,value:new c.Pq0(20,1,-13)}),l.push({frame:0*e,value:new c.Pq0(0,2*Math.PI,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:5*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 19:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: It holds a very special place in my heart!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-13)}),s.push({frame:4*e,value:new c.Pq0(20,1,-13)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 20:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: ...But I do not belong here anymore."),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Sanae, I would really like to help you..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 22:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: It's okay, Reimu. I know what I have to do now!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 23:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I am not honoring my memories of this place like this!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-13)}),s.push({frame:2*e,value:new c.Pq0(20,1,-17)}),s.push({frame:4*e,value:new c.Pq0(20,1,-17)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:2*e,value:new c.Pq0(-Math.PI/16,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 24:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I am now a resident of Gensokyo! And I have so many friends there!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-17)}),s.push({frame:4*e,value:new c.Pq0(20,1,-17)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 25:return o.sent(),this.Reimu.position=new c.Pq0(23,2,-8),this.Sanae.position=new c.Pq0(23,2,-15),this.Reimu.rotate(c.Pq0.Up(),-3*Math.PI/4),t.removeChild(i),i=document.createTextNode("Sanae: Reimu! Let's have a battle now!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-17)}),s.push({frame:2*e,value:new c.Pq0(17,1,-12)}),s.push({frame:4*e,value:new c.Pq0(17,1,-12)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,3*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(0,Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 26:return o.sent(),t.removeChild(i),i=document.createTextNode("Sanae: I want to leave this place with a blast!"),t.appendChild(i),t.style.borderColor="green",a.src="portraits/Sanae_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(17,1,-12)}),s.push({frame:4*e,value:new c.Pq0(17,1,-12)}),l.push({frame:0*e,value:new c.Pq0(0,Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 27:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Alright Sanae, if that's what you want..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(17,1,-12)}),s.push({frame:2*e,value:new c.Pq0(23,3,-6)}),s.push({frame:4*e,value:new c.Pq0(23,3,-6)}),l.push({frame:0*e,value:new c.Pq0(0,Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/8,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 28:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFourthStageScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFourthStageScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new w(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),P=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return i.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=i.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(95,12,-73),e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),7*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 3:return t=i.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(95,12,-71),t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(95,12,-69),this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-3*Math.PI/4),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(100,14,-75),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/8,-Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: I should have expected to see Sanae, but I hoped she wouldn't end up like this."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_surprised.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0*e,value:new c.Pq0(100,14,-75)}),s.push({frame:6*e,value:new c.Pq0(100,14,-75)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Is this person also a friend of yours, Reimu?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Sanae is from the outside world, but she arrived in Gensokyo to gather faith. She is a shrine maiden like me."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: We weren't getting along at first, but we are like business rivals now."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: you have a lot of friends here, Reimu!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: ..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: How is that possible?"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: What's the matter?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Sanae is the shrine maiden of Moriya shrine, which is located on this mountain."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Here, we have Sanae."),t.appendChild(i),a.src="portraits/Reimu_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(100,14,-75)}),s.push({frame:2*e,value:new c.Pq0(96,13,-73)}),s.push({frame:4*e,value:new c.Pq0(96,13,-73)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,0,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/8,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: But we don't have the shrine!"),t.appendChild(i),a.src="portraits/Reimu_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(96,13,-73)}),s.push({frame:1*e,value:new c.Pq0(68,2,-72)}),s.push({frame:4*e,value:new c.Pq0(68,2,-72)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,0,0)}),l.push({frame:1*e,value:new c.Pq0(-Math.PI/8,Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/8,Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: A shrine is supposed to be here?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(68,2,-72)}),s.push({frame:4*e,value:new c.Pq0(68,2,-72)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/8,Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/8,Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Do you think it could be linked to what's happening with the dreams?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: The dream world could not have such an impact on the real world."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Then that makes it two separate incidents!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I really need a break!"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: But with Sanae's help, It will be done in no time!"),t.appendChild(i),a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 18:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFourthStageCutscene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFourthStageCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new g(this.canvas).scene;this.scene=e}}),e}(),f=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine=new c.N$8(this.canvas,!0);var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=2,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()};var n=60,a=-9.81;t.collisionsEnabled=!0,t.enablePhysics(new c.Pq0(0,a/n,0)),this.CreateCamera(t),this.CreateMap(),this.CreateReimu();var s=c.PeD.CreateBox("wall",{size:100});s.position=new c.Pq0(56,50,-143),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:100});r.position=new c.Pq0(56,50,89),r.checkCollisions=!0,r.visibility=0;var l=c.PeD.CreateBox("wall",{size:150});l.position=new c.Pq0(181,50,-30),l.checkCollisions=!0,l.visibility=0;var h=c.PeD.CreateBox("wall",{size:150});h.position=new c.Pq0(-69,50,-30),h.checkCollisions=!0,h.visibility=0;var u=c.PeD.CreateBox("wall",{size:300});return u.position=new c.Pq0(20,250,-20),u.checkCollisions=!0,u.visibility=0,function(){(0,o.sH)(e,void 0,void 0,(function(){var e,t,i=this;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,c.KcJ)("music","audio/02.RescueTeamBase.mp3",{volume:.15,loop:!0})];case 1:return e=n.sent(),e.play(),t=c.PeD.CreateSphere("trigger",{diameter:15}),t.visibility=0,t.position=new c.Pq0(95,12,-73),setTimeout((function(){i.scene.registerBeforeRender((function(){t.intersectsMesh(i.Reimu)&&(e.stop(),i.switchToTransitionCutsceneSanae())}))}),2e3),[2]}}))}))}(),t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",Math.PI/2,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(88,21,-31),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f--,v.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),v.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),v.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return e=o.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return t=o.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[2].checkCollisions=!0,t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].position._y-=.2,t.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 3:return i=o.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(25,0,-78),i.meshes[2].checkCollisions=!0,i.meshes[0].position._y-=.2,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 4:return n=o.sent(),n.meshes[0].scaling.setAll(.4),n.meshes[0].position=new c.Pq0(95,12,-73),n.meshes[0].rotate(c.Pq0.Up(),3.1),n.meshes[0].rotate(c.Pq0.Up(),7*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 5:return a=o.sent(),a.meshes[0].scaling.setAll(.4),a.meshes[2].checkCollisions=!0,a.meshes[0].position=new c.Pq0(66,0,18),a.meshes[0].rotate(c.Pq0.Up(),3.1),a.meshes[0].rotate(c.Pq0.Up(),Math.PI),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 6:return s=o.sent(),s.meshes[0].scaling.setAll(.4),s.meshes[2].checkCollisions=!0,s.meshes[0].position=new c.Pq0(88,20,-28),s.meshes[0].rotate(c.Pq0.Up(),3.1),s.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 7:return r=o.sent(),r.meshes[0].scaling.setAll(.4),r.meshes[0].position=new c.Pq0(95,12,-71),r.meshes[0].rotate(c.Pq0.Up(),3.1),r.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToTransitionCutsceneSanae",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new P(this.canvas);this.engine.stopRenderLoop(),this.scene&&this.scene.dispose(),this.scene=e.scene}}),e}(),v=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Aya",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return n.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=n.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(91,20,-28),e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),7*Math.PI/8),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 3:return t=n.sent(),this.Aya=t.meshes[0],this.Aya.scaling.setAll(.4),this.Aya.position=new c.Pq0(88,20,-28),this.Aya.rotate(c.Pq0.Up(),3.1),this.Aya.rotate(c.Pq0.Up(),Math.PI/8),[4,c.cng.ImportMeshAsync("","./models/","sanae.glb")];case 4:return i=n.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(95,12,-71),i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(88,20,-31),this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),Math.PI/2),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(94,23,-33),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/8,-Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Aya: Ayayayaya..."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Aya_sad.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="orange",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0*e,value:new c.Pq0(94,23,-33)}),s.push({frame:6*e,value:new c.Pq0(94,23,-33)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 2:return o.sent(),document.body.appendChild(t),document.body.appendChild(n),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),this.Aya.rotate(c.Pq0.Up(),3*Math.PI/8),t.removeChild(i),i=document.createTextNode("Aya: Reimu! Do you think that's how you wake a friend up?"),t.appendChild(i),a.src="portraits/Aya_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I'm not searching consideration, but you could be a little more gentle."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: Wait... I was asleep in daylight? For how long? What happened to me?"),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_surprised.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: People are starting to fall asleep all over Gensokyo, and they are unable to wake up."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 7:return o.sent(),this.Aya.rotate(c.Pq0.Up(),-Math.PI/2),t.removeChild(i),i=document.createTextNode("Aya: WHAT? AND I MISSED SUCH A SCOOP?"),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Oh no..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 9:return o.sent(),this.Aya.rotate(c.Pq0.Up(),Math.PI/2),t.removeChild(i),i=document.createTextNode("Aya: Reimu! You already have taken actions, right? Then you have to tell me EVERYTHING you know!"),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 10:return o.sent(),this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(.1)),t.removeChild(i),i=document.createTextNode("Aya: Who are the people that fell asleep?"),t.appendChild(i),a.src="portraits/Aya_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 11:return o.sent(),a.style.height="200px",this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(.3)),t.removeChild(i),i=document.createTextNode("Aya: What was their geographic position?"),t.appendChild(i),a.src="portraits/Aya_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 12:return o.sent(),a.style.height="210px",this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(.5)),t.removeChild(i),i=document.createTextNode("Aya: What were their dreams like?"),t.appendChild(i),a.src="portraits/Aya_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 13:return o.sent(),a.style.height="190px",t.removeChild(i),i=document.createTextNode("Reimu: Aya, please, we're in a hurry..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: When you are finished with Aya, Reimu, we will have to go to that mountain next."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",s=[],s.push({frame:0*e,value:new c.Pq0(94,23,-33)}),s.push({frame:2*e,value:new c.Pq0(93,22,-50)}),s.push({frame:5*e,value:new c.Pq0(93,22,-50)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/4,-7*Math.PI/8,0)}),l.push({frame:5*e,value:new c.Pq0(Math.PI/4,-7*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Can't you help me here?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(93,22,-50)}),s.push({frame:4*e,value:new c.Pq0(93,22,-50)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,-7*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,-7*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFourthHubScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFourthHubScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop(),this.scene=new f(this.canvas).scene}}),e}(),C=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shooting",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageThreeScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateStageThreeScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.engine.stopRenderLoop();var e=new c.Z58(this.engine),t=new c.g4z("hemiLight",new c.Pq0(0,1,1),e);t.intensity=1,this.CreateCamera(e),this.camera.position=new c.Pq0(10,10,0),this.CreateStageThreeMap(),this.CreateReimuStageThree();var i=c.PeD.CreateBox("wall",{size:50});i.position=new c.Pq0(30,10,-80),i.checkCollisions=!0,i.visibility=0;var n=c.PeD.CreateBox("wall",{size:50});n.position=new c.Pq0(30,10,18),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:50});a.position=new c.Pq0(-18,10,-30),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:50});s.position=new c.Pq0(80,10,-30),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:50});return r.position=new c.Pq0(30,60,-30),r.checkCollisions=!0,r.visibility=0,e}}),Object.defineProperty(e.prototype,"CreateStageThreeMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){function e(e){u.width="".concat(e/100*160,"px")}var t,i,n,a,s,r,h,u,m=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_3.glb")];case 1:return t=o.sent(),t.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 2:return i=o.sent(),i.meshes[0].scaling.setAll(.7),i.meshes[0].position=new c.Pq0(50,5,-31),n=30,[4,(0,c.KcJ)("music","audio/08.YoukaiMountain~MysteriousMountain.mp3",{volume:.25})];case 3:return a=o.sent(),a.play(),[4,c.cng.ImportMeshAsync("","./models/","needles.glb")];case 4:return s=o.sent(),r=l.vs.CreateFullscreenUI("UI"),h=new l.tN,h.width="170px",h.height="20px",h.color="white",h.thickness=2,h.background="black",h.verticalAlignment=l.Ec.VERTICAL_ALIGNMENT_TOP,r.addControl(h),u=new l.tN,u.width="160px",u.height="14px",u.horizontalAlignment=l.Ec.HORIZONTAL_ALIGNMENT_LEFT,u.background="orange",h.addControl(u),this.scene.onPointerDown=function(e){if(0===e.button&&0==m.shooting){m.engine.enterPointerlock();var t=m.Reimu.position._x,i=m.Reimu.position._y,n=m.Reimu.position._z;s.meshes[0].position._x=t-2,s.meshes[0].position._y=i,s.meshes[0].position._z=n}1===e.button&&m.engine.exitPointerlock()},s.meshes[0].scaling.setAll(.8),s.meshes[0].rotate(c.Pq0.Up(),Math.PI),s.meshes[0].position=new c.Pq0(30,200,-20),setTimeout((function(){m.scene.onBeforeRenderObservable.add((function(){if(s.meshes[0].moveWithCollisions(s.meshes[0].right.scaleInPlace(1.2)),s.meshes[2].intersectsMesh(i.meshes[2])&&(s.meshes[0].position=new c.Pq0(30,200,-20),n-=1,e(100*n/30)),t.meshes.forEach((function(e){(s.meshes[2].intersectsMesh(e)||s.meshes[0].position._x>=51)&&(s.meshes[0].position=new c.Pq0(30,200,-20))})),0==n){n--,i.meshes[0].visibility=0;var r=document.createElement("div"),o=document.createTextNode("Boss Defeated");r.appendChild(o),r.style.position="absolute",r.style.top="60%",r.style.left="50%",r.style.transform="translate(-50%, -0%)",r.style.margin="auto",r.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",r.style.fontSize="20px",r.style.width="500px",r.style.height="150px",r.style.borderRadius="20px",r.style.textAlign="center",r.style.alignContent="center",r.style.borderColor="red",r.style.borderStyle="ridge",r.style.fontFamily="Lucida Console",document.body.appendChild(r),setTimeout((function(){document.body.removeChild(r),a.stop(),m.switchTransitionCutsceneAyaEnd()}),3e3)}}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageThree",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v,C,q,M,A,I,x,R,T,S,O,k,N,_,D,z,j,L,K,E,B,U,H,F,Y,X,W,G,Z,V,$,J,Q,ee,te,ie,ne,ae,se,re,oe,ce,le,he,ue=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(15,5,-31),this.Reimu.scaling.setAll(.6),this.Reimu.rotate(c.Pq0.Up(),Math.PI),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.shooting=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f-=2,ue.shooting=f>=10?1:0,ue.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),ue.Reimu.moveWithCollisions(ue.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),ue.Reimu.moveWithCollisions(ue.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),ue.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),ue.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),ue.Reimu.moveWithCollisions(ue.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),ue.Reimu.moveWithCollisions(ue.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),v=new c.FUi("mat"),v.diffuseColor=new c.v9j(1,0,0),C=new c.FUi("mat"),C.diffuseColor=new c.v9j(0,1,0),q=new c.FUi("mat"),q.diffuseColor=new c.v9j(0,0,1),M=c.PeD.CreateSphere("bull"),M.position=new c.Pq0(40,5,-31),M.material=v,A=c.PeD.CreateSphere("bull"),A.position=new c.Pq0(41,5,-30),A.position._x-=.7,A.position._z-=.4,A.material=v,I=c.PeD.CreateSphere("bull"),I.position=new c.Pq0(41,5,-30),I.material=v,I.position._x-=.1,I.position._z-=.2,x=c.PeD.CreateSphere("bull"),x.position=new c.Pq0(41,5,-30),x.material=v,x.position._x+=.5,x.position._z-=.4,R=c.PeD.CreateSphere("bull"),R.position=new c.Pq0(42,5,-31),R.position._x-=.25,R.material=v,T=c.PeD.CreateSphere("bull"),T.position=new c.Pq0(41,5,-32),T.material=v,T.position._x+=.5,T.position._z+=.4,S=c.PeD.CreateSphere("bull"),S.position=new c.Pq0(41,5,-32),S.material=v,S.position._x-=.1,S.position._z+=.2,O=c.PeD.CreateSphere("bull"),O.position=new c.Pq0(41,5,-32),O.position._x-=.7,O.position._z+=.4,O.material=v,k=c.PeD.CreateSphere("bull"),k.position=new c.Pq0(40,7,-31),k.position._z-=.1,k.material=q,N=c.PeD.CreateSphere("bull"),N.position=new c.Pq0(40,7,-31),N.position._x+=.3,N.position._z+=.6,N.material=q,_=c.PeD.CreateSphere("bull"),_.position=new c.Pq0(41,7,-30),_.position._x-=.1,_.position._z+=.1,_.material=q,D=c.PeD.CreateSphere("bull"),D.position=new c.Pq0(42,7,-30),D.position._x-=.4,D.position._z+=.3,D.material=q,z=c.PeD.CreateSphere("bull"),z.position=new c.Pq0(42,7,-30),z.position._x+=.3,z.position._z+=.1,z.material=q,j=c.PeD.CreateSphere("bull"),j.position=new c.Pq0(43,7,-31),j.position._x-=.1,j.position._z+=.6,j.material=q,L=c.PeD.CreateSphere("bull"),L.position=new c.Pq0(43,7,-31),L.position._x+=.2,L.position._z-=.1,L.material=q,K=c.PeD.CreateSphere("bull"),K.position=new c.Pq0(43,7,-32),K.position._x-=.1,K.position._z+=.2,K.material=q,E=c.PeD.CreateSphere("bull"),E.position=new c.Pq0(42,7,-32),E.position._x+=.3,E.position._z-=.3,E.material=q,B=c.PeD.CreateSphere("bull"),B.position=new c.Pq0(42,7,-32),B.position._x-=.4,B.position._z-=.5,B.material=q,U=c.PeD.CreateSphere("bull"),U.position=new c.Pq0(41,7,-32),U.position._x-=.1,U.position._z-=.3,U.material=q,H=c.PeD.CreateSphere("bull"),H.position=new c.Pq0(40,7,-31),H.position._x+=.3,H.position._z-=.8,H.material=q,F=c.PeD.CreateSphere("bull"),F.position=new c.Pq0(40,9,-31),F.material=C,Y=c.PeD.CreateSphere("bull"),Y.position=new c.Pq0(41,9,-28),Y.material=C,X=c.PeD.CreateSphere("bull"),X.position=new c.Pq0(43,9,-26),X.material=C,W=c.PeD.CreateSphere("bull"),W.position=new c.Pq0(46,9,-25),W.material=C,G=c.PeD.CreateSphere("bull"),G.position=new c.Pq0(49,9,-26),G.material=C,Z=c.PeD.CreateSphere("bull"),Z.position=new c.Pq0(51,9,-28),Z.material=C,V=c.PeD.CreateSphere("bull"),V.position=new c.Pq0(52,9,-31),V.material=C,$=c.PeD.CreateSphere("bull"),$.position=new c.Pq0(51,9,-34),$.material=C,J=c.PeD.CreateSphere("bull"),J.position=new c.Pq0(49,9,-36),J.material=C,Q=c.PeD.CreateSphere("bull"),Q.position=new c.Pq0(46,9,-37),Q.material=C,ee=c.PeD.CreateSphere("bull"),ee.position=new c.Pq0(43,9,-36),ee.material=C,te=c.PeD.CreateSphere("bull"),te.position=new c.Pq0(41,9,-34),te.material=C,ie=298,ne=998,ae=698,se=.4,re=.1,oe=.22,ce=this.Reimu.position.subtract(M.position).normalize(),le=this.Reimu.position.subtract(M.position).normalize(),he=this.Reimu.position.subtract(M.position).normalize(),setTimeout((function(){ue.scene.onBeforeRenderObservable.add((function(){0==ie&&(ie=300,M.position=new c.Pq0(40,5,-31),A.position=new c.Pq0(41,5,-30),A.position._x-=.7,A.position._z-=.4,I.position=new c.Pq0(41,5,-30),I.position._x-=.1,I.position._z-=.2,x.position=new c.Pq0(41,5,-30),x.position._x+=.5,x.position._z-=.4,R.position=new c.Pq0(42,5,-31),R.position._x-=.25,T.position=new c.Pq0(41,5,-32),T.position._x+=.5,T.position._z+=.4,S.position=new c.Pq0(41,5,-32),S.position._x-=.1,S.position._z+=.2,O.position=new c.Pq0(41,5,-32),O.position._x-=.7,O.position._z+=.4,ce=ue.Reimu.position.subtract(M.position).normalize()),M.position.addInPlace(ce.scale(se)),A.position.addInPlace(ce.scale(se)),I.position.addInPlace(ce.scale(se)),x.position.addInPlace(ce.scale(se)),R.position.addInPlace(ce.scale(se)),T.position.addInPlace(ce.scale(se)),S.position.addInPlace(ce.scale(se)),O.position.addInPlace(ce.scale(se)),0==ae&&(ae=700,k.position=new c.Pq0(40,7,-31),k.position._z-=.1,N.position=new c.Pq0(40,7,-31),N.position._x+=.3,N.position._z+=.6,_.position=new c.Pq0(41,7,-30),_.position._x-=.1,_.position._z+=.1,D.position=new c.Pq0(42,7,-30),D.position._x-=.4,D.position._z+=.3,z.position=new c.Pq0(42,7,-30),z.position._x+=.3,z.position._z+=.1,j.position=new c.Pq0(43,7,-31),j.position._x-=.1,j.position._z+=.6,L.position=new c.Pq0(43,7,-31),L.position._x+=.2,L.position._z-=.1,K.position=new c.Pq0(43,7,-32),K.position._x-=.1,K.position._z+=.2,E.position=new c.Pq0(42,7,-32),E.position._x+=.3,E.position._z-=.3,B.position=new c.Pq0(42,7,-32),B.position._x-=.4,B.position._z-=.5,U.position=new c.Pq0(41,7,-32),U.position._x-=.1,U.position._z-=.3,H.position=new c.Pq0(40,7,-31),H.position._x+=.3,H.position._z-=.8,he=ue.Reimu.position.subtract(k.position).normalize()),k.position.addInPlace(he.scale(oe)),N.position.addInPlace(he.scale(oe)),_.position.addInPlace(he.scale(oe)),D.position.addInPlace(he.scale(oe)),z.position.addInPlace(he.scale(oe)),j.position.addInPlace(he.scale(oe)),L.position.addInPlace(he.scale(oe)),K.position.addInPlace(he.scale(oe)),E.position.addInPlace(he.scale(oe)),B.position.addInPlace(he.scale(oe)),U.position.addInPlace(he.scale(oe)),H.position.addInPlace(he.scale(oe)),0==ne&&(ne=1e3,F.position=new c.Pq0(40,9,-31),Y.position=new c.Pq0(41,9,-28),X.position=new c.Pq0(43,9,-26),W.position=new c.Pq0(46,9,-25),G.position=new c.Pq0(49,9,-26),Z.position=new c.Pq0(51,9,-28),V.position=new c.Pq0(52,9,-31),$.position=new c.Pq0(51,9,-34),J.position=new c.Pq0(49,9,-36),Q.position=new c.Pq0(46,9,-37),ee.position=new c.Pq0(43,9,-36),te.position=new c.Pq0(41,9,-34),le=ue.Reimu.position.subtract(F.position).normalize()),F.position.addInPlace(le.scale(re)),Y.position.addInPlace(le.scale(re)),X.position.addInPlace(le.scale(re)),W.position.addInPlace(le.scale(re)),G.position.addInPlace(le.scale(re)),Z.position.addInPlace(le.scale(re)),V.position.addInPlace(le.scale(re)),$.position.addInPlace(le.scale(re)),J.position.addInPlace(le.scale(re)),Q.position.addInPlace(le.scale(re)),ee.position.addInPlace(le.scale(re)),te.position.addInPlace(le.scale(re)),ie-=2,ae-=2,ne-=2,t[2].intersectsMesh(M)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(A)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(I)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(x)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(R)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(T)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(S)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(O)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(k)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(N)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(_)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(D)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(z)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(j)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(L)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(K)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(E)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(B)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(U)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(H)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(F)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(Y)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(X)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(W)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(G)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(Z)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(V)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh($)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(J)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(Q)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(ee)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(te)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20))}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchTransitionCutsceneAyaEnd",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new v(this.canvas).scene;this.scene=e}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",0,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),e}(),q=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Aya",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageThreeScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateStageThreeScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()};var n=60,a=-9.81;t.collisionsEnabled=!0,t.enablePhysics(new c.Pq0(0,a/n,0)),this.CreateCamera(t),this.CreateStageThreeMap(),this.CreateReimuStageThree();var s=c.PeD.CreateBox("wall",{size:50});s.position=new c.Pq0(30,10,-80),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:50});r.position=new c.Pq0(30,10,18),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:50});o.position=new c.Pq0(-18,10,-30),o.checkCollisions=!0,o.visibility=0;var l=c.PeD.CreateBox("wall",{size:50});l.position=new c.Pq0(80,10,-30),l.checkCollisions=!0,l.visibility=0;var h=c.PeD.CreateBox("wall",{size:50});return h.position=new c.Pq0(30,60,-30),h.checkCollisions=!0,h.visibility=0,t}}),Object.defineProperty(e.prototype,"CreateStageThreeMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_3.glb")];case 1:return e=i.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 2:return t=i.sent(),this.Aya=t.meshes[0],this.Aya.scaling.setAll(.7),this.Aya.position=new c.Pq0(42,1,-38),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageThree",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(15,1,-31),this.Reimu.scaling.setAll(.6),this.Reimu.rotate(c.Pq0.Up(),Math.PI),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(21,3,-31),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(0,3*Math.PI/2,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Oh! We are indoors for once. That's a change from the previous dreams."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_surprised.png",n.appendChild(a),a.style.height="190px",n.style.top="55%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge ",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/07.IntheNightmare.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0,value:new c.Pq0(21,3,-31)}),s.push({frame:5*e,value:new c.Pq0(21,3,-31)}),l.push({frame:0,value:new c.Pq0(0,3*Math.PI/2,0)}),l.push({frame:5*e,value:new c.Pq0(0,3*Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: I was waiting for you, Reimu."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(21,3,-31)}),s.push({frame:2*e,value:new c.Pq0(35,3,-42)}),s.push({frame:4*e,value:new c.Pq0(35,3,-42)}),l.push({frame:0,value:new c.Pq0(0,3*Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(0,Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: No, you were not!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(35,3,-42)}),s.push({frame:4*e,value:new c.Pq0(35,3,-42)}),l.push({frame:0*e,value:new c.Pq0(0,Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: It's been quite a long time since we last met."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Is it really?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: My name is Shameimaru Aya. It is my business to know what other people do not know."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(35,3,-42)}),s.push({frame:2*e,value:new c.Pq0(45,3,-42)}),s.push({frame:5*e,value:new c.Pq0(45,3,-42)}),l.push({frame:0*e,value:new c.Pq0(0,Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(0,-Math.PI/4,0)}),l.push({frame:5*e,value:new c.Pq0(0,-Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I know you and your job already Aya. Why do you have to remind me?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(45,3,-42)}),s.push({frame:7*e,value:new c.Pq0(45,3,-42)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/4,0)}),l.push({frame:7*e,value:new c.Pq0(0,-Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: What you do in this world is a matter of no consequence. The question is what can you make people believe you have done."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",[4,this.scene.beginAnimation(this.camera,0,7*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Did Yukari started giving you 'How to be annoying with Reimu' lessons?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Aya: Crime is common. Logic is rare. Therefore it is upon the logic rather than upon the crime that you should dwell."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(45,3,-42)}),s.push({frame:2*e,value:new c.Pq0(65,3,-42)}),s.push({frame:7*e,value:new c.Pq0(65,3,-42)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:7*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,7*e).waitAsync()];case 11:return o.sent(),this.Aya.position=new c.Pq0(54,1,-20),this.Aya.rotate(c.Pq0.Up(),Math.PI),t.removeChild(i),i=document.createTextNode("Aya: I chose Logic as my dwelling. What was your choice, Reimu?"),t.appendChild(i),a.src="portraits/Aya_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(65,3,-42)}),s.push({frame:6*e,value:new c.Pq0(65,3,-20)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: For my own good, I will not answer that question."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(65,3,-20)}),s.push({frame:4*e,value:new c.Pq0(65,3,-20)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: This is not like you at all Aya! I will have to knock some senses into you!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(65,3,-20)}),s.push({frame:2*e,value:new c.Pq0(21,3,-27)}),s.push({frame:5*e,value:new c.Pq0(21,3,-27)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(0,-2*Math.PI/3,0)}),l.push({frame:5*e,value:new c.Pq0(0,-2*Math.PI/3,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 14:return o.sent(),this.Aya.position=new c.Pq0(50,5,-31),t.removeChild(i),i=document.createTextNode("Aya: It seems it can't be helped then..."),t.appendChild(i),t.style.borderColor="orange",a.src="portraits/Aya_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(21,3,-27)}),s.push({frame:2*e,value:new c.Pq0(30,5,-27)}),s.push({frame:4*e,value:new c.Pq0(30,5,-27)}),l.push({frame:0*e,value:new c.Pq0(0,-2*Math.PI/3,0)}),l.push({frame:2*e,value:new c.Pq0(0,-4*Math.PI/3,0)}),l.push({frame:4*e,value:new c.Pq0(0,-4*Math.PI/3,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 15:return o.sent(),this.Aya.rotate(c.Pq0.Up(),-Math.PI),this.Reimu.position=new c.Pq0(15,5,-31),t.removeChild(i),i=document.createTextNode("Aya: Brace yourself, Reimu! The Game Is On!"),t.appendChild(i),a.src="portraits/Aya_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(30,5,-27)}),s.push({frame:2*e,value:new c.Pq0(7,7,-31)}),s.push({frame:4*e,value:new c.Pq0(7,7,-31)}),l.push({frame:0*e,value:new c.Pq0(0,-4*Math.PI/3,0)}),l.push({frame:2*e,value:new c.Pq0(0,-3*Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,-3*Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToThirdStageScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToThirdStageScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new C(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),M=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return i.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=i.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(90,20,-28),e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),3*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 3:return t=i.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(88,20,-28),t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Up(),Math.PI/8),t.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(88,20,-31),this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),Math.PI/2),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(84,23,-33),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/8,Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Wait! Aya? How did this happen?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_surprised.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return l=o.sent(),l.play(),s.push({frame:0*e,value:new c.Pq0(84,23,-33)}),s.push({frame:6*e,value:new c.Pq0(84,23,-33)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: stay calm, Reimu! It's not too late, we can still save her!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I know, I'm calm, but Aya is one of my friends."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: But what's bothering me is that she is not the kind to take a nap outside like that."),t.appendChild(i),a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: At that time, she should be racing through Gensokyo, searching for any info to pack her newspaper with."),t.appendChild(i),a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: You don't have to be awake to fall victim to this state."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: It doesn't matter. I will not leave her like that."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Without her poorly written journals, Gensokyo will become boring in an instant. I will save you, Aya!"),t.appendChild(i),a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: (Are you sure you are friends?)"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),l.stop(),this.switchToThirdStageCutscene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToThirdStageCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new q(this.canvas).scene;this.scene=e}}),e}(),A=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine=new c.N$8(this.canvas,!0);var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=2,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu();var n=c.PeD.CreateBox("wall",{size:100});n.position=new c.Pq0(56,50,-143),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:100});a.position=new c.Pq0(56,50,89),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:150});s.position=new c.Pq0(181,50,-30),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:150});r.position=new c.Pq0(-69,50,-30),r.checkCollisions=!0,r.visibility=0;var l=c.PeD.CreateBox("wall",{size:300});return l.position=new c.Pq0(20,250,-20),l.checkCollisions=!0,l.visibility=0,function(){(0,o.sH)(e,void 0,void 0,(function(){var e,t,i=this;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,c.KcJ)("music","audio/02.RescueTeamBase.mp3",{volume:.15,loop:!0})];case 1:return e=n.sent(),e.play(),t=c.PeD.CreateSphere("trigger",{diameter:15}),t.visibility=0,t.position=new c.Pq0(90,20,-28),setTimeout((function(){i.scene.registerBeforeRender((function(){t.intersectsMesh(i.Reimu)&&(e.stop(),i.switchToTransitionCutsceneAya())}))}),2e3),[2]}}))}))}(),t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",Math.PI/2,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(69,1,19),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f--,v.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),v.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),v.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s;return(0,o.YH)(this,(function(r){switch(r.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return e=r.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return t=r.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[2].checkCollisions=!0,t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].position._y-=.2,t.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 3:return i=r.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(25,0,-78),i.meshes[2].checkCollisions=!0,i.meshes[0].position._y-=.2,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 4:return n=r.sent(),n.meshes[0].scaling.setAll(.4),n.meshes[0].position=new c.Pq0(90,20,-28),n.meshes[0].rotate(c.Pq0.Up(),3.1),n.meshes[0].rotate(c.Pq0.Up(),3*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 5:return a=r.sent(),a.meshes[0].scaling.setAll(.4),a.meshes[2].checkCollisions=!0,a.meshes[0].position=new c.Pq0(66,0,18),a.meshes[0].rotate(c.Pq0.Up(),3.1),a.meshes[0].rotate(c.Pq0.Up(),Math.PI),[4,c.cng.ImportMeshAsync("","./models/","aya.glb")];case 6:return s=r.sent(),s.meshes[0].scaling.setAll(.4),s.meshes[0].position=new c.Pq0(88,20,-28),s.meshes[0].rotate(c.Pq0.Up(),3.1),s.meshes[0].rotate(c.Pq0.Up(),Math.PI/8),s.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToTransitionCutsceneAya",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new M(this.canvas);this.engine.stopRenderLoop(),this.scene&&this.scene.dispose(),this.scene=e.scene}}),e}(),I=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Nazrin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Doremy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return i.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=i.sent(),this.Doremy=e.meshes[0],this.Doremy.scaling.setAll(.4),this.Doremy.position=new c.Pq0(69,0,16),this.Doremy.rotate(c.Pq0.Up(),3.1),this.Doremy.rotate(c.Pq0.Up(),5*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 3:return t=i.sent(),this.Nazrin=t.meshes[0],this.Nazrin.scaling.setAll(.4),this.Nazrin.position=new c.Pq0(66,0,18),this.Nazrin.rotate(c.Pq0.Up(),3.1),this.Nazrin.rotate(c.Pq0.Up(),Math.PI),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(69,0,19),this.Reimu.position._z+=.5,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/4),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(64,2,13),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/16,Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Nazrin: Ow, my head hurts... What happened to me?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Nazrin_sad.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="grey",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0*e,value:new c.Pq0(64,2,13)}),s.push({frame:6*e,value:new c.Pq0(64,2,13)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 2:return o.sent(),document.body.appendChild(t),document.body.appendChild(n),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: You were stuck inside your dream, but Reimu got you out without much casualties."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 4:return o.sent(),this.Nazrin.rotate(c.Pq0.Up(),Math.PI),t.removeChild(i),i=document.createTextNode("Nazrin: Really? Thank you Reimu. I was so bored of that dream."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: You mean you remember what happened?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Why would I want to live in a world where I own everything? I'm a dowser, not a god!"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_sad.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: You can't really control what's happening in your dreams..."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Glad it's over at least."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 9:return o.sent(),this.Doremy.rotate(c.Pq0.Up(),Math.PI/4),t.removeChild(i),i=document.createTextNode("Doremy: Our work isn't done Reimu. others persons are in danger!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/4),t.removeChild(i),i=document.createTextNode("Reimu: Fine. Where do we need to go next?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 11:return o.sent(),this.Doremy.rotate(c.Pq0.Up(),Math.PI),t.removeChild(i),i=document.createTextNode("Doremy: On top of this mountain. Someone there is stuck inside a dream."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",s=[],s.push({frame:0*e,value:new c.Pq0(64,2,13)}),s.push({frame:2*e,value:new c.Pq0(70,5,3)}),s.push({frame:4*e,value:new c.Pq0(70,5,3)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(-Math.PI/14,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/14,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I really wished we didn't have to go to youkai mountain..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(70,5,3)}),s.push({frame:4*e,value:new c.Pq0(70,5,3)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/14,3*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/14,3*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: You have to save another person? Good luck then!"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 14:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToThirdHubScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToThirdHubScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop(),this.scene=new A(this.canvas).scene}}),e}(),x=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shooting",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageTwoScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateStageTwoScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.engine.stopRenderLoop();var e=new c.Z58(this.engine),t=new c.g4z("hemiLight",new c.Pq0(0,1,1),e);t.intensity=1,this.CreateCamera(e),this.camera.position=new c.Pq0(10,10,0),this.CreateStageTwoMap(),this.CreateReimuStageTwo();var i=c.PeD.CreateBox("wall",{size:50});i.position=new c.Pq0(-40,0,-70),i.checkCollisions=!0,i.visibility=0;var n=c.PeD.CreateBox("wall",{size:50});n.position=new c.Pq0(-40,0,10),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:50});a.position=new c.Pq0(-65,0,-35),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:50});s.position=new c.Pq0(5,0,-35),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:50});return r.position=new c.Pq0(-40,45,-35),r.checkCollisions=!0,r.visibility=0,e}}),Object.defineProperty(e.prototype,"CreateStageTwoMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){function e(e){u.width="".concat(e/100*160,"px")}var t,i,n,a,s,r,h,u,m=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_2.glb")];case 1:return t=o.sent(),t.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 2:return i=o.sent(),i.meshes[0].scaling.setAll(.2),i.meshes[0].position=new c.Pq0(-37,5,-33),i.meshes[0].rotate(c.Pq0.Up(),3.1),n=30,[4,(0,c.KcJ)("music","audio/06.AttheHarborofSpring.mp3",{volume:.25})];case 3:return a=o.sent(),a.play(),[4,c.cng.ImportMeshAsync("","./models/","needles.glb")];case 4:return s=o.sent(),r=l.vs.CreateFullscreenUI("UI"),h=new l.tN,h.width="170px",h.height="20px",h.color="white",h.thickness=2,h.background="black",h.verticalAlignment=l.Ec.VERTICAL_ALIGNMENT_TOP,r.addControl(h),u=new l.tN,u.width="160px",u.height="14px",u.horizontalAlignment=l.Ec.HORIZONTAL_ALIGNMENT_LEFT,u.background="grey",h.addControl(u),this.scene.onPointerDown=function(e){if(0===e.button&&0==m.shooting){m.engine.enterPointerlock();var t=m.Reimu.position._x,i=m.Reimu.position._y,n=m.Reimu.position._z;s.meshes[0].position._x=t-2,s.meshes[0].position._y=i,s.meshes[0].position._z=n}1===e.button&&m.engine.exitPointerlock()},s.meshes[0].scaling.setAll(.5),s.meshes[0].position=new c.Pq0(30,200,-20),setTimeout((function(){m.scene.onBeforeRenderObservable.add((function(){if(s.meshes[0].moveWithCollisions(s.meshes[0].right.scaleInPlace(.6)),s.meshes[2].intersectsMesh(i.meshes[2])&&(s.meshes[0].position=new c.Pq0(30,200,-20),n-=1,e(100*n/30)),t.meshes.forEach((function(e){(s.meshes[2].intersectsMesh(e)||s.meshes[0].position._x<=-38)&&(s.meshes[0].position=new c.Pq0(30,200,-20))})),0==n){n--,i.meshes[0].visibility=0;var r=document.createElement("div"),o=document.createTextNode("Boss Defeated");r.appendChild(o),r.style.position="absolute",r.style.top="60%",r.style.left="50%",r.style.transform="translate(-50%, -0%)",r.style.margin="auto",r.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",r.style.fontSize="20px",r.style.width="500px",r.style.height="150px",r.style.borderRadius="20px",r.style.textAlign="center",r.style.alignContent="center",r.style.borderColor="red",r.style.borderStyle="ridge",r.style.fontFamily="Lucida Console",document.body.appendChild(r),setTimeout((function(){document.body.removeChild(r),a.stop(),m.switchTransitionCutsceneNazrinEnd()}),3e3)}}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageTwo",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v,C,q,M,A,I,x,R,T,S,O,k,N,_,D,z,j,L,K,E,B,U=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(-25,5,-33),this.Reimu.scaling.setAll(.2),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.1,r=.1,l=.05,h=.03,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.shooting=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f-=2,U.shooting=f>=10?1:0,U.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.005,-s),U.Reimu.moveWithCollisions(U.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.005,p),U.Reimu.moveWithCollisions(U.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.001,-h),U.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.001,h),U.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.005,r),U.Reimu.moveWithCollisions(U.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.005,-r),U.Reimu.moveWithCollisions(U.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.005,0):b<0&&(b=Math.min(b+.005,0))),g.q||g.d||(w>0&&(w=Math.max(w-.001,0)),w<0&&(w=Math.min(w+.001,0))),g.c||g.v||(y>0&&(y=Math.max(y-.005,0)),y<0&&(y=Math.min(y+.005,0))))})),this.Reimu.checkCollisions=!0,v=new c.FUi("mat"),v.diffuseColor=new c.v9j(1,.9,.9),C=c.PeD.CreateSphere("bull"),C.position=new c.Pq0(14,200,-20),C.material=v,q=c.PeD.CreateSphere("bull"),q.position=new c.Pq0(14,200,-20),q.material=v,M=c.PeD.CreateSphere("bull"),M.position=new c.Pq0(14,200,-20),M.material=v,A=c.PeD.CreateSphere("bull"),A.position=new c.Pq0(14,200,-20),A.material=v,I=c.PeD.CreateSphere("bull"),I.position=new c.Pq0(14,200,-20),I.material=v,x=c.PeD.CreateSphere("bull"),x.position=new c.Pq0(14,200,-20),x.material=v,R=c.PeD.CreateSphere("bull"),R.position=new c.Pq0(14,200,-20),R.material=v,T=c.PeD.CreateSphere("bull"),T.position=new c.Pq0(14,200,-20),T.material=v,S=c.PeD.CreateSphere("bull"),S.position=new c.Pq0(14,200,-20),S.material=v,O=c.PeD.CreateSphere("bull"),O.position=new c.Pq0(14,200,-20),O.material=v,k=c.PeD.CreateSphere("bull"),k.position=new c.Pq0(14,200,-20),k.material=v,N=c.PeD.CreateSphere("bull"),N.position=new c.Pq0(14,200,-20),N.material=v,_=c.PeD.CreateSphere("bull"),_.position=new c.Pq0(14,200,-20),_.material=v,D=c.PeD.CreateSphere("bull"),D.position=new c.Pq0(14,200,-20),D.material=v,z=c.PeD.CreateSphere("bull"),z.position=new c.Pq0(14,200,-20),z.material=v,j=298,L=.17,K=this.Reimu.position.subtract(C.position).normalize(),E=this.Reimu.position.subtract(C.position).normalize(),B=this.Reimu.position.subtract(C.position).normalize(),setTimeout((function(){U.scene.onBeforeRenderObservable.add((function(){0==j&&(C.position=new c.Pq0(-35,5,-33),q.position=new c.Pq0(-35,5,-30),M.position=new c.Pq0(-35,5,-28),A.position=new c.Pq0(-35,5,-35),I.position=new c.Pq0(-35,5,-38),K=U.Reimu.position.subtract(C.position).normalize(),j=400),C.position.addInPlace(K.scale(L)),q.position.addInPlace(K.scale(L)),M.position.addInPlace(K.scale(L)),A.position.addInPlace(K.scale(L)),I.position.addInPlace(K.scale(L)),350==j&&(x.position=new c.Pq0(-35,7,-33),R.position=new c.Pq0(-35,7,-31),T.position=new c.Pq0(-35,6,-29),S.position=new c.Pq0(-35,6,-35),O.position=new c.Pq0(-35,7,-36),E=U.Reimu.position.subtract(x.position).normalize()),x.position.addInPlace(E.scale(L)),R.position.addInPlace(E.scale(L)),T.position.addInPlace(E.scale(L)),S.position.addInPlace(E.scale(L)),O.position.addInPlace(E.scale(L)),300==j&&(k.position=new c.Pq0(-35,4,-33),N.position=new c.Pq0(-35,3,-30),_.position=new c.Pq0(-35,4,-28),D.position=new c.Pq0(-35,4,-35),z.position=new c.Pq0(-35,3,-38),B=U.Reimu.position.subtract(k.position).normalize()),k.position.addInPlace(B.scale(L)),N.position.addInPlace(B.scale(L)),_.position.addInPlace(B.scale(L)),D.position.addInPlace(B.scale(L)),z.position.addInPlace(B.scale(L)),j-=2,t[2].intersectsMesh(C)&&0==f&&(f=256,C.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(q)&&0==f&&(f=256,q.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(M)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(A)&&0==f&&(f=256,A.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(I)&&0==f&&(f=256,I.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(x)&&0==f&&(f=256,x.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(R)&&0==f&&(f=256,R.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(T)&&0==f&&(f=256,T.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(S)&&0==f&&(f=256,S.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(O)&&0==f&&(f=256,O.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(k)&&0==f&&(f=256,k.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(N)&&0==f&&(f=256,N.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(_)&&0==f&&(f=256,_.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(D)&&0==f&&(f=256,D.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(z)&&0==f&&(f=256,z.position=new c.Pq0(14,200,-20))}))}),500),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",0,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchTransitionCutsceneNazrinEnd",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new I(this.canvas).scene;this.scene=e}}),e}(),R=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageTwoScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateStageTwoScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()};var n=60,a=-9.81;t.collisionsEnabled=!0,t.enablePhysics(new c.Pq0(0,a/n,0)),this.CreateCamera(t),this.CreateStageTwoMap(),this.CreateReimuStageTwo();var s=c.PeD.CreateBox("wall",{size:50});s.position=new c.Pq0(-40,0,-70),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:50});r.position=new c.Pq0(-40,0,10),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:50});o.position=new c.Pq0(-65,0,-35),o.checkCollisions=!0,o.visibility=0;var l=c.PeD.CreateBox("wall",{size:50});l.position=new c.Pq0(5,0,-35),l.checkCollisions=!0,l.visibility=0;var h=c.PeD.CreateBox("wall",{size:50});return h.position=new c.Pq0(-40,45,-35),h.checkCollisions=!0,h.visibility=0,t}}),Object.defineProperty(e.prototype,"CreateStageTwoMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_2.glb")];case 1:return e=i.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 2:return t=i.sent(),t.meshes[0].scaling.setAll(.2),t.meshes[0].position=new c.Pq0(-37,5,-33),t.meshes[0].rotate(c.Pq0.Up(),3.1),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageTwo",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(-25,5,-33),this.Reimu.scaling.setAll(.2),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(-23,7,-33),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(Math.PI/4,-Math.PI/2,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Okay now, this place is a complete mess! What happened in here?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_angry.png",n.appendChild(a),a.style.height="190px",n.style.top="55%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge ",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/05.Mt.Horn.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0,value:new c.Pq0(-23,7,-33)}),s.push({frame:6*e,value:new c.Pq0(-21,9,-33)}),l.push({frame:0,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Don't call it a mess! Besides, I didn't ask you for your opinion!"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_angry.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(-21,9,-33)}),s.push({frame:4*e,value:new c.Pq0(-21,9,-33)}),l.push({frame:0,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/8,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: It's a mess, no matter how you look at it! So I will continue calling it a mess!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",l=[],l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/8,-Math.PI/2,0)}),h.setKeys(l),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: You should learn your place in this realm, human."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_casual.png",s=[],l=[],s.push({frame:0,value:new c.Pq0(-21,9,-33)}),s.push({frame:2*e,value:new c.Pq0(-34,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-34,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: I own all the capital of the world, therefore, the things out of my reach are none. I can show you what I truly mean!"),t.appendChild(i),a.src="portraits/Nazrin_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-34,6,-33)}),s.push({frame:6*e,value:new c.Pq0(-34,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: huh-huh?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: At first, we only had one mine, so we didn't have enough money..."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-34,6,-33)}),s.push({frame:2*e,value:new c.Pq0(-32,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-32,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: So I built two others!"),t.appendChild(i),a.src="portraits/Nazrin_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-32,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-32,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: How can you build a mine without gold to extract?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: With money! How else?"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_angry.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Wha-"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: With this much money, it was time to make profit!"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_casual.png",s=[],s.push({frame:0*e,value:new c.Pq0(-32,6,-33)}),s.push({frame:2*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-23,6,-33)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Therefore, I bought the lives of all the peasants of this village and built two market places, next to each other."),t.appendChild(i),a.src="portraits/Nazrin_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-23,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: That is NOT how you make profi-"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:3*e,value:new c.Pq0(-23,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),l.push({frame:3*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Then I realized we wouldn't have enough water with only one water mill..."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:2*e,value:new c.Pq0(-27,12,-18)}),s.push({frame:4*e,value:new c.Pq0(-27,12,-18)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/8,-Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/2,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: So I built two others!"),t.appendChild(i),a.src="portraits/Nazrin_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-27,12,-18)}),s.push({frame:4*e,value:new c.Pq0(-27,12,-18)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/2,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Then I had to build war buildings in order to rule the land with authority."),t.appendChild(i),a.src="portraits/Nazrin_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-27,12,-18)}),s.push({frame:2*e,value:new c.Pq0(-29,20,-42)}),s.push({frame:5*e,value:new c.Pq0(-29,20,-42)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:5*e,value:new c.Pq0(Math.PI/2,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: I had to protect my most valuable ressources, so that the peasants wouldn't lay a hand on them!"),t.appendChild(i),a.src="portraits/Nazrin_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-29,20,-42)}),s.push({frame:2*e,value:new c.Pq0(-23,15,-42)}),s.push({frame:5*e,value:new c.Pq0(-23,15,-42)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:5*e,value:new c.Pq0(Math.PI/2,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 19:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: ... Okay... And what are those mini-surrounded-by-water-hills-of-sand?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-23,15,-42)}),s.push({frame:2*e,value:new c.Pq0(-17,5,-33)}),s.push({frame:5*e,value:new c.Pq0(-17,5,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/2,0,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:5*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 20:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Seaside resorts!"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-17,5,-33)}),s.push({frame:4*e,value:new c.Pq0(-17,5,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Damn, to think your dream is worse than Cirno's..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 22:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Do you now understand the power I hold?"),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-17,5,-33)}),s.push({frame:2*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:4*e,value:new c.Pq0(-23,6,-33)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,-Math.PI/2,0)}),l.push({frame:2*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:4*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 23:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Not at all!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(-23,6,-33)}),s.push({frame:5*e,value:new c.Pq0(-23,6,-33)}),l.push({frame:0*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:5*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 24:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Of course, you are not worthy of my VISION."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 25:return o.sent(),t.removeChild(i),i=document.createTextNode("Nazrin: Well, it doesn't matter! You will not be able to refuse it anyway."),t.appendChild(i),t.style.borderColor="grey",a.src="portraits/Nazrin_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 26:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToSecondStageScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToSecondStageScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new x(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),T=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),window.addEventListener("resize",(function(){e.engine.resize})),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t;return(0,o.YH)(this,(function(i){switch(i.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return i.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=i.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(69,0,16),e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Up(),5*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 3:return t=i.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(66,0,18),t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(69,0,19),this.Reimu.position._z+=.5,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/4),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(62,5,18),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/4,Math.PI/2,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Oh, it's Nazrin. What was she doing here?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_surprised.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return l=o.sent(),l.play(),s.push({frame:0*e,value:new c.Pq0(62,5,18)}),s.push({frame:5*e,value:new c.Pq0(62,5,18)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: You recognize her, Reimu?"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 3:return o.sent(),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/4),t.removeChild(i),i=document.createTextNode("Reimu: Yeah, she is a professional dowser, and she can find pretty much any forgotten item."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: A dowser, huh? I wonder what her dream might be..."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Yeah, it might be interesting to look at."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),this.Reimu.rotate(c.Pq0.Up(),Math.PI/4),t.removeChild(i),i=document.createTextNode("Reimu: Let's not waste anymore time, let's go!"),t.appendChild(i),a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 7:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),l.stop(),this.switchToSecondStageCutscene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToSecondStageCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new R(this.canvas).scene;this.scene=e}}),e}(),S=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine=new c.N$8(this.canvas,!0);var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=2,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu();var n=c.PeD.CreateBox("wall",{size:100});n.position=new c.Pq0(56,50,-143),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:100});a.position=new c.Pq0(56,50,89),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:150});s.position=new c.Pq0(181,50,-30),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:150});r.position=new c.Pq0(-69,50,-30),r.checkCollisions=!0,r.visibility=0;var l=c.PeD.CreateBox("wall",{size:300});return l.position=new c.Pq0(20,250,-20),l.checkCollisions=!0,l.visibility=0,function(){(0,o.sH)(e,void 0,void 0,(function(){var e,t,i=this;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,c.KcJ)("music","audio/02.RescueTeamBase.mp3",{volume:.15,loop:!0})];case 1:return e=n.sent(),e.play(),t=c.PeD.CreateSphere("trigger",{diameter:15}),t.visibility=0,t.position=new c.Pq0(69,0,16),setTimeout((function(){i.scene.registerBeforeRender((function(){t.intersectsMesh(i.Reimu)&&(e.stop(),i.switchToTransitionCutsceneNazrin())}))}),2e3),[2]}}))}))}(),t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",Math.PI/2,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(27,1,-74),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f--,v.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),v.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),v.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return e=s.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return t=s.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[2].checkCollisions=!0,t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].position._y-=.2,t.meshes[0].rotate(c.Pq0.Up(),Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 3:return i=s.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(25,0,-78),i.meshes[2].checkCollisions=!0,i.meshes[0].position._y-=.2,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 4:return n=s.sent(),n.meshes[0].scaling.setAll(.4),n.meshes[0].position=new c.Pq0(69,0,16),n.meshes[0].rotate(c.Pq0.Up(),3.1),n.meshes[0].rotate(c.Pq0.Up(),5*Math.PI/4),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 5:return a=s.sent(),a.meshes[0].scaling.setAll(.4),a.meshes[0].position=new c.Pq0(66,0,18),a.meshes[0].rotate(c.Pq0.Up(),3.1),a.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToTransitionCutsceneNazrin",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new T(this.canvas);this.engine.stopRenderLoop(),this.scene&&this.scene.dispose(),this.scene=e.scene}}),e}(),O=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Rumia",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Cirno",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Doremy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n;return(0,o.YH)(this,(function(a){switch(a.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return a.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=a.sent(),this.Doremy=e.meshes[0],this.Doremy.scaling.setAll(.4),this.Doremy.position=new c.Pq0(27,0,-71),this.Doremy.position._y-=.2,this.Doremy.rotate(c.Pq0.Up(),3.1),this.Doremy.rotate(c.Pq0.Up(),5*Math.PI/8),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 3:return t=a.sent(),this.Cirno=t.meshes[0],this.Cirno.scaling.setAll(.4),this.Cirno.position=new c.Pq0(25,0,-75),this.Cirno.position._y-=.2,this.Cirno.rotate(c.Pq0.Up(),3.1),this.Cirno.rotate(c.Pq0.Up(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 4:return i=a.sent(),this.Rumia=i.meshes[0],this.Rumia.scaling.setAll(.4),this.Rumia.position=new c.Pq0(23,0,-75),this.Rumia.position._y-=.2,this.Rumia.rotate(c.Pq0.Up(),3.1),this.Rumia.rotate(c.Pq0.Up(),-Math.PI/8),[4,c.cng.ImportMeshAsync("","./models/","nazrin.glb")];case 5:return n=a.sent(),n.meshes[0].scaling.setAll(.4),n.meshes[0].position=new c.Pq0(66,0,18),n.meshes[0].rotate(c.Pq0.Up(),3.1),n.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(27,0,-74),this.Reimu.position._y-=.2,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/8),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(22,1,-71),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/16,3*Math.PI/4,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Cirno: Ow... Why is Reimu beating me up even in my dreams?"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Cirno_sad.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="blue",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(22,1,-71)}),s.push({frame:6*e,value:new c.Pq0(22,1,-71)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 2:return o.sent(),document.body.appendChild(t),document.body.appendChild(n),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: You're awake, Cirno! I'm so happy!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Can we go play now?"),t.appendChild(i),a.src="portraits/Rumia_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),this.Cirno.rotate(c.Pq0.Up(),-Math.PI/2),t.removeChild(i),i=document.createTextNode("Cirno: Rumia? what do you mean? I was asleep?"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Yeah! And Reimu went in your dream to knock you down to wake you up!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_happy.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 7:return o.sent(),this.Cirno.rotate(c.Pq0.Up(),2*Math.PI/3),t.removeChild(i),i=document.createTextNode("Cirno: I don't really get what Rumia said, but thanks for your help Reimu!"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Don't mention it. It was actually a great way for me to unwind."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: And now that it's over, I can FINALLY take a break!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),this.Rumia.rotate(c.Pq0.Up(),-Math.PI/8),this.Reimu.rotate(c.Pq0.Up(),4*Math.PI/8),t.removeChild(i),i=document.createTextNode("Doremy: That, I fear, Reimu, is not possible for now!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(22,1,-71)}),s.push({frame:2*e,value:new c.Pq0(20,1,-72)}),s.push({frame:6*e,value:new c.Pq0(20,1,-72)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,3*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,3*Math.PI/5,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,3*Math.PI/5,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Is that so?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_surprised.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-72)}),s.push({frame:6*e,value:new c.Pq0(20,1,-72)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,3*Math.PI/5,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,3*Math.PI/5,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: And WHY is that so?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Cirno isn't an isolated case, you see, other persons are currently stuck inside of their dreams."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: I-Is that so?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_surprised.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: But WHY are we stuck inside of our dreams?"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I know what's the reason, but I don't know what's causing this. It could be because of an unknowned influence."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: But even if we don't know what's causing this, we still have to help the persons in danger, Reimu!"),t.appendChild(i),a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 18:return o.sent(),this.Rumia.rotate(c.Pq0.Left(),Math.PI),this.Rumia.position._y+=1.6,t.removeChild(i),i=document.createTextNode("Rumia: (Is that so)?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_reversed.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 19:return o.sent(),this.Rumia.rotate(c.Pq0.Left(),Math.PI),this.Rumia.position._y-=1.6,t.removeChild(i),i=document.createTextNode("Reimu: Fine. It's my job to take care of this after all."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 20:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I am able to locate the persons asleep thanks to the wavelengths of their dreams."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: One is located inside that forest. Join me there when you are ready."),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,1,-72)}),s.push({frame:3*e,value:new c.Pq0(30,15,-20)}),s.push({frame:6*e,value:new c.Pq0(30,15,-20)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,3*Math.PI/5,0)}),l.push({frame:3*e,value:new c.Pq0(Math.PI/8,Math.PI/4,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/8,Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 22:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToSecondHubScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToSecondHubScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop(),this.scene=new S(this.canvas).scene}}),e}(),k=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shooting",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageOneScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateStageOneScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.engine.stopRenderLoop();var e=new c.Z58(this.engine),t=new c.g4z("hemiLight",new c.Pq0(0,1,0),e);t.intensity=1,e.collisionsEnabled=!0,this.CreateCamera(e),this.camera.position=new c.Pq0(10,10,0),this.CreateReimuStageOne(),this.CreateStageOneMap();var i=c.PeD.CreateBox("wall",{size:40});i.position=new c.Pq0(20,10,-60),i.checkCollisions=!0,i.visibility=0;var n=c.PeD.CreateBox("wall",{size:40});n.position=new c.Pq0(20,10,20),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:40});a.position=new c.Pq0(60,10,-20),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:40});s.position=new c.Pq0(-20,10,-20),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:40});return r.position=new c.Pq0(20,50,-20),r.checkCollisions=!0,r.visibility=0,e.audioEnabled=!0,e}}),Object.defineProperty(e.prototype,"CreateStageOneMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){function e(e){u.width="".concat(e/100*140,"px")}var t,i,n,a,s,r,h,u,m=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_1.glb")];case 1:return t=o.sent(),t.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return i=o.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(12,20,-20),i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[2].checkCollisions=!0,n=20,[4,(0,c.KcJ)("music","audio/04.TomboyishGirlinLove.mp3",{volume:.25})];case 3:return a=o.sent(),a.play(),[4,c.cng.ImportMeshAsync("","./models/","needles.glb")];case 4:return s=o.sent(),r=l.vs.CreateFullscreenUI("UI"),h=new l.tN,h.width="150px",h.height="20px",h.color="white",h.thickness=2,h.background="black",h.verticalAlignment=l.Ec.VERTICAL_ALIGNMENT_TOP,r.addControl(h),u=new l.tN,u.width="140px",u.height="14px",u.horizontalAlignment=l.Ec.HORIZONTAL_ALIGNMENT_LEFT,u.background="cyan",h.addControl(u),this.scene.onPointerDown=function(e){if(0===e.button&&0==m.shooting){m.engine.enterPointerlock();var t=m.Reimu.position._x,i=m.Reimu.position._y,n=m.Reimu.position._z;s.meshes[0].position._x=t-2,s.meshes[0].position._y=i,s.meshes[0].position._z=n}1===e.button&&m.engine.exitPointerlock()},s.meshes[0].scaling.setAll(.8),s.meshes[0].position=new c.Pq0(30,200,-20),setTimeout((function(){m.scene.onBeforeRenderObservable.add((function(){if(s.meshes[0].moveWithCollisions(s.meshes[0].right.scaleInPlace(.6)),s.meshes[2].intersectsMesh(i.meshes[2])&&(s.meshes[0].position=new c.Pq0(30,200,-20),n-=1,e(100*n/20)),t.meshes.forEach((function(e){(s.meshes[2].intersectsMesh(e)||s.meshes[0].position._x<=10)&&(s.meshes[0].position=new c.Pq0(30,200,-20))})),0==n){n--,i.meshes[0].visibility=0;var r=document.createElement("div"),o=document.createTextNode("Boss Defeated");r.appendChild(o),r.style.position="absolute",r.style.top="60%",r.style.left="50%",r.style.transform="translate(-50%, -0%)",r.style.margin="auto",r.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",r.style.fontSize="20px",r.style.width="500px",r.style.height="150px",r.style.borderRadius="20px",r.style.textAlign="center",r.style.alignContent="center",r.style.borderColor="red",r.style.borderStyle="ridge",r.style.fontFamily="Lucida Console",document.body.appendChild(r),setTimeout((function(){document.body.removeChild(r),a.stop(),m.switchTransitionCutsceneCirnoEnd()}),3e3)}}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageOne",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v,C,q,M,A,I,x,R,T,S,O,k=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(35,11,-21),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.shooting=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f-=2,k.shooting=f>=10?1:0,k.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),k.Reimu.moveWithCollisions(k.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),k.Reimu.moveWithCollisions(k.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),k.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),k.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),k.Reimu.moveWithCollisions(k.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),k.Reimu.moveWithCollisions(k.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),this.Reimu.checkCollisions=!0,v=c.PeD.CreateSphere("bull"),v.position=new c.Pq0(14,200,-20),C=c.PeD.CreateSphere("bull"),C.position=new c.Pq0(14,200,-20),q=c.PeD.CreateSphere("bull"),q.position=new c.Pq0(14,200,-20),M=c.PeD.CreateSphere("bull"),M.position=new c.Pq0(14,200,-20),A=c.PeD.CreateSphere("bull"),A.position=new c.Pq0(14,200,-20),I=0,x=this.Reimu.position.subtract(v.position).normalize(),R=this.Reimu.position.subtract(C.position).normalize(),T=this.Reimu.position.subtract(q.position).normalize(),S=this.Reimu.position.subtract(M.position).normalize(),O=this.Reimu.position.subtract(A.position).normalize(),setTimeout((function(){k.scene.onBeforeRenderObservable.add((function(){0==I&&(v.position=new c.Pq0(14,20,-20),x=k.Reimu.position.subtract(v.position).normalize(),I=600),v.position.addInPlace(x.scale(.14)),576==I&&(C.position=new c.Pq0(14,20,-20),R=k.Reimu.position.subtract(C.position).normalize()),C.position.addInPlace(R.scale(.14)),550==I&&(q.position=new c.Pq0(14,20,-20),T=k.Reimu.position.subtract(q.position).normalize()),q.position.addInPlace(T.scale(.14)),526==I&&(M.position=new c.Pq0(14,20,-20),S=k.Reimu.position.subtract(M.position).normalize()),M.position.addInPlace(S.scale(.14)),500==I&&(A.position=new c.Pq0(14,20,-20),O=k.Reimu.position.subtract(A.position).normalize()),A.position.addInPlace(O.scale(.14)),I-=2,t[2].intersectsMesh(v)&&0==f&&(f=256,v.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(C)&&0==f&&(f=256,C.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(q)&&0==f&&(f=256,q.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(M)&&0==f&&(f=256,M.position=new c.Pq0(14,200,-20)),t[2].intersectsMesh(A)&&0==f&&(f=256,A.position=new c.Pq0(14,200,-20))}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",0,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"switchTransitionCutsceneCirnoEnd",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new O(this.canvas).scene;this.scene=e}}),e}(),N=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateStageOneScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateStageOneScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=1,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateReimuStageOne(),this.CreateStageOneMap();var n=c.PeD.CreateBox("wall",{size:40});n.position=new c.Pq0(20,10,-60),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:40});a.position=new c.Pq0(20,10,20),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:40});s.position=new c.Pq0(60,10,-20),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:40});r.position=new c.Pq0(-20,10,-20),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:40});return o.position=new c.Pq0(20,50,-20),o.checkCollisions=!0,o.visibility=0,t}}),Object.defineProperty(e.prototype,"CreateStageOneMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e;return(0,o.YH)(this,(function(t){switch(t.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_1.glb")];case 1:return t.sent(),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return e=t.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(12,20,-20),e.meshes[0].rotate(c.Pq0.Up(),3.1),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimuStageOne",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(30,11,-21),this.Reimu.scaling.setAll(.4),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(26,13,-19),e),this.camera.checkCollisions=!1,this.camera.rotation=new c.Pq0(Math.PI/12,5*Math.PI/8,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: Wow, it's really cold in there, as expected."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_surprised.png",n.appendChild(a),a.style.height="190px",n.style.top="55%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge ",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/03.CragsofLament.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0,value:new c.Pq0(26,13,-19)}),s.push({frame:4*e,value:new c.Pq0(26,13,-19)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [Reimu! can you hear me?]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Perfectly fine. I have entered Cirno's dream, althought I thought it would be a little more animated in there."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",s=[],s.push({frame:0*e,value:new c.Pq0(26,13,-19)}),s.push({frame:2*e,value:new c.Pq0(32,12,-19)}),s.push({frame:5*e,value:new c.Pq0(32,12,-19)}),l.push({frame:0,value:new c.Pq0(Math.PI/12,5*Math.PI/8,0)}),l.push({frame:2*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:5*e,value:new c.Pq0(0,11*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Guess you can't imagine what's inside a fairy's dream."),t.appendChild(i),a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(32,12,-19)}),s.push({frame:4*e,value:new c.Pq0(32,12,-19)}),l.push({frame:0*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:0*e,value:new c.Pq0(0,11*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: [You now have to find Cirno, she can be anywhere, so stay focused!]"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: Welcome to my lair, human!"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_casual.png",l=[],l.push({frame:0*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:1*e,value:new c.Pq0(-Math.PI/16,11*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,11*Math.PI/8,0)}),h.setKeys(l),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Yep, found her."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",l=[],l.push({frame:1*e,value:new c.Pq0(-Math.PI/16,11*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,11*Math.PI/8,0)}),h.setKeys(l),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: I am the STRONGEST here, NO ONE can stand up against me!"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(32,12,-19)}),s.push({frame:2*e,value:new c.Pq0(16,21,-19)}),s.push({frame:4*e,value:new c.Pq0(16,21,-19)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,11*Math.PI/8,0)}),l.push({frame:2*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(0,11*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: Even you, a shrine maiden, can only bow down before my-aa-aaah-"),t.appendChild(i),a.src="portraits/Cirno_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(16,21,-19)}),s.push({frame:4*e,value:new c.Pq0(16,21,-19)}),l.push({frame:0*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:4*e,value:new c.Pq0(0,11*Math.PI/8,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: ATCHOO!!!"),t.appendChild(i),a.src="portraits/Cirno_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: ..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(16,21,-19)}),s.push({frame:.5*e,value:new c.Pq0(20,15,-38)}),s.push({frame:2*e,value:new c.Pq0(20,15,-38)}),l.push({frame:0*e,value:new c.Pq0(0,11*Math.PI/8,0)}),l.push({frame:.5*e,value:new c.Pq0(0,0,0)}),l.push({frame:2*e,value:new c.Pq0(0,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: How can you sneeze? You're an ICE fairy!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,15,-38)}),s.push({frame:4*e,value:new c.Pq0(20,15,-38)}),l.push({frame:0*e,value:new c.Pq0(0,0,0)}),l.push({frame:4*e,value:new c.Pq0(0,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: A 'bless you' would have been fine, you know!"),t.appendChild(i),t.style.borderColor="blue",a.src="portraits/Cirno_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Cirno: If you're not gonna praise me, then I might as well get rid of you!"),t.appendChild(i),a.src="portraits/Cirno_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Please Doremy, tell me how I can wake her up!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(20,15,-38)}),s.push({frame:3*e,value:new c.Pq0(24,15,-25)}),s.push({frame:4*e,value:new c.Pq0(24,15,-25)}),l.push({frame:0*e,value:new c.Pq0(0,0,0)}),l.push({frame:3*e,value:new c.Pq0(Math.PI/7,Math.PI/3,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/7,Math.PI/3,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: If I hear anymore from her, I could really send her dreaming inside her dream!"),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(24,15,-25)}),s.push({frame:4*e,value:new c.Pq0(24,15,-25)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/7,Math.PI/3,0)}),l.push({frame:4*e,value:new c.Pq0(Math.PI/7,Math.PI/3,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: The easiest way would be to cut the link between her and the dreamworld's version of her."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Fortunately, you can do that by knocking her out!"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 19:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Perfect! I'm an expert at this!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(24,15,-25)}),s.push({frame:4*e,value:new c.Pq0(35,12,-21)}),s.push({frame:5*e,value:new c.Pq0(35,12,-21)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/7,Math.PI/3,0)}),l.push({frame:4*e,value:new c.Pq0(0,-Math.PI/2,0)}),l.push({frame:5*e,value:new c.Pq0(0,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 20:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFirstStageScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox_d",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFirstStageScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var t=new k(this.canvas);setTimeout((function(){e.scene=t.scene}),200)}}),e}(),_=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Rumia",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Doremy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.activeCamera&&t.scene.render()})),this.CreateCutscene()}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i;return(0,o.YH)(this,(function(n){switch(n.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return n.sent(),[4,c.cng.ImportMeshAsync("","./models/","doremy.glb")];case 2:return e=n.sent(),this.Doremy=e.meshes[0],this.Doremy.scaling.setAll(.4),this.Doremy.position=new c.Pq0(32,0,-75),this.Doremy.position._y-=.2,this.Doremy.rotate(c.Pq0.Up(),3.1),this.Doremy.rotate(c.Pq0.Up(),Math.PI),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 3:return t=n.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Up(),-Math.PI/3),t.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 4:return i=n.sent(),this.Rumia=i.meshes[0],this.Rumia.scaling.setAll(.4),this.Rumia.position=new c.Pq0(24,0,-76),this.Rumia.position._y-=.2,this.Rumia.rotate(c.Pq0.Up(),3.1),this.Rumia.rotate(c.Pq0.Up(),-Math.PI/4),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(27,0,-74),this.Reimu.position._y-=.2,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Up(),-Math.PI/8),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(29,1,-77),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/16,-Math.PI/3,0),this.camera.speed=.5,e.activeCamera=this.camera}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Rumia: Look, Reimu! Cirno has been like that for several days."),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Rumia_angry.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="black",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 1:return u=o.sent(),u.play(),s.push({frame:0*e,value:new c.Pq0(29,1,-77)}),s.push({frame:6*e,value:new c.Pq0(29,1,-77)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 2:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I've never seen anything similar before."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 3:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Do you think she will wake up?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I don't know. Maybe it's a fairy thing to sleep on mud like this."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(29,1,-77)}),s.push({frame:2*e,value:new c.Pq0(34,1,-77)}),s.push({frame:6*e,value:new c.Pq0(34,1,-77)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-Math.PI/3,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,-2*Math.PI/5,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,-2*Math.PI/5,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("???: No, it isn't. It's actually much more complicated."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(34,1,-77)}),s.push({frame:6*e,value:new c.Pq0(34,1,-77)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-2*Math.PI/5,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,-2*Math.PI/5,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 6:return o.sent(),this.Rumia.rotate(c.Pq0.Up(),Math.PI/5),this.Reimu.rotate(c.Pq0.Up(),-7*Math.PI/8),t.removeChild(i),i=document.createTextNode("Reimu: Oh, look at this. We have the perfect person for the job."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Who is she?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Her name is Doremy. She has the ability to visit the dreams of anyone."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(34,1,-77)}),s.push({frame:2*e,value:new c.Pq0(30,1,-77)}),s.push({frame:6*e,value:new c.Pq0(30,1,-77)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-2*Math.PI/5,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Your friend here isn't just sleeping like usual."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(30,1,-77)}),s.push({frame:6*e,value:new c.Pq0(30,1,-77)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: But rather, she is stuck inside of her dream!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Really? How is that possible?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Well, you see, dreams are like a big box containing another box containing the thoughts of a person."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: The '3 dimension' interpretation was created 459 years ago to answer a lot of questions about dream."),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,2*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: It was during my 234564th exploration that I first used this interpretation for my observations."),t.appendChild(i),a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,1*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I remember That persons dream like it was yesterday. He dreamed of falling inside a lake and getting eaten by a giant fish! Can you imagine that?"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,1*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I then presented all of my observations to Sagume who then talked about it to Yorihime who then talked about it to Toyohime who used them to create a new device to modify the wavelengths of a dream."),t.appendChild(i),a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,.5*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: They started experimenting on moon rabbits but the wavelength of their dreams were too fragile and they were waking up far too early."),t.appendChild(i),a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,.5*e).waitAsync()];case 18:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: So we asked help from your rabbit friend from Eientei to stabilise the dream into a 'micro-capsule' state ; that was really impressive to look at. She even said her friend would be used for the experience, and that she agreed to participate!"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 19:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: However, at first, I wasn't able to enter the dream because Toyo's machine was creating a lot of interference and I was seeing a lot of cryptic messages around me."),t.appendChild(i),a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 20:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: It took so much time to fix that I got the time to remember one of the messages! it stated:"),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 21:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1000100 1001111 1001110 100111 1010100 100000 1001001 100000 1001101 1001001 1010011 1010011 100000 1011001 1001111 1010101 100000 1000001 100000 1001100 1001111 1010100 100000 1000110 1001111 1010010 1000101 1010110 1000101 1010010 111111"),t.appendChild(i),a.src="portraits/Doremy_.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 22:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I asked Toyo about it, and she said that was from a popular rock song popular on earth."),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 23:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: It could be used in an superior hexagonal to triacontakaienneagonal matrix to find the value of  with 2 digits to be able to morph a new trinary space in which all of Gensokyo and the moon could fit."),t.appendChild(i),a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 24:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: She then detailled me how we could put the dream inside this new trinary space, but I lost track when the words 'I love peaches' appeared on the screen of the machine."),t.appendChild(i),a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 25:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: When the maintenance finished, I was able to enter the dream and the modification of the wavelengths had an impact on what happened inside the dream."),t.appendChild(i),a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 26:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: It first took place in a commercial advertissement for a 'Lipovitan G energy drink' and then we were moved to a sort of theater where everyone was singing to ask Eirin for help."),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 27:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: But when I tried to exit, we realised that I couldn't escape because of the modifications we added to the wavelengths, and the path I usually take to travel was endless and a bright light was alternating between two colours permanently."),t.appendChild(i),a.src="portraits/Doremy_surprised.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 28:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Red"),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 29:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Blue"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 30:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Red"),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 31:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Blue"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 32:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: After fixing the wavelengths of the dream, I was able to get out, and we experimented for five days to find out what was happening. The determination of that rabbit was incredible but I think she got a little dizy after the 102th attempt, elle a commenc  parler avec un accent du sud en disant ''"),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 33:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: And thanks to our researchs we were able to conclude that if the wavelengths of a dream are being alternated by an exterior influence, The dream could become impossible to escape if thelink you have with your dreamworld self isn' broken."),t.appendChild(i),a.src="portraits/Doremy_casual.png",[4,this.scene.beginAnimation(this.camera,0,.3*e).waitAsync()];case 34:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Was everything clear?"),t.appendChild(i),a.src="portraits/Doremy_happy.png",[4,this.scene.beginAnimation(this.camera,0,3*e).waitAsync()];case 35:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: ..."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(30,1,-77)}),s.push({frame:1*e,value:new c.Pq0(30,1,-75)}),s.push({frame:6*e,value:new c.Pq0(30,1,-75)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),l.push({frame:1*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 36:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Reimu? Can I eat her?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(30,1,-75)}),s.push({frame:6*e,value:new c.Pq0(30,1,-75)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,-Math.PI/2,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 37:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Guess I won't get my break today."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 38:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: What you need to understand is that the bond between Cirno and her dreamworld self needs to be broken."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(30,1,-77)}),s.push({frame:2*e,value:new c.Pq0(28,1,-82)}),s.push({frame:6*e,value:new c.Pq0(28,1,-82)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(Math.PI/16,0,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 39:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: However, without a dedicated device, we can't achieve this unless we get inside her dream directly."),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(28,1,-82)}),s.push({frame:6*e,value:new c.Pq0(28,1,-82)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/16,0,0)}),l.push({frame:6*e,value:new c.Pq0(Math.PI/16,0,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 40:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Couldn't you say that from the beginning?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 41:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Then what are you waiting for to jump inside her dream head first?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 42:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Unfortunately, I am unable to interfere with one's dream, I am only allowed in as an observer."),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_sad.png",[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 43:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: I have to send one of you two inside, and I think you are more fitted for the job, Reimu."),t.appendChild(i),[4,this.scene.beginAnimation(this.camera,0,5*e).waitAsync()];case 44:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Why was I seeing it coming?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 45:return o.sent(),this.Rumia.rotate(c.Pq0.Up(),-Math.PI/8),t.removeChild(i),i=document.createTextNode("Rumia: Please Reimu, help Cirno get out of her dream!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_sad.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 46:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Ok. Ok. I imagine this isn't my day to relax."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 47:return o.sent(),t.removeChild(i),i=document.createTextNode("Doremy: Get ready, Reimu. I'm sending you straight away!"),t.appendChild(i),t.style.borderColor="purple",a.src="portraits/Doremy_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 48:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I'm ready! get me inside her dream!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 49:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),u.stop(),this.switchToFirstStageCutscene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFirstStageCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new N(this.canvas).scene;this.scene=e}}),e}(),D=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine=new c.N$8(this.canvas,!0);var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,0),t);i.intensity=2,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu();var n=c.PeD.CreateBox("wall",{size:100});n.position=new c.Pq0(56,50,-143),n.checkCollisions=!0,n.visibility=0;var a=c.PeD.CreateBox("wall",{size:100});a.position=new c.Pq0(56,50,89),a.checkCollisions=!0,a.visibility=0;var s=c.PeD.CreateBox("wall",{size:150});s.position=new c.Pq0(181,50,-30),s.checkCollisions=!0,s.visibility=0;var r=c.PeD.CreateBox("wall",{size:150});r.position=new c.Pq0(-69,50,-30),r.checkCollisions=!0,r.visibility=0;var o=c.PeD.CreateBox("wall",{size:300});return o.position=new c.Pq0(20,250,-20),o.checkCollisions=!0,o.visibility=0,t}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.Lqh("camera",Math.PI/2,Math.PI/2,12,c.Pq0.Zero(),e),this.camera.attachControl(this.canvas,!0),this.camera.checkCollisions=!0,this.camera.angularSensibilityX=3e3,this.camera.angularSensibilityY=3e3,this.camera.wheelPrecision=50,this.camera.minZ=.3,this.camera.lowerRadiusLimit=5,this.camera.upperRadiusLimit=15,this.camera.panningSensibility=0}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m,p,d,b,y,w,g,P,f,v=this;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=o.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(86,5,-14),this.Reimu.scaling.setAll(.4),this.camera.setTarget(t[2]),console.log("animations",i),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),s=.2,r=.2,l=.1,h=.05,u=5,m=.5,b=0,y=0,w=0,g={z:!1,s:!1,q:!1,d:!1,c:!1,v:!1,Shift:!1},this.scene.actionManager=new c.mjK(this.scene),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyDownTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!0)}))),this.scene.actionManager.registerAction(new c.FHw(c.mjK.OnKeyUpTrigger,(function(e){var t=e.sourceEvent.key;"Shift"!==t&&(t=t.toLowerCase()),t in g&&(g[t]=!1)}))),P=!1,f=0,this.scene.onBeforeRenderObservable.add((function(){f>0?(f--,v.Reimu.rotate(c.Pq0.Forward(),Math.PI/16)):(g.z||g.s||g.q||g.d||g.c||g.v?(P=!0,g.s&&!g.z?(b=Math.max(b-.01,-s),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))):(g.z||g.q||g.d)&&(p=g.Shift?l:s,d=g.Shift?m:u,a.speedRatio=d,b=Math.min(b+.01,p),v.Reimu.moveWithCollisions(v.Reimu.right.scaleInPlace(b))),g.q?(w=Math.max(w-.002,-h),v.Reimu.rotate(c.Pq0.Up(),w)):g.d&&(w=Math.min(w+.002,h),v.Reimu.rotate(c.Pq0.Up(),w)),g.c?(y=Math.min(y+.01,r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))):g.v&&(y=Math.max(y-.01,-r),v.Reimu.moveWithCollisions(v.Reimu.up.scaleInPlace(y))),a.start(!0,1,a.from,a.to,!1)):P&&(n.start(!0,1,n.from,n.to,!1),b=0,a.stop(),P=!1),g.z||g.s||(b>0?b=Math.max(b-.01,0):b<0&&(b=Math.min(b+.01,0))),g.q||g.d||(w>0&&(w=Math.max(w-.002,0)),w<0&&(w=Math.min(w+.002,0))),g.c||g.v||(y>0&&(y=Math.max(y-.01,0)),y<0&&(y=Math.min(y+.01,0))))})),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s=this;return(0,o.YH)(this,(function(r){switch(r.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return e=r.sent(),e.meshes.forEach((function(e){e.checkCollisions=!0})),[4,c.cng.ImportMeshAsync("","./models/","cirno.glb")];case 2:return t=r.sent(),t.meshes[0].scaling.setAll(.4),t.meshes[0].position=new c.Pq0(25,0,-75),t.meshes[0].rotate(c.Pq0.Up(),3.1),t.meshes[0].rotate(c.Pq0.Up(),-Math.PI/3),t.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/2),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 3:return i=r.sent(),i.meshes[0].scaling.setAll(.4),i.meshes[0].position=new c.Pq0(24,0,-76),i.meshes[0].position._y-=.2,i.meshes[0].rotate(c.Pq0.Up(),3.1),i.meshes[0].rotate(c.Pq0.Up(),-Math.PI/4),n=c.PeD.CreateSphere("trigger",{diameter:15}),n.visibility=0,n.position=new c.Pq0(24,0,-76),[4,(0,c.KcJ)("music","audio/02.RescueTeamBase.mp3",{volume:.15,loop:!0})];case 4:return a=r.sent(),a.play(),setTimeout((function(){s.scene.registerBeforeRender((function(){n.intersectsMesh(s.Reimu)&&(a.stop(),s.switchToTransitionCutsceneCirno())}))}),2e3),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToTransitionCutsceneCirno",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new _(this.canvas);this.engine.stopRenderLoop(),this.scene&&this.scene.dispose(),this.scene=e.scene}}),e}(),z=function(){function e(e){var t=this;Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"Reimu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.engine=new c.N$8(this.canvas,!0),this.scene=this.CreateScene(),this.CreateSkybox(),this.engine.setHardwareScalingLevel(1/window.devicePixelRatio),this.CreateCutscene(),this.engine.runRenderLoop((function(){t.scene.render()})),window.addEventListener("resize",(function(){t.engine.resize}))}return Object.defineProperty(e.prototype,"CreateScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.engine.stopRenderLoop();var t=new c.Z58(this.engine),i=new c.g4z("hemiLight",new c.Pq0(0,1,1),t);return i.intensity=1.5,t.onPointerDown=function(t){0===t.button&&e.engine.enterPointerlock(),1===t.button&&e.engine.exitPointerlock()},this.CreateCamera(t),this.CreateMap(),this.CreateReimu(),t}}),Object.defineProperty(e.prototype,"CreateMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e;return(0,o.YH)(this,(function(t){switch(t.label){case 0:return[4,c.cng.ImportMeshAsync("","./map/","scene_hub_draft.glb")];case 1:return t.sent(),[4,c.cng.ImportMeshAsync("","./models/","rumia.glb")];case 2:return e=t.sent(),e.meshes[0].scaling.setAll(.4),e.meshes[0].position=new c.Pq0(78,8,-14),e.meshes[0].rotate(c.Pq0.Up(),3.1),e.meshes[0].rotate(c.Pq0.Forward(),-Math.PI/16),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateReimu",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a;return(0,o.YH)(this,(function(s){switch(s.label){case 0:return[4,c.cng.ImportMeshAsync("","./models/","Reimu_animated.glb")];case 1:return e=s.sent(),t=e.meshes,i=e.animationGroups,this.Reimu=t[0],this.Reimu.position=new c.Pq0(86,4,-14),this.Reimu.position._z+=.5,this.Reimu.scaling.setAll(.4),this.Reimu.rotate(c.Pq0.Forward(),Math.PI/4),n=i[1],a=i[0],n.start(!0,1,n.from,n.to,!1),a.stop(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.camera=new c.SCQ("camera",new c.Pq0(83,8,-11),e),this.camera.checkCollisions=!0,this.camera.rotation=new c.Pq0(Math.PI/4,5*Math.PI/8,0),this.camera.speed=.5}}),Object.defineProperty(e.prototype,"CreateCutscene",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,o.sH)(this,void 0,Promise,(function(){var e,t,i,n,a,s,r,l,h,u,m;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return e=60,t=document.createElement("div"),i=document.createTextNode("Reimu: *sigh* I finally get to relax!"),t.appendChild(i),n=document.createElement("div"),a=new Image,a.src="portraits/Reimu_happy.png",n.appendChild(a),a.style.height="190px",n.style.top="60%",n.style.left="19%",n.style.margin="auto",n.style.position="absolute",t.style.position="absolute",t.style.top="60%",t.style.left="50%",t.style.transform="translate(-50%, -0%)",t.style.margin="auto",t.style.background="linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))",t.style.fontSize="20px",t.style.width="500px",t.style.height="150px",t.style.borderRadius="20px",t.style.textAlign="center",t.style.alignContent="center",t.style.borderColor="red",t.style.borderStyle="ridge",t.style.fontFamily="Lucida Console",document.body.appendChild(t),document.body.appendChild(n),s=[],r=new c.X55("camAnim","position",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),l=[],h=new c.X55("rotationAnim","rotation",e,c.X55.ANIMATIONTYPE_VECTOR3,c.X55.ANIMATIONLOOPMODE_CONSTANT,!0),[4,(0,c.XdT)()];case 1:return u=o.sent(),[4,(0,c.KcJ)("music","audio/01.RevolvingSecretGarden.mp3",{volume:.25})];case 2:return m=o.sent(),[4,u.unlockAsync()];case 3:return o.sent(),m.play(),s.push({frame:0,value:new c.Pq0(83,8,-11)}),s.push({frame:4*e,value:new c.Pq0(83,8,-11)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 4:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: the recent days have been rough, but I can finally get some slee-"),t.appendChild(i),s=[],l=[],s.push({frame:0*e,value:new c.Pq0(83,8,-11)}),s.push({frame:6*e,value:new c.Pq0(77,12,-11)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,6*e).waitAsync()];case 5:return o.sent(),t.removeChild(i),i=document.createTextNode("???: I finally found you, Reimu! I need your help!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_casual.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(77,12,-11)}),s.push({frame:4*e,value:new c.Pq0(77,12,-11)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 6:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Well, it was fun while it lasted."),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(77,12,-11)}),s.push({frame:4*e,value:new c.Pq0(77,12,-11)}),r.setKeys(s),this.camera.animations.push(r),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 7:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: what do you want, Rumia?"),t.appendChild(i),a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(77,12,-11)}),s.push({frame:2*e,value:new c.Pq0(81,8,-12)}),s.push({frame:4*e,value:new c.Pq0(81,8,-12)}),l.push({frame:0*e,value:new c.Pq0(Math.PI/4,5*Math.PI/8,0)}),l.push({frame:2*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 8:return o.sent(),this.Reimu.rotate(c.Pq0.Forward(),-Math.PI/4),this.Reimu.position._z+=.2,t.removeChild(i),i=document.createTextNode("Rumia: I was supposed to play with Cirno today, but she is unable to wake up! Something must have happened to her!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(81,8,-12)}),s.push({frame:4*e,value:new c.Pq0(81,8,-12)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:4*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 9:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I admit, it's a little concerning. How long has she been asleep?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_surprised.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 10:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Three days a least."),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 11:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: What?! And you haven't asked for help until now?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_angry.png",s=[],s.push({frame:0*e,value:new c.Pq0(81,8,-12)}),s.push({frame:2*e,value:new c.Pq0(87,5,-11)}),s.push({frame:4*e,value:new c.Pq0(87,5,-11)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 12:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: The previous days, we weren't supposed to play."),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_surprised.png",s=[],s.push({frame:0*e,value:new c.Pq0(87,5,-11)}),s.push({frame:4*e,value:new c.Pq0(87,5,-11)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 13:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: I shouldn't be surprised with you, and surprisingly, I am!"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 14:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Can you help me, please?"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_sad.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(87,5,-11)}),s.push({frame:2*e,value:new c.Pq0(82,7,-6)}),s.push({frame:4*e,value:new c.Pq0(82,7,-6)}),l.push({frame:0*e,value:new c.Pq0(-Math.PI/16,5*Math.PI/4,0)}),l.push({frame:2*e,value:new c.Pq0(0,Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 15:return o.sent(),t.removeChild(i),i=document.createTextNode("Reimu: Fine, I will. But next time, ask for help sooner, okay?"),t.appendChild(i),t.style.borderColor="red",a.src="portraits/Reimu_bored.png",s=[],l=[],s.push({frame:0*e,value:new c.Pq0(82,7,-6)}),s.push({frame:4*e,value:new c.Pq0(82,7,-6)}),l.push({frame:0*e,value:new c.Pq0(0,Math.PI,0)}),l.push({frame:4*e,value:new c.Pq0(0,Math.PI,0)}),r.setKeys(s),h.setKeys(l),this.camera.animations.push(r),this.camera.animations.push(h),[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 16:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: Yay! Thank you, Reimu!"),t.appendChild(i),t.style.borderColor="black",a.src="portraits/Rumia_happy.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 17:return o.sent(),t.removeChild(i),i=document.createTextNode("Rumia: I will wait for you inside the Youkai Forest (on your left) Where Cirno is!"),t.appendChild(i),a.src="portraits/Rumia_casual.png",[4,this.scene.beginAnimation(this.camera,0,4*e).waitAsync()];case 18:return o.sent(),document.body.removeChild(t),document.body.removeChild(n),m.stop(),this.switchToFirstHubScene(),[2]}}))}))}}),Object.defineProperty(e.prototype,"CreateSkybox",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=c.PeD.CreateBox("skyBox",{size:1e3},this.scene),t=new c.FUi("skyBox",this.scene);t.backFaceCulling=!1,t.disableLighting=!0,e.material=t,e.infiniteDistance=!0,t.disableLighting=!0,t.reflectionTexture=new c.b4q("textures/skybox",this.scene),t.reflectionTexture.coordinatesMode=c.gPd.SKYBOX_MODE,e.renderingGroupId=0}}),Object.defineProperty(e.prototype,"switchToFirstHubScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.dispose(),this.engine.stopRenderLoop();var e=new D(this.canvas).scene;this.scene=e}}),e}(),j=(0,a.pM)({name:"NemasuProject",mounted:function(){var e=document.querySelector("canvas");new z(e)}}),L=i(66262);const K=(0,L.A)(j,[["render",r],["__scopeId","data-v-5ccc05d3"]]);var E=K,B=(0,a.pM)({name:"App",components:{NemasuProject:E}});const U=(0,L.A)(B,[["render",s]]);var H=U;(0,n.Ef)(H).mount("#app")}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.m=e,function(){var e=[];i.O=function(t,n,a,s){if(!n){var r=1/0;for(h=0;h<e.length;h++){n=e[h][0],a=e[h][1],s=e[h][2];for(var o=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[c])}))?n.splice(c--,1):(o=!1,s<r&&(r=s));if(o){e.splice(h--,1);var l=a();void 0!==l&&(t=l)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[n,a,s]}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,r=n[0],o=n[1],c=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var h=c(i)}for(t&&t(n);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(h)},n=self["webpackChunkproj"]=self["webpackChunkproj"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(47340)}));n=i.O(n)})();
//# sourceMappingURL=app.c32f6fd0.js.map