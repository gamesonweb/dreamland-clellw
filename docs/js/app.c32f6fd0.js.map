{"version":3,"file":"js/app.c32f6fd0.js","mappings":"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","sources":["webpack://proj/./src/App.vue?c6df","webpack://proj/./src/App.vue","webpack://proj/./src/components/NemasuProject.vue?8e5a","webpack://proj/./src/components/NemasuProject.vue","webpack://proj/./src/Scenes/EndingScene.ts","webpack://proj/./src/Scenes/FifthStageScene.ts","webpack://proj/./src/Scenes/FifthStageCutscene.ts","webpack://proj/./src/Scenes/TransitionCutsceneSumireko.ts","webpack://proj/./src/Scenes/FifthHubScene.ts","webpack://proj/./src/Scenes/TransitionCutsceneSanaeEnd.ts","webpack://proj/./src/Scenes/FourthStageScene.ts","webpack://proj/./src/Scenes/FourthStageCutscene.ts","webpack://proj/./src/Scenes/TransitionCutsceneSanae.ts","webpack://proj/./src/Scenes/FourthHubScene.ts","webpack://proj/./src/Scenes/TransitionCutsceneAyaEnd.ts","webpack://proj/./src/Scenes/ThirdStageScene.ts","webpack://proj/./src/Scenes/ThirdStageCutscene.ts","webpack://proj/./src/Scenes/TransitionCutsceneAya.ts","webpack://proj/./src/Scenes/ThirdHubScene.ts","webpack://proj/./src/Scenes/TransitionCutsceneNazrinEnd.ts","webpack://proj/./src/Scenes/SecondStageScene.ts","webpack://proj/./src/Scenes/SecondStageCutscene.ts","webpack://proj/./src/Scenes/TransitionCutsceneNazrin.ts","webpack://proj/./src/Scenes/SecondHubScene.ts","webpack://proj/./src/Scenes/TransitionCutsceneCirnoEnd.ts","webpack://proj/./src/Scenes/FirstStageScene.ts","webpack://proj/./src/Scenes/FirstStageCutscene.ts","webpack://proj/./src/Scenes/TransitionCutsceneCirno.ts","webpack://proj/./src/Scenes/FirstHubScene.ts","webpack://proj/./src/Scenes/IntroCutscene.ts","webpack://proj/./src/components/NemasuProject.vue?27f4","webpack://proj/./src/App.vue?7ccd","webpack://proj/./src/main.ts","webpack://proj/webpack/bootstrap","webpack://proj/webpack/runtime/chunk loaded","webpack://proj/webpack/runtime/define property getters","webpack://proj/webpack/runtime/global","webpack://proj/webpack/runtime/hasOwnProperty shorthand","webpack://proj/webpack/runtime/make namespace object","webpack://proj/webpack/runtime/jsonp chunk loading","webpack://proj/webpack/startup"],"sourcesContent":["import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_NemasuProject = _resolveComponent(\"NemasuProject\")!\n\n  return (_openBlock(), _createBlock(_component_NemasuProject))\n}","<template>\n  <NemasuProject />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport NemasuProject from './components/NemasuProject.vue';\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    NemasuProject\n  }\n});\n</script>\n\n<style>\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n}\n</style>\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", null, _cache[0] || (_cache[0] = [\n    _createElementVNode(\"canvas\", null, null, -1)\n  ])))\n}","<template>\n  \n  <div>\n    <canvas></canvas>\n  </div>\n\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport {IntroCutscene} from '@/Scenes/IntroCutscene';\n\nexport default defineComponent({\n  name: 'NemasuProject',\n  mounted() {\n    const canvas = document.querySelector(\"canvas\")!;\n    new IntroCutscene(canvas);\n  }\n});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n\ncanvas {\n  display: block;\n  width: 80%;\n  height: 80%;\n  touch-action: none;\n  margin: auto;\n  overflow: hidden;\n}\n\nbody {\n  overflow: hidden;\n  width: 100%;\n  height: 100%;\n  padding : 0px;\n  margin: 0px;\n}\n</style>\n","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    CubeTexture,\r\n    Texture,\r\n    Vector2,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport { FireProceduralTexture } from \"@babylonjs/procedural-textures\";\r\nimport \"@babylonjs/loaders\";\r\n\r\nexport class EndingScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Sumireko!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageFiveScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    CreateStageFiveScene(): Scene {\r\n                this.engine.stopRenderLoop();\r\n                const scene = new Scene(this.engine);\r\n                const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n                hemiLight.intensity = 1;\r\n        \r\n                scene.onPointerDown = (evt) => {\r\n                    if (evt.button === 0) this.engine.enterPointerlock();\r\n                    if (evt.button === 1) this.engine.exitPointerlock();\r\n                };\r\n                \r\n                this.CreateCamera(scene);\r\n        \r\n                const ground = MeshBuilder.CreateGround(\"ground\");\r\n                ground.scaling = new Vector3(50,50,50);\r\n                ground.checkCollisions = true;\r\n        \r\n                const texture = new FireProceduralTexture('texture', 256, scene);\r\n                const mat = new StandardMaterial('mat', scene);\r\n                mat.diffuseTexture = texture;\r\n                ground.material = mat;\r\n                texture.speed = new Vector2(0.1,0.1)\r\n                texture.fireColors = [\r\n                    new Color3(0,0,1),\r\n                    new Color3(0,1,1),\r\n                    new Color3(0,1,0),\r\n                    new Color3(0,1,1),\r\n                    new Color3(1,0,0),\r\n                    new Color3(1,1,0)\r\n                ]\r\n\r\n                this.CreateStageFiveReimu();\r\n                this.CreateStageFiveMap();\r\n                \r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            const newContent = document.createTextNode(\"The End\");\r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'magenta';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Bahnschrift';\r\n            document.body.appendChild(newDiv); \r\n                return scene;\r\n        }\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(5,1,0), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(-Math.PI/25,3*Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n        async CreateStageFiveMap(): Promise<void> {\r\n        \r\n                const sumireko = await SceneLoader.ImportMeshAsync(\r\n                    \"\",\r\n                    \"./models/\",\r\n                    \"sumireko.glb\"\r\n                );\r\n                this.Sumireko = sumireko.meshes[0];\r\n                this.Sumireko.scaling.setAll(0.4);\r\n                this.Sumireko.position = new Vector3(13,0,-3);\r\n                this.Sumireko.rotate(Vector3.Up(), -3*Math.PI/4);\r\n\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/09.UndellaTown(Autumn-Winter-Spring).mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        }\r\n        async CreateStageFiveReimu(): Promise<void> {\r\n                const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                    \"\",\r\n                    \"./models/\",\r\n                    \"Reimu_animated.glb\"\r\n                  );\r\n                this.Reimu = meshes[0];\r\n                this.Reimu.position = new Vector3(12,0,-5);\r\n                this.Reimu.rotate(Vector3.Up(),-3*Math.PI/4);\r\n                this.Reimu.position._z -= 0.5;\r\n                this.Reimu.scaling.setAll(0.4);\r\n                console.log(\"animations\", animationGroups);\r\n                \r\n                const idleAnim = animationGroups[1];\r\n                const flightAnim = animationGroups[0];\r\n                idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                flightAnim.stop();\r\n        }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    Vector2,\r\n    Texture,\r\n    CubeTexture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport { FireProceduralTexture } from \"@babylonjs/procedural-textures\";\r\nimport * as GUI from '@babylonjs/gui'\r\nimport \"@babylonjs/loaders\";\r\nimport { EndingScene } from \"./EndingScene\";\r\n\r\nexport class FifthStageScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n    shooting!: number;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageFiveScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n\r\n    /* ************************************************************************* */\r\n        //methods for stage five: \r\n    \r\n        CreateStageFiveScene(): Scene {\r\n            this.engine.stopRenderLoop();\r\n            const scene = new Scene(this.engine);\r\n            const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n            hemiLight.intensity = 1;\r\n    \r\n            /*scene.onPointerDown = (evt) => {\r\n                if (evt.button === 0) this.engine.enterPointerlock();\r\n                if (evt.button === 1) this.engine.exitPointerlock();\r\n            };*/\r\n            \r\n            this.CreateCamera(scene);\r\n            this.camera.position = new Vector3(10,10,0); \r\n    \r\n            const ground = MeshBuilder.CreateGround(\"ground\");\r\n            ground.scaling = new Vector3(50,50,50);\r\n            ground.checkCollisions = true;\r\n    \r\n            const texture = new FireProceduralTexture('texture', 256, scene);\r\n            const mat = new StandardMaterial('mat', scene);\r\n            mat.diffuseTexture = texture;\r\n            ground.material = mat;\r\n            texture.speed = new Vector2(0.1,0.1)\r\n            texture.fireColors = [\r\n                new Color3(0,0,1),\r\n                new Color3(0,1,1),\r\n                new Color3(0,1,0),\r\n                new Color3(0,1,1),\r\n                new Color3(1,0,0),\r\n                new Color3(1,1,0)\r\n            ]\r\n    \r\n            \r\n            \r\n            const leftWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n            leftWall.position = new Vector3(0,10,-55);\r\n            leftWall.checkCollisions = true;\r\n            leftWall.visibility = 0;\r\n    \r\n            const rightWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n            rightWall.position = new Vector3(0,10,55);\r\n            rightWall.checkCollisions = true;\r\n            rightWall.visibility = 0;\r\n    \r\n            const backWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n            backWall.position = new Vector3(-55,10,0);\r\n            backWall.checkCollisions = true;\r\n            backWall.visibility = 0;\r\n    \r\n            const forthWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n            forthWall.position = new Vector3(55,10,0);\r\n            forthWall.checkCollisions = true;\r\n            forthWall.visibility = 0;\r\n    \r\n            const ceilling = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n            ceilling.position = new Vector3(0,60,0);\r\n            ceilling.checkCollisions = true;\r\n            ceilling.visibility = 0;\r\n    \r\n            this.CreateStageFiveReimu();\r\n            this.CreateStageFiveMap();\r\n            return scene;\r\n        }\r\n    \r\n    \r\n        async CreateStageFiveMap(): Promise<void> {\r\n    \r\n            const sumireko = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"sumireko.glb\"\r\n            );\r\n            sumireko.meshes[0].scaling.setAll(0.5);\r\n            sumireko.meshes[0].position = new Vector3(-10,7,0);\r\n            sumireko.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        let health = 55;\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/14.LastOccultism~EsotericistofthePresentWorld.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        const needles = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"needles.glb\"\r\n        );\r\n        const advancedTexture = GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\r\n\r\n        // Create a health bar container\r\n        const healthBarContainer = new GUI.Rectangle();\r\n        healthBarContainer.width = \"250px\";\r\n        healthBarContainer.height = \"20px\";\r\n        healthBarContainer.color = \"white\";\r\n        healthBarContainer.thickness = 2;\r\n        healthBarContainer.background = \"black\";\r\n        healthBarContainer.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\r\n        advancedTexture.addControl(healthBarContainer);\r\n\r\n        // Create the health bar\r\n        const healthBar = new GUI.Rectangle();\r\n        healthBar.width = \"240px\";\r\n        healthBar.height = \"14px\";\r\n        healthBar.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        healthBar.background = \"purple\";\r\n        healthBarContainer.addControl(healthBar);\r\n\r\n        // Update health bar width based on health percentage\r\n        function updateHealthBar(health:number) {\r\n            healthBar.width = `${240 * (health / 100)}px`;\r\n        }\r\n        this.scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0 && this.shooting == 0) {\r\n                    this.engine.enterPointerlock();\r\n                    const x = this.Reimu.position._x;\r\n                    const y = this.Reimu.position._y;\r\n                    const z = this.Reimu.position._z;\r\n                    needles.meshes[0].position._x = x;\r\n                    needles.meshes[0].position._y = y;\r\n                    needles.meshes[0].position._z = z;\r\n                }\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n            };\r\n\r\n        needles.meshes[0].scaling.setAll(1);\r\n        needles.meshes[0].position = new Vector3(30,200,-20);\r\nsetTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            needles.meshes[0].moveWithCollisions(needles.meshes[0].right.scaleInPlace(0.7));\r\n            if (needles.meshes[2].intersectsMesh(sumireko.meshes[2])) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n                health-=1;\r\n                updateHealthBar(health*100/55);\r\n            } \r\n            if (needles.meshes[0].position._x<=-14) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n            } \r\n            if(health == 0) {\r\n                health--;\r\n                sumireko.meshes[0].visibility = 0;\r\n                \r\n                const newDiv = document.createElement(\"div\"); \r\n                const newContent = document.createTextNode(\"Boss Defeated\");\r\n                newDiv.appendChild(newContent);\r\n                newDiv.style.position= 'absolute';\r\n                newDiv.style.top= '60%';\r\n                newDiv.style.left= \"50%\";\r\n                newDiv.style.transform= \"translate(-50%, -0%)\";\r\n                newDiv.style.margin= 'auto';\r\n                newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n                newDiv.style.fontSize= '20px';\r\n                newDiv.style.width= '500px';\r\n                newDiv.style.height= '150px';\r\n                newDiv.style.borderRadius= '20px';\r\n                newDiv.style.textAlign= 'center';\r\n                newDiv.style.alignContent= 'center';\r\n                newDiv.style.borderColor= 'red';\r\n                newDiv.style.borderStyle= 'ridge';\r\n                newDiv.style.fontFamily= 'Lucida Console';\r\n                document.body.appendChild(newDiv); \r\n                setTimeout(()=> {\r\n                    document.body.removeChild(newDiv);\r\n                    music.stop();\r\n                    this.switchToEndingScene();\r\n                }, 3000\r\n                );\r\n            }\r\n    \r\n        });\r\n    }, 2000);\r\n        }\r\n    \r\n    \r\n        async CreateStageFiveReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n              );\r\n            this.Reimu = meshes[0];\r\n            this.Reimu.position = new Vector3(12,3,0);\r\n            this.Reimu.position._z -= 0.5;\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n            this.shooting = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched-=2;\r\n                        this.shooting = (touched >=10)?1:0;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n    \r\n            const Rmat = new StandardMaterial(\"mat\");\r\n            Rmat.diffuseColor = new Color3(1,0,0);\r\n            const Bmat = new StandardMaterial(\"mat\");\r\n            Bmat.diffuseColor = new Color3(0,0,1);\r\n            const Pmat = new StandardMaterial(\"mat\");\r\n            Pmat.diffuseColor = new Color3(1,0,1);\r\n    \r\n            const bullR = MeshBuilder.CreateSphere(\"bull\");\r\n            bullR.position = new Vector3(-10,8,3);\r\n            (bullR as AbstractMesh).material = Rmat;\r\n            const bullB = MeshBuilder.CreateSphere(\"bull\");\r\n            bullB.position = new Vector3(-10,8,-3);\r\n            bullB.position._z -= 0.5;\r\n            (bullB as AbstractMesh).material = Bmat;\r\n    \r\n            const bull = MeshBuilder.CreateSphere(\"bull\");\r\n            bull.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull as AbstractMesh).material = Pmat;\r\n            const bull1 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull1.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull1 as AbstractMesh).material = Pmat;\r\n            const bull2 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull2.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull2 as AbstractMesh).material = Pmat;\r\n            const bull3 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull3.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull3 as AbstractMesh).material = Pmat;\r\n            const bull4 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull4.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull4 as AbstractMesh).material = Pmat;\r\n            const bull5 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull5.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull5 as AbstractMesh).material = Pmat;\r\n            const bull6 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull6.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull6 as AbstractMesh).material = Pmat;\r\n            const bull7 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull7.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull7 as AbstractMesh).material = Pmat;\r\n            const bull8 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull8.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull8 as AbstractMesh).material = Pmat;\r\n            const bull9 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull9.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull9 as AbstractMesh).material = Pmat;\r\n            const bull10 = MeshBuilder.CreateSphere(\"bull\");\r\n            bull10.position = new Vector3(Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3);\r\n            (bull10 as AbstractMesh).material = Pmat;\r\n    \r\n            let directionR = this.Reimu.position.subtract(bullR.position).normalize();\r\n            let directionB = this.Reimu.position.subtract(bullB.position).normalize();\r\n    \r\n            let accelR = 0.05;\r\n            let modR = 0.0005;\r\n            const speedB = 0.05;\r\n            const speedP = 0.08;\r\n            const boss = MeshBuilder.CreateSphere('boss');\r\n            boss.position = new Vector3(-10,8,0);\r\n            boss.position._z -= 0.5;\r\n            boss.visibility = 0;\r\n            const drag = 0.01;\r\n            \r\n            let directionP = boss.position.subtract(this.Reimu.position).normalize();\r\n            let direction = boss.position.subtract(bull.position).normalize();\r\n            let direction1 = boss.position.subtract(bull1.position).normalize();\r\n            let direction2 = boss.position.subtract(bull2.position).normalize();\r\n            let direction3 = boss.position.subtract(bull3.position).normalize();\r\n            let direction4 = boss.position.subtract(bull4.position).normalize();\r\n            let direction5 = boss.position.subtract(bull5.position).normalize();\r\n            let direction6 = boss.position.subtract(bull6.position).normalize();\r\n            let direction7 = boss.position.subtract(bull7.position).normalize();\r\n            let direction8 = boss.position.subtract(bull8.position).normalize();\r\n            let direction9 = boss.position.subtract(bull9.position).normalize();\r\n            let direction10 = boss.position.subtract(bull10.position).normalize();\r\n    setTimeout(() => {\r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n                directionP = boss.position.subtract(this.Reimu.position).normalize();\r\n                directionR = this.Reimu.position.subtract(bullR.position).normalize();\r\n                directionB = this.Reimu.position.subtract(bullB.position).normalize();\r\n                if(Math.abs(accelR) >= 0.10) {\r\n                    modR *= -1;\r\n                }\r\n                accelR += modR;\r\n                if(touched == 0) {\r\n                    bullR.position.addInPlace(directionR.scale(Math.abs(accelR)));\r\n                    bullB.position.addInPlace(directionB.scale(speedB));\r\n                }\r\n    \r\n                if(bull.intersectsMesh(boss)) {\r\n                    bull.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction = boss.position.subtract(bull.position).normalize();\r\n                }\r\n                if(bull1.intersectsMesh(boss)) {\r\n                    bull1.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction1 = boss.position.subtract(bull1.position).normalize();\r\n                }\r\n                if(bull2.intersectsMesh(boss)) {\r\n                    bull2.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction2 = boss.position.subtract(bull2.position).normalize();\r\n                }\r\n                if(bull3.intersectsMesh(boss)) {\r\n                    bull3.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction3 = boss.position.subtract(bull3.position).normalize();\r\n                }\r\n                if(bull4.intersectsMesh(boss)) {\r\n                    bull4.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction4 = boss.position.subtract(bull4.position).normalize();\r\n                }\r\n                if(bull5.intersectsMesh(boss)) {\r\n                    bull5.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction5 = boss.position.subtract(bull5.position).normalize();\r\n                }\r\n                if(bull6.intersectsMesh(boss)) {\r\n                    bull6.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction6 = boss.position.subtract(bull6.position).normalize();\r\n                }\r\n                if(bull7.intersectsMesh(boss)) {\r\n                    bull7.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction7 = boss.position.subtract(bull7.position).normalize();\r\n                }\r\n                if(bull8.intersectsMesh(boss)) {\r\n                    bull8.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction8 = boss.position.subtract(bull8.position).normalize();\r\n                }\r\n                if(bull9.intersectsMesh(boss)) {\r\n                    bull9.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction9 = boss.position.subtract(bull9.position).normalize();\r\n                }\r\n                if(bull10.intersectsMesh(boss)) {\r\n                    bull10.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction10 = boss.position.subtract(bull10.position).normalize();\r\n                }\r\n                bull.position.addInPlace(direction.scale(speedP*Vector3.Distance(bull.position, boss.position)));\r\n                bull1.position.addInPlace(direction1.scale(speedP*0.7*Vector3.Distance(bull1.position, boss.position)));\r\n                bull2.position.addInPlace(direction2.scale(speedP*0.3*Vector3.Distance(bull2.position, boss.position)));\r\n                bull3.position.addInPlace(direction3.scale(speedP));\r\n                bull4.position.addInPlace(direction4.scale(speedP));\r\n                bull5.position.addInPlace(direction5.scale(speedP));\r\n                bull6.position.addInPlace(direction6.scale(speedP));\r\n                bull7.position.addInPlace(direction7.scale(speedP));\r\n                bull8.position.addInPlace(direction8.scale(speedP));\r\n                bull9.position.addInPlace(direction9.scale(speedP));\r\n                bull10.position.addInPlace(direction10.scale(speedP));\r\n                this.Reimu.position.addInPlace(directionP.scale(drag));\r\n    \r\n    \r\n                if ((meshes[2].intersectsMesh(bullR) || meshes[2].intersectsMesh(bullB))&& touched == 0) {\r\n                    touched = 256;\r\n                    bullR.position = new Vector3(-10,8,3);\r\n                    bullB.position = new Vector3(-10,8,-3);\r\n                } \r\n    \r\n                if (meshes[2].intersectsMesh(bull) && touched == 0) {\r\n                    touched = 256;\r\n                    bull.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull1) && touched == 0) {\r\n                    touched = 256;\r\n                    bull1.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction1 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull2) && touched == 0) {\r\n                    touched = 256;\r\n                    bull2.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction2 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull3) && touched == 0) {\r\n                    touched = 256;\r\n                    bull3.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction3 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull4) && touched == 0) {\r\n                    touched = 256;\r\n                    bull4.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction4 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull5) && touched == 0) {\r\n                    touched = 256;\r\n                    bull5.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction5 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull6) && touched == 0) {\r\n                    touched = 256;\r\n                    bull6.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction6 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull7) && touched == 0) {\r\n                    touched = 256;\r\n                    bull7.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction7 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull8) && touched == 0) {\r\n                    touched = 256;\r\n                    bull8.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction8 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull9) && touched == 0) {\r\n                    touched = 256;\r\n                    bull9.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction9 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n                if (meshes[2].intersectsMesh(bull10) && touched == 0) {\r\n                    touched = 256;\r\n                    bull10.position = new Vector3(\r\n                        Math.random()*100/3,Math.random()*100/3,-16+Math.random()*100/3\r\n                    );\r\n                    direction10 = boss.position.subtract(bull.position).normalize();\r\n                } \r\n            })\r\n        },2000);\r\n        }\r\n\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new ArcRotateCamera(\"camera\", 0, Math.PI/2, 12, Vector3.Zero(), scene);\r\n        this.camera.attachControl(this.canvas,true);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.angularSensibilityX = 3000;\r\n        this.camera.angularSensibilityY = 3000;\r\n        this.camera.wheelPrecision = 50;\r\n        this.camera.minZ = 0.3;\r\n        this.camera.lowerRadiusLimit = 5;\r\n        this.camera.upperRadiusLimit = 15;\r\n        this.camera.panningSensibility = 0;\r\n    }\r\n\r\n    switchToEndingScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new EndingScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    CubeTexture,\r\n    Texture,\r\n    Vector2,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport { FireProceduralTexture } from \"@babylonjs/procedural-textures\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FifthStageScene } from \"./FifthStageScene\";\r\n\r\nexport class FifthStageCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Sumireko!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageFiveScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n\r\n        this.CreateCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    CreateStageFiveScene(): Scene {\r\n                this.engine.stopRenderLoop();\r\n                const scene = new Scene(this.engine);\r\n                const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n                hemiLight.intensity = 1;\r\n        \r\n                scene.onPointerDown = (evt) => {\r\n                    if (evt.button === 0) this.engine.enterPointerlock();\r\n                    if (evt.button === 1) this.engine.exitPointerlock();\r\n                };\r\n                \r\n                this.CreateCamera(scene);\r\n        \r\n                const ground = MeshBuilder.CreateGround(\"ground\");\r\n                ground.scaling = new Vector3(50,50,50);\r\n                ground.checkCollisions = true;\r\n        \r\n                const texture = new FireProceduralTexture('texture', 256, scene);\r\n                const mat = new StandardMaterial('mat', scene);\r\n                mat.diffuseTexture = texture;\r\n                ground.material = mat;\r\n                texture.speed = new Vector2(0.1,0.1)\r\n                texture.fireColors = [\r\n                    new Color3(0,0,1),\r\n                    new Color3(0,1,1),\r\n                    new Color3(0,1,0),\r\n                    new Color3(0,1,1),\r\n                    new Color3(1,0,0),\r\n                    new Color3(1,1,0)\r\n                ]\r\n        \r\n                \r\n                \r\n                const leftWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n                leftWall.position = new Vector3(0,10,-55);\r\n                leftWall.checkCollisions = true;\r\n                leftWall.visibility = 0;\r\n        \r\n                const rightWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n                rightWall.position = new Vector3(0,10,55);\r\n                rightWall.checkCollisions = true;\r\n                rightWall.visibility = 0;\r\n        \r\n                const backWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n                backWall.position = new Vector3(-55,10,0);\r\n                backWall.checkCollisions = true;\r\n                backWall.visibility = 0;\r\n        \r\n                const forthWall = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n                forthWall.position = new Vector3(55,10,0);\r\n                forthWall.checkCollisions = true;\r\n                forthWall.visibility = 0;\r\n        \r\n                const ceilling = MeshBuilder.CreateBox(\"wall\", {size:60});\r\n                ceilling.position = new Vector3(0,60,0);\r\n                ceilling.checkCollisions = true;\r\n                ceilling.visibility = 0;\r\n        \r\n                this.CreateStageFiveReimu();\r\n                this.CreateStageFiveMap();\r\n\r\n                return scene;\r\n            }\r\n        \r\n        \r\n            async CreateStageFiveMap(): Promise<void> {\r\n        \r\n                const sumireko = await SceneLoader.ImportMeshAsync(\r\n                    \"\",\r\n                    \"./models/\",\r\n                    \"sumireko.glb\"\r\n                );\r\n                this.Sumireko = sumireko.meshes[0];\r\n                this.Sumireko.scaling.setAll(0.4);\r\n                this.Sumireko.position = new Vector3(3,0,0);\r\n                //sumeriko.meshes[0].position = new Vector3(-10,7,0);\r\n                this.Sumireko.rotate(Vector3.Up(), 3.1);\r\n                this.Sumireko.rotate(Vector3.Up(), -Math.PI/2);\r\n                this.Sumireko.rotate(Vector3.Forward(), Math.PI/2);\r\n            }\r\n        \r\n            async CreateStageFiveReimu(): Promise<void> {\r\n                const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                    \"\",\r\n                    \"./models/\",\r\n                    \"Reimu_animated.glb\"\r\n                  );\r\n                this.Reimu = meshes[0];\r\n                this.Reimu.position = new Vector3(12,0,0);\r\n                //this.Reimu.position = new Vector3(12,3,0);\r\n                this.Reimu.position._z -= 0.5;\r\n                this.Reimu.scaling.setAll(0.4);\r\n                console.log(\"animations\", animationGroups);\r\n                \r\n                const idleAnim = animationGroups[1];\r\n                const flightAnim = animationGroups[0];\r\n                idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                flightAnim.stop();\r\n            }\r\n            \r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(5,1,0), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(0,Math.PI/2,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n            \r\n            const fps = 60;\r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            let newContent = document.createTextNode(\"Reimu: To think I'm currently inside of Sumireko's dream...\");\r\n            newDiv.appendChild(newContent);\r\n            \r\n            const imgDiv = document.createElement(\"div\"); \r\n            const img = new Image();\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            imgDiv.appendChild(img);\r\n            img.style.height = \"190px\";\r\n            imgDiv.style.top= '55%';\r\n            imgDiv.style.left= \"19%\";\r\n            imgDiv.style.margin= 'auto';\r\n            imgDiv.style.position= 'absolute';\r\n        \r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'red';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Lucida Console';\r\n            document.body.appendChild(newDiv); \r\n            document.body.appendChild(imgDiv); \r\n            \r\n            let camkeys = [];\r\n            const camAnim = new Animation(\r\n                \"camAnim\", \r\n                \"position\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n    \r\n            let rotkeys = [];\r\n            const rotationAnim = new Animation(\r\n                \"rotationAnim\",\r\n                \"rotation\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/13.SheerMountainRange.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            \r\n            camkeys.push({frame:0, value:new Vector3(5,1,0)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(5,1,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            this.camera.animations.push(camAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: That might be more impressive than the four previous times.\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: And for once, the sky isn't messed up. That's neat.\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [The place you're in is very unstable Reimu, and things aren't getting better outside!]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [You have to find Sumireko before things start getting out of control!]\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Well finding her isn't the problem. It was always pretty easy.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [Then what's the problem?]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Well...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(5,1,0)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(2,1,5)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(2,1,5)});\r\n            rotkeys.push({frame:0, value:new Vector3(0,Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: zzZZZZZzz\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(2,1,5)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(2,1,5)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: She is currently DREAMING \"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            img.style.height = \"210px\";\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: INSIDE \"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            img.style.height = \"250px\";\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: HER DREAM'S DREAM'S DREAM!!\"); \r\n            newDiv.appendChild(newContent);\r\n\r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            img.style.height = \"190px\";\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: How is that possible?\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [Oh! You see, it's actually very plausible! If you consider a dream like a-]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_happy.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: I DON'T WANNA KNOW THAT!!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            img.style.height = \"250px\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            img.style.height = \"190px\";\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: HOW do I wake her up?\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(2,1,5)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(9,1,2)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(9,1,2)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [W-Well, you could enter her dream's dream's dream's dream.]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(9,1,2)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(9,1,2)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Can't you have brighter ideas?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            this.Sumireko.rotate(Vector3.Forward(), -Math.PI/2);\r\n            this.Sumireko.rotate(Vector3.Up(), Math.PI/2);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: Why are you screaming like that, Reimers?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: You sure took your time, sleepy head!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(13,1,2)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(13,1,2)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,5*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Do you realise the mess you created out there?\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: Yes, I am aware of what I'm accountable for.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: I was conscious about everything that was happening. It was not a great feelling.\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(13,1,2)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(7,1,1)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(7,1,1)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,5.5*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,5.5*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: It started when Okins asked me to help her with a task.\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(7,1,1)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(7,1,1)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,5.5*Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,5.5*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Okins? You mean the Secret God?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: Yep.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: I should have gotten rid of her when I had the chance.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: She gave me weird powers, and I started feeling sleepy.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: Next thing you know, I started dreaming INSIDE my dream, and that started everything.\"); \r\n            newDiv.appendChild(newContent);\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: That must be one of her stupid tests again, she's so annoying.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n            this.Reimu.position = new Vector3(12,3,0);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Well, you don't have to worry. I'm gonna get us all out of here!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: Does that imply...?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Yep! Beating you up!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(7,1,1)});\r\n            camkeys.push({frame:1*fps, value:new Vector3(8,4,4)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(8,4,4)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,5.5*Math.PI/4,0)});\r\n            rotkeys.push({frame:1*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            this.Sumireko.position = new Vector3(-10,7,0);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: I should not expect less from you, Reimers.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(8,4,4)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(8,4,4)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sumireko: At least, that means I get to fight you! I will not back down!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'brown';\r\n            img.src = \"portraits/Sumireko_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(8,4,4)});\r\n            camkeys.push({frame:3*fps, value:new Vector3(19,4,0)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(19,4,0)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:3*fps, value:new Vector3(0,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(0,3*Math.PI/2,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFifthStageScene();\r\n    }\r\n\r\n    switchToFifthStageScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FifthStageScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FifthStageCutscene } from \"./FifthStageCutscene\";\r\n\r\nexport class TransitionCutsceneSumireko { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(9,0,-23);\r\n        doremy.meshes[0].position.y+=0.5;\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.4);\r\n        sanae.meshes[0].position = new Vector3(11,0,-23);\r\n        sanae.meshes[0].position.y+=0.5;\r\n        sanae.meshes[0].position.z-=0.5;\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const sumireko = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sumireko.glb\"\r\n        );\r\n        sumireko.meshes[0].scaling.setAll(0.4);\r\n        sumireko.meshes[0].position = new Vector3(9,0,-25);\r\n        sumireko.meshes[0].position._y += 0.5;\r\n        sumireko.meshes[0].position._z -= 0.5;\r\n        sumireko.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sumireko.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(10,0,-24);\r\n        this.Reimu.position._z +=0.8;\r\n        this.Reimu.position._y +=0.5;\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(),-Math.PI/2);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(5,3,-25), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/8,Math.PI/2,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: How did she get inside the boat in the first place?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/11.IntheFuture.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(5,3,-25)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(5,3,-25)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Maybe she wanted to take a little boat trip in the lake.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I travelled in this area all day, but I haven't seen her on this boat.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: She may have fallen asleep while you were in my dream?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Since we are in her dream, the origin of this space is centered around her.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: She hasn't moved at all, but this space was moved to her location.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: This information will not help us get out of here.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: We just have to repeat the process: Enter her dream, beat her up!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: I will accompany you this time, Reimu! Let's do this together!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I fear that It's impossible to send you both.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Really? Why?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Sumireko's dream is very unstable, and sending you both inside might shatter it.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: And Reimu has more experience now, so it's better if she goes inside.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: That means I have to stay in the backline?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Don't worry, Sanae. I will ensure that everything goes back to normal.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Alright Reimu, good luck! Though you may not need it.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFifthStageCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToFifthStageCutscene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FifthStageCutscene(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}\r\n","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Sound,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { TransitionCutsceneSumireko } from \"./TransitionCutsceneSumireko\";\r\n\r\nexport class FifthHubScene {\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        \r\n    }\r\n    \r\n    CreateScene(): Scene {\r\n        this.engine = new Engine(this.canvas, true);\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 2;\r\n\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        const framesPerSecond = 60;\r\n        const gravity = -9.81;\r\n        scene.collisionsEnabled = true;\r\n        scene.enablePhysics(new Vector3(0, gravity/framesPerSecond, 0));\r\n\r\n        this.CreateCamera(scene);\r\n        \r\n        this.CreateMap();\r\n        \r\n        this.CreateReimu();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        leftWall.position = new Vector3(56,50,-143);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n        \r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        rightWall.position = new Vector3(56,50,89);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n        \r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        forthWall.position = new Vector3(181,50,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        backWall.position = new Vector3(-69,50,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n        \r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:300});\r\n        ceilling.position = new Vector3(20,250,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        (async () => {\r\n        const music = await CreateSoundAsync(\"music\",\r\n                \"audio/12.UpperSteamCave.mp3\",\r\n                {\r\n                    volume: 0.15,\r\n                    loop:true\r\n                }\r\n            );\r\n        music.play();\r\n        const trigger = MeshBuilder.CreateSphere(\"trigger\", {diameter: 15});\r\n        trigger.visibility = 0;\r\n        trigger.position = new Vector3(9,0,-23);\r\n        setTimeout(() => {\r\n            this.scene.registerBeforeRender(() => {\r\n                if(trigger.intersectsMesh(this.Reimu)) {music.stop();this.switchToTransitionCutsceneSumireko();}\r\n            });\r\n        }, 2000);\r\n    })();\r\n        return scene;\r\n\r\n    }\r\n\r\n        CreateCamera(scene: Scene): void {\r\n            this.camera = new ArcRotateCamera(\"camera\", Math.PI/2, Math.PI/2, 12, Vector3.Zero(), scene);\r\n            this.camera.attachControl(this.canvas,true);\r\n            this.camera.checkCollisions = true;\r\n            this.camera.angularSensibilityX = 3000;\r\n            this.camera.angularSensibilityY = 3000;\r\n            this.camera.wheelPrecision = 50;\r\n            this.camera.minZ = 0.3;\r\n            this.camera.lowerRadiusLimit = 5;\r\n            this.camera.upperRadiusLimit = 15;\r\n            this.camera.panningSensibility = 0;\r\n        }\r\n    \r\n    \r\n        async CreateReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n            );\r\n            this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(96,13,-72);\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched--;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n        }\r\n    \r\n        async CreateMap(): Promise<void> {\r\n            const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n            map.meshes.forEach((mesh) => {\r\n                // Enable collisions for each imported mesh\r\n                mesh.checkCollisions = true;\r\n            });\r\n            \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[2].checkCollisions = true;\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].position._y-=0.2;\r\n        cirno.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(25,0,-78);\r\n        rumia.meshes[2].checkCollisions = true;\r\n        rumia.meshes[0].position._y-=0.2;\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        \r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(9,0,-23);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[2].checkCollisions = true;\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), Math.PI);\r\n\r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        aya.meshes[0].scaling.setAll(0.4);\r\n        aya.meshes[2].checkCollisions = true;\r\n        aya.meshes[0].position = new Vector3(88,20,-28);\r\n        aya.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        aya.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.4);\r\n        sanae.meshes[2].checkCollisions = true;\r\n        sanae.meshes[0].position = new Vector3(97,12,-70);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3*Math.PI/4);\r\n        \r\n        const sumireko = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sumireko.glb\"\r\n        );\r\n        sumireko.meshes[0].scaling.setAll(0.4);\r\n        sumireko.meshes[0].position = new Vector3(9,0,-25);\r\n        sumireko.meshes[0].position._y += 0.5;\r\n        sumireko.meshes[0].position._z -= 0.5;\r\n        sumireko.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sumireko.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n        \r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToTransitionCutsceneSumireko() {\r\n        const next = new TransitionCutsceneSumireko(this.canvas);\r\n        this.engine.stopRenderLoop();\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.scene = next.scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FifthHubScene } from \"./FifthHubScene\";\r\n\r\nexport class TransitionCutsceneSanaeEnd { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Sanae!: AbstractMesh;\r\n    skyboxMaterial!: StandardMaterial;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(95,12,-72);\r\n        doremy.meshes[0].position._x-=0.3;\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 15*Math.PI/8);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        this.Sanae = sanae.meshes[0];\r\n        this.Sanae.scaling.setAll(0.4);\r\n        this.Sanae.position = new Vector3(98,12,-71);\r\n        this.Sanae.rotate(Vector3.Up(), 3.1);\r\n        this.Sanae.rotate(Vector3.Up(), 3*Math.PI/4);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(96,12,-70);\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -3*Math.PI/5);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(97,14,-75), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/12,-Math.PI/16,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: Now, where do we need to go, Doremy?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        \r\n            camkeys = [];\r\n            rotkeys = [];\r\n\r\n        let music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys.push({frame:0*fps, value:new Vector3(97,14,-75)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(97,14,-75)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Well, I don't sense anyone dreaming right now.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Great! That means we can start looking for the culprit.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Where do we start? do I have to fall asleep to drag him to me?\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Maybe that could-\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,1*fps).waitAsync();\r\n        \r\n        this.Sanae.rotate(Vector3.Up(), Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: OBJECTION!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: W-why did you scream at me?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Sorry! I really wanted to say that.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: But there is actually no need for you to fall asleep, Reimu. In fact...\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Sanae.rotate(Vector3.Up(), Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: You are already inside a dream!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Sanae_angry.png\";\r\n        \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(97,14,-75)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(97,13,-75)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(97,13,-75)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/12,-Math.PI/16,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        music.stop();\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: ...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(97,13,-75)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(96.2,13,-72)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: W-What?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(96.2,13,-72)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(96.2,13,-72)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n            this.SwitchSkybox();\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(96.2,13,-72)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(98,14.5,-75)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(98,14.5,-75)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/16,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,-Math.PI/8,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/8,-Math.PI/8,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n        music = await CreateSoundAsync(\"music\",\r\n            \"audio/11.IntheFuture.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Wait... Are we really!?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(98,14.5,-75)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(98,14.5,-75)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/8,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/8,-Math.PI/8,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n        this.Sanae.rotate(Vector3.Up(), -Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: When I realised something seemed off with this place, I decided to fall asleep to try and find out what's happening.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Turns out the feeling I had in my dream is the same I have right now!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Sanae_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: You didn't realise it Reimu because the dreams you were in were not 'yours'.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/5);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I didn't get that last part, but when you said 'something seemed off', you meant...?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Yes, this place has a lot of oddities.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: The Moriya Shrine and the Scarlet Devil Mansion are absent, the Youkai mountain is shaped differently, and more.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: I then realised we might be inside a dream, because dreams are not exactly like reality!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Sanae_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: How did I not realise that? I fell ashamed of myself.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Don't feel like that. You were just fooled by your interpretation of this place, like all of us.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: But who is responsible for...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Dreams... like reality?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Did you realise something, Reimu?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: We know someone who is able to reach Gensokyo, but only inside of her dreams.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: If something happened to her, it must be what started this mess.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        this.Reimu.rotate(Vector3.Up(), Math.PI/3);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Doremy, don't you feel anything?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Well, actually, someone dreaming is actually getting closer to us!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: She is moving while sleeping? That sounds cool!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Sanae: Wait. She's sleeping? does that mean she is dreaming inside the dream of her dream?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'green';\r\n        img.src = \"portraits/Sanae_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: It doesn't matter. We may now be able to escape this dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I will try and get her exact location. When I find her, get to us as fast as you can!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFifthHubScene();\r\n    }\r\n    \r\n    CreateSkybox(): void {\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        this.skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        this.skyboxMaterial.backFaceCulling = false;\r\n        this.skyboxMaterial.disableLighting = true;\r\n        skybox.material = this.skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        this.skyboxMaterial.disableLighting = true;\r\n        this.skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        this.skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    SwitchSkybox(): void {\r\n        this.skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n    }\r\n\r\n    switchToFifthHubScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        this.scene = new FifthHubScene(this.canvas).scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport * as GUI from '@babylonjs/gui';\r\nimport { TransitionCutsceneSanaeEnd } from \"./TransitionCutsceneSanaeEnd\";\r\n\r\nexport class FourthStageScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n    shooting!: number;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageFourScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    /* ************************************************************************* */\r\n    //methods for stage four: \r\n\r\n    CreateStageFourScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n/*\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };*/\r\n\r\n        this.CreateCamera(scene);\r\n        this.camera.position = new Vector3(10,10,0);\r\n        this.CreateStageFourMap();\r\n\r\n        this.CreateReimuStageFour();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        leftWall.position = new Vector3(20,10,-50);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        rightWall.position = new Vector3(20,10,25);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        backWall.position = new Vector3(-12,10,-10);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        forthWall.position = new Vector3(53,10,-10);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ceilling.position = new Vector3(17,50,-10);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        \r\n        const ground = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ground.position = new Vector3(17,-20,-10);\r\n        ground.checkCollisions = true;\r\n        ground.visibility = 0;\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateStageFourMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_4.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.1);\r\n        sanae.meshes[0].position = new Vector3(23,2,-17);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        let health = 40;\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/10.FaithIsfortheTransientPeople.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        const needles = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"needles.glb\"\r\n        );\r\n        const advancedTexture = GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\r\n\r\n        // Create a health bar container\r\n        const healthBarContainer = new GUI.Rectangle();\r\n        healthBarContainer.width = \"190px\";\r\n        healthBarContainer.height = \"20px\";\r\n        healthBarContainer.color = \"white\";\r\n        healthBarContainer.thickness = 2;\r\n        healthBarContainer.background = \"black\";\r\n        healthBarContainer.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\r\n        advancedTexture.addControl(healthBarContainer);\r\n\r\n        // Create the health bar\r\n        const healthBar = new GUI.Rectangle();\r\n        healthBar.width = \"180px\";\r\n        healthBar.height = \"14px\";\r\n        healthBar.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        healthBar.background = \"green\";\r\n        healthBarContainer.addControl(healthBar);\r\n\r\n        // Update health bar width based on health percentage\r\n        function updateHealthBar(health:number) {\r\n            healthBar.width = `${180 * (health / 100)}px`;\r\n        }\r\n        this.scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0 && this.shooting == 0) {\r\n                    this.engine.enterPointerlock();\r\n                    const x = this.Reimu.position._x;\r\n                    const y = this.Reimu.position._y;\r\n                    const z = this.Reimu.position._z;\r\n                    needles.meshes[0].position._x = x;\r\n                    needles.meshes[0].position._y = y;\r\n                    needles.meshes[0].position._z = z-0.5;\r\n                }\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n            };\r\n\r\n        needles.meshes[0].scaling.setAll(0.2);\r\n        needles.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        needles.meshes[0].position = new Vector3(30,200,-20);\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            needles.meshes[0].moveWithCollisions(needles.meshes[0].right.scaleInPlace(0.3));\r\n            if (needles.meshes[2].intersectsMesh(sanae.meshes[2])) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n                health-=1;\r\n                updateHealthBar(health*100/40);\r\n            } \r\n            map.meshes.forEach((mesh) => {\r\n            if (needles.meshes[2].intersectsMesh(mesh) || needles.meshes[0].position._z<=-17) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n            } \r\n        })\r\n            if(health == 0) {\r\n                health--;\r\n                sanae.meshes[0].visibility = 0;\r\n                \r\n                const newDiv = document.createElement(\"div\"); \r\n                const newContent = document.createTextNode(\"Boss Defeated\");\r\n                newDiv.appendChild(newContent);\r\n                newDiv.style.position= 'absolute';\r\n                newDiv.style.top= '60%';\r\n                newDiv.style.left= \"50%\";\r\n                newDiv.style.transform= \"translate(-50%, -0%)\";\r\n                newDiv.style.margin= 'auto';\r\n                newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n                newDiv.style.fontSize= '20px';\r\n                newDiv.style.width= '500px';\r\n                newDiv.style.height= '150px';\r\n                newDiv.style.borderRadius= '20px';\r\n                newDiv.style.textAlign= 'center';\r\n                newDiv.style.alignContent= 'center';\r\n                newDiv.style.borderColor= 'red';\r\n                newDiv.style.borderStyle= 'ridge';\r\n                newDiv.style.fontFamily= 'Lucida Console';\r\n                document.body.appendChild(newDiv); \r\n                setTimeout(()=> {\r\n                    document.body.removeChild(newDiv);\r\n                    music.stop();\r\n                    this.switchTransitionCutsceneSanaeEnd();\r\n                }, 3000\r\n                );\r\n            }\r\n    \r\n        });\r\n    }, 2000);\r\n    }\r\n\r\n    async CreateReimuStageFour(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(23,2,-8);\r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/2);\r\n        this.Reimu.scaling.setAll(0.1);\r\n        this.camera.setTarget(meshes[2]);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n\r\n        const flightSpeed = 0.05;\r\n        const soarSpeed = 0.05;\r\n        const focusFlightSpeed = 0.03;\r\n        const rotationSpeed = 0.03;\r\n        const normalAnimSpeed = 5;\r\n        const focusAnimSpeed = 0.5;\r\n\r\n        let speed: number;\r\n        let animSpeed: number;\r\n        let acceleration = 0;\r\n        let soarAcceleration = 0;\r\n        let rotationAcceleration = 0;\r\n\r\n        const keyStatus = {\r\n            z: false,\r\n            s: false,\r\n            q: false,\r\n            d: false,\r\n            c: false,\r\n            v: false, \r\n            Shift: false\r\n        };\r\n\r\n        this.scene.actionManager = new ActionManager(this.scene);\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = true;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = false;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        let moving = false;\r\n        let soaring = false;\r\n        let turning = false;\r\n        let touched = 0;\r\n        this.shooting = 0;\r\n\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n\r\n            if(touched > 0) {\r\n                    touched-=2;\r\n                    this.shooting = (touched >=10)?1:0;\r\n                    this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n            }\r\n        else {\r\n            if(keyStatus.z ||\r\n            keyStatus.s ||\r\n            keyStatus.q ||\r\n            keyStatus.d ||\r\n            keyStatus.c ||\r\n            keyStatus.v) {\r\n                moving = true;\r\n                if(keyStatus.s && !keyStatus.z) {\r\n                    acceleration = Math.max(acceleration-0.0025, -flightSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                    speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                    animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                    flightAnim.speedRatio = animSpeed;\r\n                    acceleration = Math.min(acceleration+0.0025, speed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                if(keyStatus.q) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.max(rotationAcceleration-0.0005, -rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                else if(keyStatus.d) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.min(rotationAcceleration+0.0005, rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                if(keyStatus.c) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.min(soarAcceleration+0.005, soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                else if(keyStatus.v) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.max(soarAcceleration-0.005, -soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                flightAnim.start(\r\n                    true, \r\n                    1, \r\n                    flightAnim.from, \r\n                    flightAnim.to, \r\n                    false\r\n                );\r\n            }\r\n            else  {\r\n                if(moving) {\r\n                    idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                    acceleration = 0;\r\n                    flightAnim.stop();\r\n                    moving = false; \r\n                }\r\n            }\r\n            if(!keyStatus.z && !keyStatus.s) {\r\n                if(acceleration > 0) acceleration = Math.max(acceleration-0.005, 0);\r\n                else if(acceleration < 0) acceleration = Math.min(acceleration+0.005, 0);\r\n            }\r\n            if(!keyStatus.q && !keyStatus.d) {\r\n                if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.0005, 0);\r\n                if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.0005, 0);\r\n\r\n            }\r\n            if(!keyStatus.c && !keyStatus.v) {\r\n                if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.005, 0);\r\n                if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.005, 0);\r\n\r\n            }\r\n        }\r\n        });\r\n        \r\n\r\n        const mat = new StandardMaterial(\"mat\");\r\n        mat.diffuseColor = new Color3(0,0,1);\r\n        const bull = MeshBuilder.CreateSphere(\"bull\");\r\n        bull.position = new Vector3(21,4,-15);\r\n        (bull as AbstractMesh).material = mat;\r\n        const bull2 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull2.position = new Vector3(22,4,-15);\r\n        (bull2 as AbstractMesh).material = mat;\r\n        bull2.position._x += 0.4;\r\n        const bull3 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull3.position = new Vector3(24,4,-15);\r\n        (bull3 as AbstractMesh).material = mat;\r\n        bull3.position._x -= 0.4;\r\n        const bull4 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull4.position = new Vector3(25,4,-15);\r\n        (bull4 as AbstractMesh).material = mat;\r\n        const bull11 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull11.position = new Vector3(24,3,-15);\r\n        (bull11 as AbstractMesh).material = mat;\r\n        const bull12 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull12.position = new Vector3(23,2,-15);\r\n        (bull12 as AbstractMesh).material = mat;\r\n        bull12.position._y += 0.5;\r\n        const bull13 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull13.position = new Vector3(22,2,-15);\r\n        (bull13 as AbstractMesh).material = mat;\r\n        bull13.position._x -= 0.4;\r\n        const bull21 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull21.position = new Vector3(22,3,-15);\r\n        (bull21 as AbstractMesh).material = mat;\r\n        const bull22 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull22.position = new Vector3(23,5,-15);\r\n        (bull22 as AbstractMesh).material = mat;\r\n        const bull31 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull31.position = new Vector3(24,2,-15);\r\n        (bull31 as AbstractMesh).material = mat;\r\n        bull31.position._x += 0.4;\r\n\r\n        \r\n        let attackCycle = 1000;\r\n        const bulletSpeed = 0.4;\r\n        let accel = 0.004;\r\n        let accel1 = 0.004;\r\n        let accel2 = 0.004;\r\n        let accel3 = 0.004;\r\n        let direction = this.Reimu.position.subtract(bull.position).normalize();\r\n        let direction2 = this.Reimu.position.subtract(bull2.position).normalize();\r\n        let direction3 = this.Reimu.position.subtract(bull3.position).normalize();\r\n        let direction4 = this.Reimu.position.subtract(bull4.position).normalize();\r\n        let direction11 = this.Reimu.position.subtract(bull11.position).normalize();\r\n        let direction12 = this.Reimu.position.subtract(bull12.position).normalize();\r\n        let direction13 = this.Reimu.position.subtract(bull13.position).normalize();\r\n        let direction21 = this.Reimu.position.subtract(bull21.position).normalize();\r\n        let direction22 = this.Reimu.position.subtract(bull22.position).normalize();\r\n        let direction31 = this.Reimu.position.subtract(bull31.position).normalize();\r\n\r\n        setTimeout(() => {\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            if(attackCycle == 0) {\r\n                bull.position = new Vector3(21,4,-15);\r\n                direction = this.Reimu.position.subtract(bull.position).normalize();\r\n                attackCycle = 1000;\r\n                accel = 0.004;\r\n                accel1 = 0.004;\r\n                accel2 = 0.004;\r\n                accel3 = 0.004;\r\n            }\r\n            if(attackCycle == 980) {\r\n                bull2.position = new Vector3(22,4,-15);\r\n                bull2.position._x += 0.4;\r\n            }\r\n            if(attackCycle == 960) {\r\n                bull3.position = new Vector3(24,4,-15);\r\n                bull3.position._x -= 0.4;\r\n            }\r\n            if(attackCycle == 940) {\r\n                bull4.position = new Vector3(25,4,-15);\r\n            }\r\n            if(attackCycle == 924) {\r\n                bull11.position = new Vector3(24,3,-15);\r\n            }\r\n            if(attackCycle == 910) {\r\n                bull12.position = new Vector3(23,2,-15);\r\n                bull12.position._y += 0.5;\r\n            }\r\n            if(attackCycle == 894) {\r\n                bull13.position = new Vector3(22,2,-15);\r\n                bull13.position._x -= 0.4;\r\n            }\r\n            if(attackCycle == 884) {\r\n                bull21.position = new Vector3(22,3,-15);\r\n            }\r\n            if(attackCycle == 874) {\r\n                bull22.position = new Vector3(23,5,-15);\r\n            }\r\n            if(attackCycle == 870) {\r\n                bull31.position = new Vector3(24,2,-15);\r\n                bull31.position._x += 0.4;\r\n            }\r\n            if(attackCycle == 800) {\r\n                direction = this.Reimu.position.subtract(bull.position).normalize();\r\n            }\r\n            if(attackCycle <= 800) {\r\n                bull.position.addInPlace(direction.scale(accel));\r\n                accel = Math.min(accel+0.0008, bulletSpeed);\r\n            }\r\n            if(attackCycle == 760) {\r\n                direction2 = this.Reimu.position.subtract(bull2.position).normalize();\r\n            }\r\n            if(attackCycle <= 760) {\r\n                bull2.position.addInPlace(direction2.scale(accel));\r\n            }\r\n            if(attackCycle == 720) {\r\n                direction3 = this.Reimu.position.subtract(bull3.position).normalize();\r\n            }\r\n            if(attackCycle <= 720) {\r\n                bull3.position.addInPlace(direction3.scale(accel));\r\n            }\r\n            if(attackCycle == 680) {\r\n                direction4 = this.Reimu.position.subtract(bull4.position).normalize();\r\n            }\r\n            if(attackCycle <= 680) {\r\n                bull4.position.addInPlace(direction4.scale(accel));\r\n            }\r\n\r\n            if(attackCycle == 640) {\r\n                direction11 = this.Reimu.position.subtract(bull11.position).normalize();\r\n            }\r\n            if(attackCycle <= 640) {\r\n                bull11.position.addInPlace(direction11.scale(accel1));\r\n                accel1 = Math.min(accel1+0.0008, bulletSpeed);\r\n            }\r\n            if(attackCycle == 600) {\r\n                direction12 = this.Reimu.position.subtract(bull12.position).normalize();\r\n            }\r\n            if(attackCycle <= 600) {\r\n                bull12.position.addInPlace(direction12.scale(accel1));\r\n            }\r\n            if(attackCycle == 560) {\r\n                direction13 = this.Reimu.position.subtract(bull13.position).normalize();\r\n            }\r\n            if(attackCycle <= 560) {\r\n                bull13.position.addInPlace(direction13.scale(accel1));\r\n            }\r\n            \r\n            if(attackCycle == 520) {\r\n                direction21 = this.Reimu.position.subtract(bull21.position).normalize();\r\n            }\r\n            if(attackCycle <= 520) {\r\n                bull21.position.addInPlace(direction21.scale(accel2));\r\n                accel2 = Math.min(accel2+0.0008, bulletSpeed);\r\n            }\r\n            if(attackCycle == 480) {\r\n                direction22 = this.Reimu.position.subtract(bull22.position).normalize();\r\n            }\r\n            if(attackCycle <= 480) {\r\n                bull22.position.addInPlace(direction22.scale(accel2));\r\n            }\r\n            \r\n            if(attackCycle == 440) {\r\n                direction31 = this.Reimu.position.subtract(bull31.position).normalize();\r\n            }\r\n            if(attackCycle <= 440) {\r\n                bull31.position.addInPlace(direction31.scale(accel3));\r\n                accel3 = Math.min(accel3+0.0008, bulletSpeed);\r\n            }\r\n\r\n            attackCycle-=2;\r\n            \r\n            if (meshes[2].intersectsMesh(bull) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull2) && touched == 0) {\r\n                touched = 256;\r\n                bull2.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull3) && touched == 0) {\r\n                touched = 256;\r\n                bull3.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull4) && touched == 0) {\r\n                touched = 256;\r\n                bull4.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull12) && touched == 0) {\r\n                touched = 256;\r\n                bull12.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull13) && touched == 0) {\r\n                touched = 256;\r\n                bull13.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull21) && touched == 0) {\r\n                touched = 256;\r\n                bull21.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull22) && touched == 0) {\r\n                touched = 256;\r\n                bull22.position = new Vector3(14,200,-20);\r\n            } \r\n        });\r\n    },2000);\r\n    }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchTransitionCutsceneSanaeEnd() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new TransitionCutsceneSanaeEnd(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new ArcRotateCamera(\"camera\", 0, Math.PI/2, 12, Vector3.Zero(), scene);\r\n        this.camera.attachControl(this.canvas,true);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.angularSensibilityX = 3000;\r\n        this.camera.angularSensibilityY = 3000;\r\n        this.camera.wheelPrecision = 100;\r\n        this.camera.minZ = 0.3;\r\n        this.camera.lowerRadiusLimit = 1;\r\n        this.camera.upperRadiusLimit = 5;\r\n        this.camera.panningSensibility = 0;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FourthStageScene } from \"./FourthStageScene\";\r\n\r\nexport class FourthStageCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Sanae!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageFourScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n\r\n        this.CreateCutscene();\r\n    }\r\n    \r\n\r\n    CreateStageFourScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        const framesPerSecond = 60;\r\n        const gravity = -9.81;\r\n        scene.collisionsEnabled = true;\r\n        scene.enablePhysics(new Vector3(0, gravity/framesPerSecond, 0));\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateStageFourMap();\r\n\r\n        this.CreateReimuStageFour();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        leftWall.position = new Vector3(20,10,-50);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        rightWall.position = new Vector3(20,10,25);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        backWall.position = new Vector3(-12,10,-10);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        forthWall.position = new Vector3(53,10,-10);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ceilling.position = new Vector3(17,50,-10);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        \r\n        const ground = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ground.position = new Vector3(17,-20,-10);\r\n        ground.checkCollisions = true;\r\n        ground.visibility = 0;\r\n\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateStageFourMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_4.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        this.Sanae = sanae.meshes[0];\r\n        this.Sanae.scaling.setAll(0.1);\r\n        this.Sanae.position = new Vector3(20,0,-15);\r\n        //this.Sanae.position = new Vector3(23,2,-17);\r\n        this.Sanae.rotate(Vector3.Up(), 3.1);\r\n        this.Sanae.rotate(Vector3.Up(), -Math.PI/2)\r\n        this.Sanae.rotate(Vector3.Forward(), Math.PI/2)\r\n    }\r\n\r\n    async CreateReimuStageFour(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        //this.Reimu.position = new Vector3(23,2,-8);\r\n        this.Reimu.position = new Vector3(25,0,-17);\r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/2);\r\n        this.Reimu.scaling.setAll(0.1);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n    \r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(25,1,-15), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(Math.PI/8,Math.PI,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n            \r\n            const fps = 60;\r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            let newContent = document.createTextNode(\"Reimu: Hey, Doremy! Have you ever been to the outside world before?\");\r\n            newDiv.appendChild(newContent);\r\n            \r\n            const imgDiv = document.createElement(\"div\"); \r\n            const img = new Image();\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            imgDiv.appendChild(img);\r\n            img.style.height = \"190px\";\r\n            imgDiv.style.top= '55%';\r\n            imgDiv.style.left= \"19%\";\r\n            imgDiv.style.margin= 'auto';\r\n            imgDiv.style.position= 'absolute';\r\n        \r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'red';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Lucida Console';\r\n            document.body.appendChild(newDiv); \r\n            document.body.appendChild(imgDiv); \r\n            \r\n            let camkeys = [];\r\n            const camAnim = new Animation(\r\n                \"camAnim\", \r\n                \"position\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n    \r\n            let rotkeys = [];\r\n            const rotationAnim = new Animation(\r\n                \"rotationAnim\",\r\n                \"rotation\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/09.UndellaTown(Autumn-Winter-Spring).mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            \r\n            camkeys.push({frame:0, value:new Vector3(25,1,-15)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(25,1,-15)});\r\n            rotkeys.push({frame:0, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [Never, but I saw it's people's dreams a few times. Why do you ask?]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Do you know what's that building?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(25,1,-15)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(25,1,-15)});\r\n            rotkeys.push({frame:0, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [That looks like a school.]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(25,1,-15)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(25,1,-15)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Schools are next to the sea in the outside world? That's sounds cool!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(25,1,-15)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(31,9,-11)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(31,9,-11)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/4,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,5*Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: Hey, Reimu! fancy meetting you here!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(31,9,-11)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(21,1,-15)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(21,1,-15)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,5*Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/4,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,3*Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: Did you came here to take a sun bath like me?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(21,1,-15)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(21,1,-15)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,3*Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Not really, but shouldn't you be in a classroom right now?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            this.Reimu.position = new Vector3(21,0,-17);\r\n            this.Reimu.rotate(Vector3.Up(), 3*Math.PI/4);\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(21,1,-15)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(23,1,-13)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(23,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,10*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/16,10*Math.PI/8,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: Today is our day off!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(23,1,-13)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(23,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,10*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/16,10*Math.PI/8,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Then why are you here?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: To take a sun bath!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_happy.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Well, that makes sense.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: I love this place so much! I would never give it away for anything!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_happy.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(23,1,-13)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(23,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,10*Math.PI/8,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,2*Math.PI,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,2*Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: If not for the messed up sky, I'm sure this place would look nice.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(23,1,-13)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(23,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,2*Math.PI,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,2*Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: ...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            this.Sanae.rotate(Vector3.Forward(), -Math.PI/2);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: All of this isn't real, isn't it?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Huh? You realized?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: Even if it's not exactly the same, this place looks like the one I remember from the outside world.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(23,1,-15)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(20,1,-13)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(20,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,2*Math.PI,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: It holds a very special place in my heart!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(20,1,-13)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(20,1,-13)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: ...But I do not belong here anymore.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Sanae, I would really like to help you...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: It's okay, Reimu. I know what I have to do now!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: I am not honoring my memories of this place like this!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(20,1,-13)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(20,1,-17)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(20,1,-17)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(-Math.PI/16,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,3*Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: I am now a resident of Gensokyo! And I have so many friends there!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(20,1,-17)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(20,1,-17)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,3*Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            this.Reimu.position = new Vector3(23,2,-8);\r\n            this.Sanae.position = new Vector3(23,2,-15);\r\n            this.Reimu.rotate(Vector3.Up(), -3*Math.PI/4);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: Reimu! Let's have a battle now!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(20,1,-17)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(17,1,-12)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(17,1,-12)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,3*Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Sanae: I want to leave this place with a blast!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'green';\r\n            img.src = \"portraits/Sanae_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(17,1,-12)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(17,1,-12)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Alright Sanae, if that's what you want...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(17,1,-12)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(23,3,-6)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(23,3,-6)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/8,Math.PI,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFourthStageScene();\r\n    }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToFourthStageScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FourthStageScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FourthStageCutscene } from \"./FourthStageCutscene\";\r\n\r\nexport class TransitionCutsceneSanae { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(95,12,-73);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 7*Math.PI/4);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.4);\r\n        sanae.meshes[0].position = new Vector3(95,12,-71);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(95,12,-69);\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -3*Math.PI/4);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(100,14,-75), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/8,-Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: I should have expected to see Sanae, but I hoped she wouldn't end up like this.\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys.push({frame:0*fps, value:new Vector3(100,14,-75)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(100,14,-75)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Is this person also a friend of yours, Reimu?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Sanae is from the outside world, but she arrived in Gensokyo to gather faith. She is a shrine maiden like me.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: We weren't getting along at first, but we are like business rivals now.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: you have a lot of friends here, Reimu!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: ...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: How is that possible?\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: What's the matter?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Sanae is the shrine maiden of Moriya shrine, which is located on this mountain.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Here, we have Sanae.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(100,14,-75)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(96,13,-73)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(96,13,-73)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,0,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/8,0,0)});\r\n            \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: But we don't have the shrine!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(96,13,-73)});\r\n        camkeys.push({frame:1*fps, value:new Vector3(68,2,-72)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(68,2,-72)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,0,0)});\r\n        rotkeys.push({frame:1*fps, value:new Vector3(-Math.PI/8,Math.PI/2,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/8,Math.PI/2,0)});\r\n            \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: A shrine is supposed to be here?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(68,2,-72)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(68,2,-72)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/8,Math.PI/2,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/8,Math.PI/2,0)});\r\n            \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Do you think it could be linked to what's happening with the dreams?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: The dream world could not have such an impact on the real world.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Then that makes it two separate incidents!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I really need a break!\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: But with Sanae's help, It will be done in no time!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFourthStageCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToFourthStageCutscene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FourthStageCutscene(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { TransitionCutsceneSanae } from \"./TransitionCutsceneSanae\";\r\n\r\nexport class FourthHubScene {\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        \r\n    }\r\n    \r\n    CreateScene(): Scene {\r\n        this.engine = new Engine(this.canvas, true);\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 2;\r\n\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        const framesPerSecond = 60;\r\n        const gravity = -9.81;\r\n        scene.collisionsEnabled = true;\r\n        scene.enablePhysics(new Vector3(0, gravity/framesPerSecond, 0));\r\n\r\n        this.CreateCamera(scene);\r\n        \r\n        this.CreateMap();\r\n        \r\n        this.CreateReimu();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        leftWall.position = new Vector3(56,50,-143);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n        \r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        rightWall.position = new Vector3(56,50,89);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n        \r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        forthWall.position = new Vector3(181,50,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        backWall.position = new Vector3(-69,50,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n        \r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:300});\r\n        ceilling.position = new Vector3(20,250,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        (async () => {\r\n        const music = await CreateSoundAsync(\"music\",\r\n                \"audio/02.RescueTeamBase.mp3\",\r\n                {\r\n                    volume: 0.15,\r\n                    loop:true\r\n                }\r\n            );\r\n        music.play();\r\n        const trigger = MeshBuilder.CreateSphere(\"trigger\", {diameter: 15});\r\n        trigger.visibility = 0;\r\n        trigger.position = new Vector3(95,12,-73);\r\n        setTimeout(() => {\r\n            this.scene.registerBeforeRender(() => {\r\n                if(trigger.intersectsMesh(this.Reimu)) {music.stop();this.switchToTransitionCutsceneSanae();}\r\n            });\r\n        }, 2000);\r\n    })();\r\n        return scene;\r\n\r\n    }\r\n\r\n        CreateCamera(scene: Scene): void {\r\n            this.camera = new ArcRotateCamera(\"camera\", Math.PI/2, Math.PI/2, 12, Vector3.Zero(), scene);\r\n            this.camera.attachControl(this.canvas,true);\r\n            this.camera.checkCollisions = true;\r\n            this.camera.angularSensibilityX = 3000;\r\n            this.camera.angularSensibilityY = 3000;\r\n            this.camera.wheelPrecision = 50;\r\n            this.camera.minZ = 0.3;\r\n            this.camera.lowerRadiusLimit = 5;\r\n            this.camera.upperRadiusLimit = 15;\r\n            this.camera.panningSensibility = 0;\r\n        }\r\n    \r\n    \r\n        async CreateReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n            );\r\n            this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(88,21,-31);\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched--;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n        }\r\n    \r\n        async CreateMap(): Promise<void> {\r\n            const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n            map.meshes.forEach((mesh) => {\r\n                // Enable collisions for each imported mesh\r\n                mesh.checkCollisions = true;\r\n            });\r\n            \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[2].checkCollisions = true;\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].position._y-=0.2;\r\n        cirno.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(25,0,-78);\r\n        rumia.meshes[2].checkCollisions = true;\r\n        rumia.meshes[0].position._y-=0.2;\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        \r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(95,12,-73);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 7*Math.PI/4);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[2].checkCollisions = true;\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), Math.PI);\r\n\r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        aya.meshes[0].scaling.setAll(0.4);\r\n        aya.meshes[2].checkCollisions = true;\r\n        aya.meshes[0].position = new Vector3(88,20,-28);\r\n        aya.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        aya.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.4);\r\n        sanae.meshes[0].position = new Vector3(95,12,-71);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n        \r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToTransitionCutsceneSanae() {\r\n        const next = new TransitionCutsceneSanae(this.canvas);\r\n        this.engine.stopRenderLoop();\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.scene = next.scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FourthHubScene } from \"./FourthHubScene\";\r\n\r\nexport class TransitionCutsceneAyaEnd { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Aya!:AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(91,20,-28);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 7*Math.PI/8);\r\n        \r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        this.Aya = aya.meshes[0];\r\n        this.Aya.scaling.setAll(0.4);\r\n        this.Aya.position = new Vector3(88,20,-28);\r\n        this.Aya.rotate(Vector3.Up(), 3.1);\r\n        this.Aya.rotate(Vector3.Up(), Math.PI/8);\r\n        \r\n        const sanae = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"sanae.glb\"\r\n        );\r\n        sanae.meshes[0].scaling.setAll(0.4);\r\n        sanae.meshes[0].position = new Vector3(95,12,-71);\r\n        sanae.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        sanae.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(88,20,-31);\r\n        this.Reimu.scaling.setAll(0.4);\r\n        this.Reimu.rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(94,23,-33), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/8,-Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Aya: Ayayayaya...\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Aya_sad.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'orange';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        \r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys.push({frame:0*fps, value:new Vector3(94,23,-33)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(94,23,-33)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Aya.rotate(Vector3.Up(), 3*Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: Reimu! Do you think that's how you wake a friend up?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Aya_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I'm not searching consideration, but you could be a little more gentle.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: Wait... I was asleep in daylight? For how long? What happened to me?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'orange';\r\n        img.src = \"portraits/Aya_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: People are starting to fall asleep all over Gensokyo, and they are unable to wake up.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        this.Aya.rotate(Vector3.Up(), -Math.PI/2);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: WHAT? AND I MISSED SUCH A SCOOP?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'orange';\r\n        img.src = \"portraits/Aya_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Oh no...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        this.Aya.rotate(Vector3.Up(), Math.PI/2);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: Reimu! You already have taken actions, right? Then you have to tell me EVERYTHING you know!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'orange';\r\n        img.src = \"portraits/Aya_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(0.1));\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: Who are the people that fell asleep?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Aya_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        img.style.height = \"200px\";\r\n        this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(0.3));\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: What was their geographic position?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Aya_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        img.style.height = \"210px\";\r\n        this.Aya.moveWithCollisions(this.Aya.right.scaleInPlace(0.5));\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Aya: What were their dreams like?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Aya_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        img.style.height = \"190px\";\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Aya, please, we're in a hurry...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: When you are finished with Aya, Reimu, we will have to go to that mountain next.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        camkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(94,23,-33)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(93,22,-50)});\r\n        camkeys.push({frame:5*fps, value:new Vector3(93,22,-50)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/4,-7*Math.PI/8,0)});\r\n        rotkeys.push({frame:5*fps, value:new Vector3(Math.PI/4,-7*Math.PI/8,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Can't you help me here?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(93,22,-50)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(93,22,-50)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,-7*Math.PI/8,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,-7*Math.PI/8,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFourthHubScene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToFourthHubScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        this.scene = new FourthHubScene(this.canvas).scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    Texture,\r\n    CubeTexture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport * as GUI from '@babylonjs/gui';\r\nimport { TransitionCutsceneAyaEnd } from \"./TransitionCutsceneAyaEnd\";\r\n\r\nexport class ThirdStageScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n    shooting!: number;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageThreeScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n\r\n    /* ************************************************************************* */\r\n    //methods for stage three:\r\n\r\n    CreateStageThreeScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        /*scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };*/\r\n\r\n        this.CreateCamera(scene);\r\n        this.camera.position = new Vector3(10,10,0);\r\n        this.CreateStageThreeMap();\r\n\r\n        this.CreateReimuStageThree();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        leftWall.position = new Vector3(30,10,-80);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        rightWall.position = new Vector3(30,10,18);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        backWall.position = new Vector3(-18,10,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        forthWall.position = new Vector3(80,10,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        ceilling.position = new Vector3(30,60,-30);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n\r\n        return scene;\r\n    }\r\n\r\n    async CreateStageThreeMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_3.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        aya.meshes[0].scaling.setAll(0.7);\r\n        aya.meshes[0].position = new Vector3(50,5,-31);\r\n        let health = 30;\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/08.YoukaiMountain~MysteriousMountain.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        const needles = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"needles.glb\"\r\n        );\r\n        const advancedTexture = GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\r\n\r\n        // Create a health bar container\r\n        const healthBarContainer = new GUI.Rectangle();\r\n        healthBarContainer.width = \"170px\";\r\n        healthBarContainer.height = \"20px\";\r\n        healthBarContainer.color = \"white\";\r\n        healthBarContainer.thickness = 2;\r\n        healthBarContainer.background = \"black\";\r\n        healthBarContainer.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\r\n        advancedTexture.addControl(healthBarContainer);\r\n\r\n        // Create the health bar\r\n        const healthBar = new GUI.Rectangle();\r\n        healthBar.width = \"160px\";\r\n        healthBar.height = \"14px\";\r\n        healthBar.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        healthBar.background = \"orange\";\r\n        healthBarContainer.addControl(healthBar);\r\n\r\n        // Update health bar width based on health percentage\r\n        function updateHealthBar(health:number) {\r\n            healthBar.width = `${160 * (health / 100)}px`;\r\n        }\r\n\r\n        this.scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0 && this.shooting == 0) {\r\n                    this.engine.enterPointerlock();\r\n                    const x = this.Reimu.position._x;\r\n                    const y = this.Reimu.position._y;\r\n                    const z = this.Reimu.position._z;\r\n                    needles.meshes[0].position._x = x-2;\r\n                    needles.meshes[0].position._y = y;\r\n                    needles.meshes[0].position._z = z;\r\n                }\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n            };\r\n\r\n        needles.meshes[0].scaling.setAll(0.8);\r\n        needles.meshes[0].rotate(Vector3.Up(), Math.PI);\r\n        needles.meshes[0].position = new Vector3(30,200,-20);\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            needles.meshes[0].moveWithCollisions(needles.meshes[0].right.scaleInPlace(1.2));\r\n            if (needles.meshes[2].intersectsMesh(aya.meshes[2])) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n                health-=1;\r\n                updateHealthBar(health*100/30);\r\n            } \r\n            map.meshes.forEach((mesh) => {\r\n            if (needles.meshes[2].intersectsMesh(mesh)||needles.meshes[0].position._x>=51) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n            } \r\n        })\r\n            if(health == 0) {\r\n                health--;\r\n                aya.meshes[0].visibility = 0;\r\n                \r\n                const newDiv = document.createElement(\"div\"); \r\n                const newContent = document.createTextNode(\"Boss Defeated\");\r\n                newDiv.appendChild(newContent);\r\n                newDiv.style.position= 'absolute';\r\n                newDiv.style.top= '60%';\r\n                newDiv.style.left= \"50%\";\r\n                newDiv.style.transform= \"translate(-50%, -0%)\";\r\n                newDiv.style.margin= 'auto';\r\n                newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n                newDiv.style.fontSize= '20px';\r\n                newDiv.style.width= '500px';\r\n                newDiv.style.height= '150px';\r\n                newDiv.style.borderRadius= '20px';\r\n                newDiv.style.textAlign= 'center';\r\n                newDiv.style.alignContent= 'center';\r\n                newDiv.style.borderColor= 'red';\r\n                newDiv.style.borderStyle= 'ridge';\r\n                newDiv.style.fontFamily= 'Lucida Console';\r\n                document.body.appendChild(newDiv); \r\n                setTimeout(()=> {\r\n                    document.body.removeChild(newDiv);\r\n                    music.stop();\r\n                    this.switchTransitionCutsceneAyaEnd();\r\n                }, 3000\r\n                );\r\n            }\r\n    \r\n        });\r\n    }, 2000);\r\n    }\r\n\r\n    async CreateReimuStageThree(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(15,5,-31);\r\n        this.Reimu.scaling.setAll(0.6);\r\n        this.Reimu.rotate(Vector3.Up(), Math.PI);\r\n        this.camera.setTarget(meshes[2]);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n\r\n        const flightSpeed = 0.2;\r\n        const soarSpeed = 0.2;\r\n        const focusFlightSpeed = 0.1;\r\n        const rotationSpeed = 0.05;\r\n        const normalAnimSpeed = 5;\r\n        const focusAnimSpeed = 0.5;\r\n\r\n        let speed: number;\r\n        let animSpeed: number;\r\n        let acceleration = 0;\r\n        let soarAcceleration = 0;\r\n        let rotationAcceleration = 0;\r\n\r\n        const keyStatus = {\r\n            z: false,\r\n            s: false,\r\n            q: false,\r\n            d: false,\r\n            c: false,\r\n            v: false, \r\n            Shift: false\r\n        };\r\n\r\n        this.scene.actionManager = new ActionManager(this.scene);\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = true;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = false;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        let moving = false;\r\n        let soaring = false;\r\n        let turning = false;\r\n        let touched = 0;\r\n        this.shooting = 0;\r\n\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n\r\n            if(touched > 0) {\r\n                    touched-=2;\r\n                    this.shooting = (touched >=10)?1:0;\r\n                    this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n            }\r\n        else {\r\n            if(keyStatus.z ||\r\n            keyStatus.s ||\r\n            keyStatus.q ||\r\n            keyStatus.d ||\r\n            keyStatus.c ||\r\n            keyStatus.v) {\r\n                moving = true;\r\n                if(keyStatus.s && !keyStatus.z) {\r\n                    acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                    speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                    animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                    flightAnim.speedRatio = animSpeed;\r\n                    acceleration = Math.min(acceleration+0.01, speed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                if(keyStatus.q) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                else if(keyStatus.d) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                if(keyStatus.c) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                else if(keyStatus.v) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                flightAnim.start(\r\n                    true, \r\n                    1, \r\n                    flightAnim.from, \r\n                    flightAnim.to, \r\n                    false\r\n                );\r\n            }\r\n            else  {\r\n                if(moving) {\r\n                    idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                    acceleration = 0;\r\n                    flightAnim.stop();\r\n                    moving = false; \r\n                }\r\n            }\r\n            if(!keyStatus.z && !keyStatus.s) {\r\n                if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n            }\r\n            if(!keyStatus.q && !keyStatus.d) {\r\n                if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n\r\n            }\r\n            if(!keyStatus.c && !keyStatus.v) {\r\n                if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n\r\n            }\r\n        }\r\n        });\r\n\r\n        const matR = new StandardMaterial(\"mat\");\r\n        matR.diffuseColor = new Color3(1,0,0);\r\n        const matG = new StandardMaterial(\"mat\");\r\n        matG.diffuseColor = new Color3(0,1,0);\r\n        const matB = new StandardMaterial(\"mat\");\r\n        matB.diffuseColor = new Color3(0,0,1);\r\n\r\n        const bull = MeshBuilder.CreateSphere(\"bull\");\r\n        bull.position = new Vector3(40,5,-31);\r\n        (bull as AbstractMesh).material = matR;\r\n        const bull1 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull1.position = new Vector3(41,5,-30);\r\n        bull1.position._x-=0.7;\r\n        bull1.position._z-=0.4;\r\n        (bull1 as AbstractMesh).material = matR;\r\n        const bull2 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull2.position = new Vector3(41,5,-30);\r\n        (bull2 as AbstractMesh).material = matR;\r\n        bull2.position._x-=0.1;\r\n        bull2.position._z-=0.2;\r\n        const bull3 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull3.position = new Vector3(41,5,-30);\r\n        (bull3 as AbstractMesh).material = matR;\r\n        bull3.position._x+=0.5;\r\n        bull3.position._z-=0.4;\r\n        const bull4 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull4.position = new Vector3(42,5,-31);\r\n        bull4.position._x-=0.25;\r\n        (bull4 as AbstractMesh).material = matR;\r\n        const bull5 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull5.position = new Vector3(41,5,-32);\r\n        (bull5 as AbstractMesh).material = matR;\r\n        bull5.position._x+=0.5;\r\n        bull5.position._z+=0.4;\r\n        const bull6 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull6.position = new Vector3(41,5,-32);\r\n        (bull6 as AbstractMesh).material = matR;\r\n        bull6.position._x-=0.1;\r\n        bull6.position._z+=0.2;\r\n        const bull7 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull7.position = new Vector3(41,5,-32);\r\n        bull7.position._x-=0.7;\r\n        bull7.position._z+=0.4;\r\n        (bull7 as AbstractMesh).material = matR;\r\n\r\n        const bull20 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull20.position = new Vector3(40,7,-31);\r\n        bull20.position._z-=0.1;\r\n        (bull20 as AbstractMesh).material = matB;\r\n        const bull21 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull21.position = new Vector3(40,7,-31);\r\n        bull21.position._x+=0.3;\r\n        bull21.position._z+=0.6;\r\n        (bull21 as AbstractMesh).material = matB;\r\n        const bull22 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull22.position = new Vector3(41,7,-30);\r\n        bull22.position._x-=0.1;\r\n        bull22.position._z+=0.1;\r\n        (bull22 as AbstractMesh).material = matB;\r\n        const bull23 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull23.position = new Vector3(42,7,-30);\r\n        bull23.position._x-=0.4;\r\n        bull23.position._z+=0.3;\r\n        (bull23 as AbstractMesh).material = matB;\r\n        const bull24 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull24.position = new Vector3(42,7,-30);\r\n        bull24.position._x+=0.3;\r\n        bull24.position._z+=0.1;\r\n        (bull24 as AbstractMesh).material = matB;\r\n        const bull25 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull25.position = new Vector3(43,7,-31);\r\n        bull25.position._x-=0.1;\r\n        bull25.position._z+=0.6;\r\n        (bull25 as AbstractMesh).material = matB;\r\n        const bull26 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull26.position = new Vector3(43,7,-31);\r\n        bull26.position._x+=0.2;\r\n        bull26.position._z-=0.1;\r\n        (bull26 as AbstractMesh).material = matB;\r\n        const bull27 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull27.position = new Vector3(43,7,-32);\r\n        bull27.position._x-=0.1;\r\n        bull27.position._z+=0.2;\r\n        (bull27 as AbstractMesh).material = matB;\r\n        const bull28 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull28.position = new Vector3(42,7,-32);\r\n        bull28.position._x+=0.3;\r\n        bull28.position._z-=0.3;\r\n        (bull28 as AbstractMesh).material = matB;\r\n        const bull29 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull29.position = new Vector3(42,7,-32);\r\n        bull29.position._x-=0.4;\r\n        bull29.position._z-=0.5;\r\n        (bull29 as AbstractMesh).material = matB;\r\n        const bull210 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull210.position = new Vector3(41,7,-32);\r\n        bull210.position._x-=0.1;\r\n        bull210.position._z-=0.3;\r\n        (bull210 as AbstractMesh).material = matB;\r\n        const bull211 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull211.position = new Vector3(40,7,-31);\r\n        bull211.position._x+=0.3;\r\n        bull211.position._z-=0.8;\r\n        (bull211 as AbstractMesh).material = matB;\r\n\r\n        \r\n        const bull30 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull30.position = new Vector3(40,9,-31);\r\n        (bull30 as AbstractMesh).material = matG;\r\n        const bull31 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull31.position = new Vector3(41,9,-28);\r\n        (bull31 as AbstractMesh).material = matG;\r\n        const bull32 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull32.position = new Vector3(43,9,-26);\r\n        (bull32 as AbstractMesh).material = matG;\r\n        const bull33 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull33.position = new Vector3(46,9,-25);\r\n        (bull33 as AbstractMesh).material = matG;\r\n        const bull34 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull34.position = new Vector3(49,9,-26);\r\n        (bull34 as AbstractMesh).material = matG;\r\n        const bull35 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull35.position = new Vector3(51,9,-28);\r\n        (bull35 as AbstractMesh).material = matG;\r\n        const bull36 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull36.position = new Vector3(52,9,-31);\r\n        (bull36 as AbstractMesh).material = matG;\r\n        const bull37 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull37.position = new Vector3(51,9,-34);\r\n        (bull37 as AbstractMesh).material = matG;\r\n        const bull38 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull38.position = new Vector3(49,9,-36);\r\n        (bull38 as AbstractMesh).material = matG;\r\n        const bull39 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull39.position = new Vector3(46,9,-37);\r\n        (bull39 as AbstractMesh).material = matG;\r\n        const bull310 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull310.position = new Vector3(43,9,-36);\r\n        (bull310 as AbstractMesh).material = matG;\r\n        const bull311 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull311.position = new Vector3(41,9,-34);\r\n        (bull311 as AbstractMesh).material = matG;\r\n\r\n        \r\n        let Rcycle = 298;\r\n        let Gcycle = 998;\r\n        let Bcycle = 698;\r\n        const Rspeed = 0.4;\r\n        const Gspeed = 0.1;\r\n        const Bspeed = 0.22;\r\n        let Rdirection = this.Reimu.position.subtract(bull.position).normalize();\r\n        let Gdirection = this.Reimu.position.subtract(bull.position).normalize();\r\n        let Bdirection = this.Reimu.position.subtract(bull.position).normalize();\r\n        setTimeout(() => {\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            if(Rcycle == 0) {\r\n                Rcycle = 300;\r\n                bull.position = new Vector3(40,5,-31);\r\n                bull1.position = new Vector3(41,5,-30);\r\n                bull1.position._x-=0.7;\r\n                bull1.position._z-=0.4;\r\n                bull2.position = new Vector3(41,5,-30);\r\n                bull2.position._x-=0.1;\r\n                bull2.position._z-=0.2;\r\n                bull3.position = new Vector3(41,5,-30);\r\n                bull3.position._x+=0.5;\r\n                bull3.position._z-=0.4;\r\n                bull4.position = new Vector3(42,5,-31);\r\n                bull4.position._x-=0.25;\r\n                bull5.position = new Vector3(41,5,-32);\r\n                bull5.position._x+=0.5;\r\n                bull5.position._z+=0.4;\r\n                bull6.position = new Vector3(41,5,-32);\r\n                bull6.position._x-=0.1;\r\n                bull6.position._z+=0.2;\r\n                bull7.position = new Vector3(41,5,-32);\r\n                bull7.position._x-=0.7;\r\n                bull7.position._z+=0.4;\r\n                Rdirection = this.Reimu.position.subtract(bull.position).normalize();\r\n            }\r\n            bull.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull1.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull2.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull3.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull4.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull5.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull6.position.addInPlace(Rdirection.scale(Rspeed));\r\n            bull7.position.addInPlace(Rdirection.scale(Rspeed));\r\n\r\n            if(Bcycle == 0) {\r\n                Bcycle = 700; \r\n                bull20.position = new Vector3(40,7,-31);\r\n                bull20.position._z-=0.1;\r\n                bull21.position = new Vector3(40,7,-31);\r\n                bull21.position._x+=0.3;\r\n                bull21.position._z+=0.6;\r\n                bull22.position = new Vector3(41,7,-30);\r\n                bull22.position._x-=0.1;\r\n                bull22.position._z+=0.1;\r\n                bull23.position = new Vector3(42,7,-30);\r\n                bull23.position._x-=0.4;\r\n                bull23.position._z+=0.3;\r\n                bull24.position = new Vector3(42,7,-30);\r\n                bull24.position._x+=0.3;\r\n                bull24.position._z+=0.1;\r\n                bull25.position = new Vector3(43,7,-31);\r\n                bull25.position._x-=0.1;\r\n                bull25.position._z+=0.6;\r\n                bull26.position = new Vector3(43,7,-31);\r\n                bull26.position._x+=0.2;\r\n                bull26.position._z-=0.1;\r\n                bull27.position = new Vector3(43,7,-32);\r\n                bull27.position._x-=0.1;\r\n                bull27.position._z+=0.2;\r\n                bull28.position = new Vector3(42,7,-32);\r\n                bull28.position._x+=0.3;\r\n                bull28.position._z-=0.3;\r\n                bull29.position = new Vector3(42,7,-32);\r\n                bull29.position._x-=0.4;\r\n                bull29.position._z-=0.5;\r\n                bull210.position = new Vector3(41,7,-32);\r\n                bull210.position._x-=0.1;\r\n                bull210.position._z-=0.3;\r\n                bull211.position = new Vector3(40,7,-31);\r\n                bull211.position._x+=0.3;\r\n                bull211.position._z-=0.8;\r\n                Bdirection = this.Reimu.position.subtract(bull20.position).normalize();\r\n            }\r\n            bull20.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull21.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull22.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull23.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull24.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull25.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull26.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull27.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull28.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull29.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull210.position.addInPlace(Bdirection.scale(Bspeed));\r\n            bull211.position.addInPlace(Bdirection.scale(Bspeed));\r\n\r\n            if(Gcycle == 0) {\r\n                Gcycle = 1000;\r\n                bull30.position = new Vector3(40,9,-31);\r\n                bull31.position = new Vector3(41,9,-28);\r\n                bull32.position = new Vector3(43,9,-26);\r\n                bull33.position = new Vector3(46,9,-25);\r\n                bull34.position = new Vector3(49,9,-26);\r\n                bull35.position = new Vector3(51,9,-28);\r\n                bull36.position = new Vector3(52,9,-31);\r\n                bull37.position = new Vector3(51,9,-34);\r\n                bull38.position = new Vector3(49,9,-36);\r\n                bull39.position = new Vector3(46,9,-37);\r\n                bull310.position = new Vector3(43,9,-36);\r\n                bull311.position = new Vector3(41,9,-34);\r\n                Gdirection = this.Reimu.position.subtract(bull30.position).normalize();\r\n            }\r\n            bull30.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull31.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull32.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull33.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull34.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull35.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull36.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull37.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull38.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull39.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull310.position.addInPlace(Gdirection.scale(Gspeed));\r\n            bull311.position.addInPlace(Gdirection.scale(Gspeed));\r\n\r\n            Rcycle-=2;\r\n            Bcycle-=2;\r\n            Gcycle-=2;\r\n\r\n            if (meshes[2].intersectsMesh(bull) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull1) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull2) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull3) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull4) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull5) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull6) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull7) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull20) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull21) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull22) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull23) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull24) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull25) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull26) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull27) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull28) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull29) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull210) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull211) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull30) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull31) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull32) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull33) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull34) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull35) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull36) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull37) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull38) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull39) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull310) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull311) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n        })\r\n    }, 2000);\r\n    }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchTransitionCutsceneAyaEnd() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new TransitionCutsceneAyaEnd(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new ArcRotateCamera(\"camera\", 0, Math.PI/2, 12, Vector3.Zero(), scene);\r\n        this.camera.attachControl(this.canvas,true);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.angularSensibilityX = 3000;\r\n        this.camera.angularSensibilityY = 3000;\r\n        this.camera.wheelPrecision = 50;\r\n        this.camera.minZ = 0.3;\r\n        this.camera.lowerRadiusLimit = 5;\r\n        this.camera.upperRadiusLimit = 15;\r\n        this.camera.panningSensibility = 0;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { ThirdStageScene } from \"./ThirdStageScene\";\r\n\r\nexport class ThirdStageCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Aya!:AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageThreeScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n\r\n        this.CreateCutscene();\r\n    }\r\n    CreateStageThreeScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        const framesPerSecond = 60;\r\n        const gravity = -9.81;\r\n        scene.collisionsEnabled = true;\r\n        scene.enablePhysics(new Vector3(0, gravity/framesPerSecond, 0));\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateStageThreeMap();\r\n\r\n        this.CreateReimuStageThree();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        leftWall.position = new Vector3(30,10,-80);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        rightWall.position = new Vector3(30,10,18);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        backWall.position = new Vector3(-18,10,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        forthWall.position = new Vector3(80,10,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        ceilling.position = new Vector3(30,60,-30);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n\r\n        return scene;\r\n    }\r\n\r\n    async CreateStageThreeMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_3.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        this.Aya = aya.meshes[0];\r\n        this.Aya.scaling.setAll(0.7);\r\n        this.Aya.position = new Vector3(42,1,-38);\r\n    }\r\n\r\n    async CreateReimuStageThree(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(15,1,-31);\r\n        this.Reimu.scaling.setAll(0.6);\r\n        this.Reimu.rotate(Vector3.Up(), Math.PI);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(21,3,-31), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(0,3*Math.PI/2,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n            \r\n            const fps = 60;\r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            let newContent = document.createTextNode(\"Reimu: Oh! We are indoors for once. That's a change from the previous dreams.\");\r\n            newDiv.appendChild(newContent);\r\n            \r\n            const imgDiv = document.createElement(\"div\"); \r\n            const img = new Image();\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n            imgDiv.appendChild(img);\r\n            img.style.height = \"190px\";\r\n            imgDiv.style.top= '55%';\r\n            imgDiv.style.left= \"19%\";\r\n            imgDiv.style.margin= 'auto';\r\n            imgDiv.style.position= 'absolute';\r\n        \r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'red';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Lucida Console';\r\n            document.body.appendChild(newDiv); \r\n            document.body.appendChild(imgDiv); \r\n\r\n            let camkeys = [];\r\n            const camAnim = new Animation(\r\n                \"camAnim\", \r\n                \"position\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n    \r\n            let rotkeys = [];\r\n            const rotationAnim = new Animation(\r\n                \"rotationAnim\",\r\n                \"rotation\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/07.IntheNightmare.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            \r\n            camkeys.push({frame:0, value:new Vector3(21,3,-31)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(21,3,-31)});\r\n            rotkeys.push({frame:0, value:new Vector3(0,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,3*Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: I was waiting for you, Reimu.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(21,3,-31)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(35,3,-42)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(35,3,-42)});\r\n            rotkeys.push({frame:0, value:new Vector3(0,3*Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: No, you were not!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(35,3,-42)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(35,3,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,Math.PI/4,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: It's been quite a long time since we last met.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Is it really?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: My name is Shameimaru Aya. It is my business to know what other people do not know.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(35,3,-42)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(45,3,-42)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(45,3,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-Math.PI/4,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,-Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: I know you and your job already Aya. Why do you have to remind me?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(45,3,-42)});\r\n            camkeys.push({frame:7*fps, value:new Vector3(45,3,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/4,0)});\r\n            rotkeys.push({frame:7*fps, value:new Vector3(0,-Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: What you do in this world is a matter of no consequence. The question is what can you make people believe you have done.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,7*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Did Yukari started giving you 'How to be annoying with Reimu' lessons?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: Crime is common. Logic is rare. Therefore it is upon the logic rather than upon the crime that you should dwell.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(45,3,-42)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(65,3,-42)});\r\n            camkeys.push({frame:7*fps, value:new Vector3(65,3,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:7*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,7*fps).waitAsync();\r\n            \r\n            this.Aya.position = new Vector3(54,1,-20);\r\n            this.Aya.rotate(Vector3.Up(), Math.PI);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: I chose Logic as my dwelling. What was your choice, Reimu?\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Aya_angry.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(65,3,-42)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(65,3,-20)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: For my own good, I will not answer that question.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(65,3,-20)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(65,3,-20)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: This is not like you at all Aya! I will have to knock some senses into you!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(65,3,-20)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(21,3,-27)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(21,3,-27)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-2*Math.PI/3,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,-2*Math.PI/3,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            this.Aya.position = new Vector3(50,5,-31);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: It seems it can't be helped then...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'orange';\r\n            img.src = \"portraits/Aya_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(21,3,-27)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(30,5,-27)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(30,5,-27)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-2*Math.PI/3,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-4*Math.PI/3,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-4*Math.PI/3,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            this.Aya.rotate(Vector3.Up(), -Math.PI);\r\n            this.Reimu.position = new Vector3(15,5,-31);\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Aya: Brace yourself, Reimu! The Game Is On!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Aya_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(30,5,-27)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(7,7,-31)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(7,7,-31)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-4*Math.PI/3,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-3*Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-3*Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToThirdStageScene();\r\n    }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToThirdStageScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new ThirdStageScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { ThirdStageCutscene } from \"./ThirdStageCutscene\";\r\n\r\nexport class TransitionCutsceneAya { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(90,20,-28);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3*Math.PI/4);\r\n        \r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        aya.meshes[0].scaling.setAll(0.4);\r\n        aya.meshes[0].position = new Vector3(88,20,-28);\r\n        aya.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        aya.meshes[0].rotate(Vector3.Up(), Math.PI/8);\r\n        aya.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(88,20,-31);\r\n        this.Reimu.scaling.setAll(0.4);\r\n        this.Reimu.rotate(Vector3.Up(), Math.PI/2);\r\n        //this.camera.setTarget(meshes[2]);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(84,23,-33), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/8,Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: Wait! Aya? How did this happen?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        const camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys.push({frame:0*fps, value:new Vector3(84,23,-33)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(84,23,-33)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: stay calm, Reimu! It's not too late, we can still save her!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I know, I'm calm, but Aya is one of my friends.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: But what's bothering me is that she is not the kind to take a nap outside like that.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: At that time, she should be racing through Gensokyo, searching for any info to pack her newspaper with.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: You don't have to be awake to fall victim to this state.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: It doesn't matter. I will not leave her like that.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Without her poorly written journals, Gensokyo will become boring in an instant. I will save you, Aya!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: (Are you sure you are friends?)\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToThirdStageCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToThirdStageCutscene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new ThirdStageCutscene(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { TransitionCutsceneAya } from \"./TransitionCutsceneAya\";\r\n\r\nexport class ThirdHubScene {\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        \r\n    }\r\n    \r\n    CreateScene(): Scene {\r\n        this.engine = new Engine(this.canvas, true);\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 2;\r\n\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        this.CreateCamera(scene);\r\n        \r\n        this.CreateMap();\r\n        \r\n        this.CreateReimu();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        leftWall.position = new Vector3(56,50,-143);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n        \r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        rightWall.position = new Vector3(56,50,89);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n        \r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        forthWall.position = new Vector3(181,50,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        backWall.position = new Vector3(-69,50,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n        \r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:300});\r\n        ceilling.position = new Vector3(20,250,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        (async () => {\r\n        const music = await CreateSoundAsync(\"music\",\r\n                \"audio/02.RescueTeamBase.mp3\",\r\n                {\r\n                    volume: 0.15,\r\n                    loop:true\r\n                }\r\n            );\r\n        music.play();\r\n        const trigger = MeshBuilder.CreateSphere(\"trigger\", {diameter: 15});\r\n        trigger.visibility = 0;\r\n        trigger.position = new Vector3(90,20,-28);\r\n        setTimeout(() => {\r\n            this.scene.registerBeforeRender(() => {\r\n                if(trigger.intersectsMesh(this.Reimu)) {music.stop();this.switchToTransitionCutsceneAya();}\r\n            });\r\n        }, 2000);\r\n\r\n        })();\r\n        return scene;\r\n\r\n    }\r\n\r\n        CreateCamera(scene: Scene): void {\r\n            this.camera = new ArcRotateCamera(\"camera\", Math.PI/2, Math.PI/2, 12, Vector3.Zero(), scene);\r\n            this.camera.attachControl(this.canvas,true);\r\n            this.camera.checkCollisions = true;\r\n            this.camera.angularSensibilityX = 3000;\r\n            this.camera.angularSensibilityY = 3000;\r\n            this.camera.wheelPrecision = 50;\r\n            this.camera.minZ = 0.3;\r\n            this.camera.lowerRadiusLimit = 5;\r\n            this.camera.upperRadiusLimit = 15;\r\n            this.camera.panningSensibility = 0;\r\n        }\r\n    \r\n    \r\n        async CreateReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n            );\r\n            this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(69,1,19);\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched--;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n        }\r\n    \r\n        async CreateMap(): Promise<void> {\r\n            const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n            map.meshes.forEach((mesh) => {\r\n                // Enable collisions for each imported mesh\r\n                mesh.checkCollisions = true;\r\n            });\r\n            \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[2].checkCollisions = true;\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].position._y-=0.2;\r\n        cirno.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(25,0,-78);\r\n        rumia.meshes[2].checkCollisions = true;\r\n        rumia.meshes[0].position._y-=0.2;\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        \r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(90,20,-28);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3*Math.PI/4);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[2].checkCollisions = true;\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), Math.PI);\r\n\r\n        const aya = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"aya.glb\"\r\n        );\r\n        aya.meshes[0].scaling.setAll(0.4);\r\n        aya.meshes[0].position = new Vector3(88,20,-28);\r\n        aya.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        aya.meshes[0].rotate(Vector3.Up(), Math.PI/8);\r\n        aya.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n        \r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToTransitionCutsceneAya() {\r\n        const next = new TransitionCutsceneAya(this.canvas);\r\n        this.engine.stopRenderLoop();\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.scene = next.scene;\r\n    }\r\n}\r\n","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    Sound,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { ThirdHubScene } from \"./ThirdHubScene\";\r\n\r\nexport class TransitionCutsceneNazrinEnd { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Nazrin!: AbstractMesh;\r\n    Doremy!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        this.Doremy = doremy.meshes[0];\r\n        this.Doremy.scaling.setAll(0.4);\r\n        this.Doremy.position = new Vector3(69,0,16);\r\n        this.Doremy.rotate(Vector3.Up(), 3.1);\r\n        this.Doremy.rotate(Vector3.Up(), 5*Math.PI/4);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        this.Nazrin = nazrin.meshes[0];\r\n        this.Nazrin.scaling.setAll(0.4);\r\n        this.Nazrin.position = new Vector3(66,0,18);\r\n        this.Nazrin.rotate(Vector3.Up(), 3.1);\r\n        this.Nazrin.rotate(Vector3.Up(), Math.PI);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(69,0,19);\r\n        this.Reimu.position._z += 0.5;\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/4);\r\n        //this.camera.setTarget(meshes[2]);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(64,2,13), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/16,Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Nazrin: Ow, my head hurts... What happened to me?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Nazrin_sad.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'grey';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        \r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        camkeys.push({frame:0*fps, value:new Vector3(64,2,13)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(64,2,13)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        \r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: You were stuck inside your dream, but Reimu got you out without much casualties.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        this.Nazrin.rotate(Vector3.Up(), Math.PI);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Nazrin: Really? Thank you Reimu. I was so bored of that dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'grey';\r\n        img.src = \"portraits/Nazrin_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: You mean you remember what happened?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Nazrin: Why would I want to live in a world where I own everything? I'm a dowser, not a god!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'grey';\r\n        img.src = \"portraits/Nazrin_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: You can't really control what's happening in your dreams...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Glad it's over at least.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        this.Doremy.rotate(Vector3.Up(), Math.PI/4);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Our work isn't done Reimu. others persons are in danger!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/4);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Fine. Where do we need to go next?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        this.Doremy.rotate(Vector3.Up(), Math.PI);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: On top of this mountain. Someone there is stuck inside a dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n\r\n        camkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(64,2,13)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(70,5,3)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(70,5,3)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(-Math.PI/14,3*Math.PI/4,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/14,3*Math.PI/4,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I really wished we didn't have to go to youkai mountain...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(70,5,3)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(70,5,3)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/14,3*Math.PI/4,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/14,3*Math.PI/4,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Nazrin: You have to save another person? Good luck then!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'grey';\r\n        img.src = \"portraits/Nazrin_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToThirdHubScene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToThirdHubScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        this.scene = new ThirdHubScene(this.canvas).scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    Color3,\r\n    Texture,\r\n    CubeTexture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport * as GUI from '@babylonjs/gui';\r\nimport { TransitionCutsceneNazrinEnd } from \"./TransitionCutsceneNazrinEnd\";\r\n\r\nexport class SecondStageScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n    shooting!: number;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageTwoScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    /* ************************************************************************* */\r\n    //methods for stage two:\r\n\r\n    CreateStageTwoScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        /*scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n          };*/\r\n        \r\n        this.CreateCamera(scene);\r\n        this.camera.position = new Vector3(10,10,0);\r\n        this.CreateStageTwoMap();\r\n\r\n        this.CreateReimuStageTwo();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        leftWall.position = new Vector3(-40,0,-70);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        rightWall.position = new Vector3(-40,0,10);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        backWall.position = new Vector3(-65,0,-35);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        forthWall.position = new Vector3(5,0,-35);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        ceilling.position = new Vector3(-40,45,-35);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        return scene;\r\n\r\n    }\r\n    \r\n    async CreateStageTwoMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_2.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.2);\r\n        nazrin.meshes[0].position = new Vector3(-37,5,-33);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        let health = 30;\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/06.AttheHarborofSpring.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n    const needles = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"needles.glb\"\r\n        );\r\n        const advancedTexture = GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\r\n\r\n        // Create a health bar container\r\n        const healthBarContainer = new GUI.Rectangle();\r\n        healthBarContainer.width = \"170px\";\r\n        healthBarContainer.height = \"20px\";\r\n        healthBarContainer.color = \"white\";\r\n        healthBarContainer.thickness = 2;\r\n        healthBarContainer.background = \"black\";\r\n        healthBarContainer.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\r\n        advancedTexture.addControl(healthBarContainer);\r\n\r\n        // Create the health bar\r\n        const healthBar = new GUI.Rectangle();\r\n        healthBar.width = \"160px\";\r\n        healthBar.height = \"14px\";\r\n        healthBar.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        healthBar.background = \"grey\";\r\n        healthBarContainer.addControl(healthBar);\r\n\r\n        // Update health bar width based on health percentage\r\n        function updateHealthBar(health:number) {\r\n            healthBar.width = `${160 * (health / 100)}px`;\r\n        }\r\nthis.scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0 && this.shooting == 0) {\r\n                    this.engine.enterPointerlock();\r\n                    const x = this.Reimu.position._x;\r\n                    const y = this.Reimu.position._y;\r\n                    const z = this.Reimu.position._z;\r\n                    needles.meshes[0].position._x = x-2;\r\n                    needles.meshes[0].position._y = y;\r\n                    needles.meshes[0].position._z = z;\r\n                }\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n            };\r\n\r\n        needles.meshes[0].scaling.setAll(0.5);\r\n        needles.meshes[0].position = new Vector3(30,200,-20);\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            needles.meshes[0].moveWithCollisions(needles.meshes[0].right.scaleInPlace(0.6));\r\n            if (needles.meshes[2].intersectsMesh(nazrin.meshes[2])) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n                health-=1;\r\n                updateHealthBar(health*100/30);\r\n            } \r\n            map.meshes.forEach((mesh) => {\r\n            if (needles.meshes[2].intersectsMesh(mesh)||needles.meshes[0].position._x<=-38) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n            } \r\n        })\r\n            if(health == 0) {\r\n                health--;\r\n                nazrin.meshes[0].visibility = 0;\r\n                \r\n                const newDiv = document.createElement(\"div\"); \r\n                const newContent = document.createTextNode(\"Boss Defeated\");\r\n                newDiv.appendChild(newContent);\r\n                newDiv.style.position= 'absolute';\r\n                newDiv.style.top= '60%';\r\n                newDiv.style.left= \"50%\";\r\n                newDiv.style.transform= \"translate(-50%, -0%)\";\r\n                newDiv.style.margin= 'auto';\r\n                newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n                newDiv.style.fontSize= '20px';\r\n                newDiv.style.width= '500px';\r\n                newDiv.style.height= '150px';\r\n                newDiv.style.borderRadius= '20px';\r\n                newDiv.style.textAlign= 'center';\r\n                newDiv.style.alignContent= 'center';\r\n                newDiv.style.borderColor= 'red';\r\n                newDiv.style.borderStyle= 'ridge';\r\n                newDiv.style.fontFamily= 'Lucida Console';\r\n                document.body.appendChild(newDiv); \r\n                setTimeout(()=> {\r\n                    document.body.removeChild(newDiv);\r\n                    music.stop();\r\n                    this.switchTransitionCutsceneNazrinEnd();\r\n                }, 3000\r\n                );\r\n            }\r\n    \r\n        });\r\n    }, 2000);\r\n    }\r\n\r\n    async CreateReimuStageTwo(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(-25,5,-33);\r\n        this.Reimu.scaling.setAll(0.2); // Scales the mesh to half its original size\r\n        this.camera.setTarget(meshes[2]);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n\r\n        const flightSpeed = 0.1;\r\n        const soarSpeed = 0.1;\r\n        const focusFlightSpeed = 0.05;\r\n        const rotationSpeed = 0.03;\r\n        const normalAnimSpeed = 5;\r\n        const focusAnimSpeed = 0.5;\r\n\r\n        let speed: number;\r\n        let animSpeed: number;\r\n        let acceleration = 0;\r\n        let soarAcceleration = 0;\r\n        let rotationAcceleration = 0;\r\n\r\n        const keyStatus = {\r\n            z: false,\r\n            s: false,\r\n            q: false,\r\n            d: false,\r\n            c: false,\r\n            v: false, \r\n            Shift: false\r\n        };\r\n\r\n        this.scene.actionManager = new ActionManager(this.scene);\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = true;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = false;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        let moving = false;\r\n        let soaring = false;\r\n        let turning = false;\r\n        let touched = 0;\r\n        this.shooting = 0;\r\n\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n\r\n            if(touched > 0) {\r\n                    touched-=2;\r\n                    this.shooting = (touched >=10)?1:0;\r\n                    this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n            }\r\n        else {\r\n            if(keyStatus.z ||\r\n            keyStatus.s ||\r\n            keyStatus.q ||\r\n            keyStatus.d ||\r\n            keyStatus.c ||\r\n            keyStatus.v) {\r\n                moving = true;\r\n                if(keyStatus.s && !keyStatus.z) {\r\n                    acceleration = Math.max(acceleration-0.005, -flightSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                    speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                    animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                    flightAnim.speedRatio = animSpeed;\r\n                    acceleration = Math.min(acceleration+0.005, speed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                if(keyStatus.q) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.max(rotationAcceleration-0.001, -rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                else if(keyStatus.d) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.min(rotationAcceleration+0.001, rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                if(keyStatus.c) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.min(soarAcceleration+0.005, soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                else if(keyStatus.v) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.max(soarAcceleration-0.005, -soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                flightAnim.start(\r\n                    true, \r\n                    1, \r\n                    flightAnim.from, \r\n                    flightAnim.to, \r\n                    false\r\n                );\r\n            }\r\n            else  {\r\n                if(moving) {\r\n                    idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                    acceleration = 0;\r\n                    flightAnim.stop();\r\n                    moving = false; \r\n                }\r\n            }\r\n            if(!keyStatus.z && !keyStatus.s) {\r\n                if(acceleration > 0) acceleration = Math.max(acceleration-0.005, 0);\r\n                else if(acceleration < 0) acceleration = Math.min(acceleration+0.005, 0);\r\n            }\r\n            if(!keyStatus.q && !keyStatus.d) {\r\n                if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.001, 0);\r\n                if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.001, 0);\r\n\r\n            }\r\n            if(!keyStatus.c && !keyStatus.v) {\r\n                if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.005, 0);\r\n                if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.005, 0);\r\n\r\n            }\r\n        }\r\n        });\r\n\r\n        //creating the bullets of the boss\r\n        \r\n        this.Reimu.checkCollisions = true;\r\n\r\n        const mat = new StandardMaterial(\"mat\");\r\n        mat.diffuseColor = new Color3(1,0.9,0.9);\r\n        const bull = MeshBuilder.CreateSphere(\"bull\");\r\n        bull.position = new Vector3(14,200,-20);\r\n        (bull as AbstractMesh).material = mat;\r\n        const bull2 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull2.position = new Vector3(14,200,-20);\r\n        (bull2 as AbstractMesh).material = mat;\r\n        const bull3 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull3.position = new Vector3(14,200,-20);\r\n        (bull3 as AbstractMesh).material = mat;\r\n        const bull4 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull4.position = new Vector3(14,200,-20);\r\n        (bull4 as AbstractMesh).material = mat;\r\n        const bull5 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull5.position = new Vector3(14,200,-20);\r\n        (bull5 as AbstractMesh).material = mat;\r\n\r\n        const bull10 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull10.position = new Vector3(14,200,-20);\r\n        (bull10 as AbstractMesh).material = mat;\r\n        const bull12 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull12.position = new Vector3(14,200,-20);\r\n        (bull12 as AbstractMesh).material = mat;\r\n        const bull13 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull13.position = new Vector3(14,200,-20);\r\n        (bull13 as AbstractMesh).material = mat;\r\n        const bull14 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull14.position = new Vector3(14,200,-20);\r\n        (bull14 as AbstractMesh).material = mat;\r\n        const bull15 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull15.position = new Vector3(14,200,-20);\r\n        (bull15 as AbstractMesh).material = mat;\r\n\r\n        const bull20 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull20.position = new Vector3(14,200,-20);\r\n        (bull20 as AbstractMesh).material = mat;\r\n        const bull22 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull22.position = new Vector3(14,200,-20);\r\n        (bull22 as AbstractMesh).material = mat;\r\n        const bull23 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull23.position = new Vector3(14,200,-20);\r\n        (bull23 as AbstractMesh).material = mat;\r\n        const bull24 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull24.position = new Vector3(14,200,-20);\r\n        (bull24 as AbstractMesh).material = mat;\r\n        const bull25 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull25.position = new Vector3(14,200,-20);\r\n        (bull25 as AbstractMesh).material = mat;\r\n\r\n        let attackCycle = 298;\r\n        const bulletSpeed = 0.17;\r\n        let direction = this.Reimu.position.subtract(bull.position).normalize();\r\n        let direction2 = this.Reimu.position.subtract(bull.position).normalize();\r\n        let direction3 = this.Reimu.position.subtract(bull.position).normalize();\r\n        \r\n        //checking collisions between player and bullets\r\n\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            if(attackCycle == 0) {\r\n                bull.position = new Vector3(-35,5,-33);\r\n                bull2.position = new Vector3(-35,5,-30);\r\n                bull3.position = new Vector3(-35,5,-28);\r\n                bull4.position = new Vector3(-35,5,-35);\r\n                bull5.position = new Vector3(-35,5,-38);\r\n                direction = this.Reimu.position.subtract(bull.position).normalize();\r\n                attackCycle = 400;\r\n            }\r\n            bull.position.addInPlace(direction.scale(bulletSpeed));\r\n            bull2.position.addInPlace(direction.scale(bulletSpeed));\r\n            bull3.position.addInPlace(direction.scale(bulletSpeed));\r\n            bull4.position.addInPlace(direction.scale(bulletSpeed));\r\n            bull5.position.addInPlace(direction.scale(bulletSpeed));\r\n            \r\n            if(attackCycle == 350) {\r\n                bull10.position = new Vector3(-35,7,-33);\r\n                bull12.position = new Vector3(-35,7,-31);\r\n                bull13.position = new Vector3(-35,6,-29);\r\n                bull14.position = new Vector3(-35,6,-35);\r\n                bull15.position = new Vector3(-35,7,-36);\r\n                direction2 = this.Reimu.position.subtract(bull10.position).normalize();\r\n            }\r\n            bull10.position.addInPlace(direction2.scale(bulletSpeed));\r\n            bull12.position.addInPlace(direction2.scale(bulletSpeed));\r\n            bull13.position.addInPlace(direction2.scale(bulletSpeed));\r\n            bull14.position.addInPlace(direction2.scale(bulletSpeed));\r\n            bull15.position.addInPlace(direction2.scale(bulletSpeed));\r\n\r\n            if(attackCycle == 300) {\r\n                bull20.position = new Vector3(-35,4,-33);\r\n                bull22.position = new Vector3(-35,3,-30);\r\n                bull23.position = new Vector3(-35,4,-28);\r\n                bull24.position = new Vector3(-35,4,-35);\r\n                bull25.position = new Vector3(-35,3,-38);\r\n                direction3 = this.Reimu.position.subtract(bull20.position).normalize();\r\n            }\r\n            bull20.position.addInPlace(direction3.scale(bulletSpeed));\r\n            bull22.position.addInPlace(direction3.scale(bulletSpeed));\r\n            bull23.position.addInPlace(direction3.scale(bulletSpeed));\r\n            bull24.position.addInPlace(direction3.scale(bulletSpeed));\r\n            bull25.position.addInPlace(direction3.scale(bulletSpeed));\r\n\r\n            attackCycle-=2;\r\n            if (meshes[2].intersectsMesh(bull) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull2) && touched == 0) {\r\n                touched = 256;\r\n                bull2.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull3) && touched == 0) {\r\n                touched = 256;\r\n                bull3.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull4) && touched == 0) {\r\n                touched = 256;\r\n                bull4.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull5) && touched == 0) {\r\n                touched = 256;\r\n                bull5.position = new Vector3(14,200,-20);\r\n            }\r\n            if (meshes[2].intersectsMesh(bull10) && touched == 0) {\r\n                touched = 256;\r\n                bull10.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull12) && touched == 0) {\r\n                touched = 256;\r\n                bull12.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull13) && touched == 0) {\r\n                touched = 256;\r\n                bull13.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull14) && touched == 0) {\r\n                touched = 256;\r\n                bull14.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull15) && touched == 0) {\r\n                touched = 256;\r\n                bull15.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull20) && touched == 0) {\r\n                touched = 256;\r\n                bull20.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull22) && touched == 0) {\r\n                touched = 256;\r\n                bull22.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull23) && touched == 0) {\r\n                touched = 256;\r\n                bull23.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull24) && touched == 0) {\r\n                touched = 256;\r\n                bull24.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull25) && touched == 0) {\r\n                touched = 256;\r\n                bull25.position = new Vector3(14,200,-20);\r\n            } \r\n        });\r\n    },500);\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new ArcRotateCamera(\"camera\", 0, Math.PI/2, 12, Vector3.Zero(), scene);\r\n        this.camera.attachControl(this.canvas,true);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.angularSensibilityX = 3000;\r\n        this.camera.angularSensibilityY = 3000;\r\n        this.camera.wheelPrecision = 50;\r\n        this.camera.minZ = 0.3;\r\n        this.camera.lowerRadiusLimit = 5;\r\n        this.camera.upperRadiusLimit = 15;\r\n        this.camera.panningSensibility = 0;\r\n    }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchTransitionCutsceneNazrinEnd() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new TransitionCutsceneNazrinEnd(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { SecondStageScene } from \"./SecondStageScene\";\r\n\r\nexport class SecondStageCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageTwoScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n\r\n        this.CreateCutscene();\r\n    }\r\n\r\n    CreateStageTwoScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n          };\r\n\r\n        const framesPerSecond = 60;\r\n        const gravity = -9.81;\r\n        scene.collisionsEnabled = true;\r\n        scene.enablePhysics(new Vector3(0, gravity/framesPerSecond, 0));\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateStageTwoMap();\r\n\r\n        this.CreateReimuStageTwo();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        leftWall.position = new Vector3(-40,0,-70);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        rightWall.position = new Vector3(-40,0,10);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        backWall.position = new Vector3(-65,0,-35);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        forthWall.position = new Vector3(5,0,-35);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:50});\r\n        ceilling.position = new Vector3(-40,45,-35);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n\r\n        return scene;\r\n\r\n    }\r\n    \r\n    async CreateStageTwoMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_2.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.2);\r\n        nazrin.meshes[0].position = new Vector3(-37,5,-33);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n    }\r\n\r\n    async CreateReimuStageTwo(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(-25,5,-33);\r\n        this.Reimu.scaling.setAll(0.2); // Scales the mesh to half its original size\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    \r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(-23,7,-33), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(Math.PI/4,-Math.PI/2,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n            \r\n            const fps = 60;\r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            let newContent = document.createTextNode(\"Reimu: Okay now, this place is a complete mess! What happened in here?\");\r\n            newDiv.appendChild(newContent);\r\n            \r\n            const imgDiv = document.createElement(\"div\"); \r\n            const img = new Image();\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            imgDiv.appendChild(img);\r\n            img.style.height = \"190px\";\r\n            imgDiv.style.top= '55%';\r\n            imgDiv.style.left= \"19%\";\r\n            imgDiv.style.margin= 'auto';\r\n            imgDiv.style.position= 'absolute';\r\n        \r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'red';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Lucida Console';\r\n            document.body.appendChild(newDiv); \r\n            document.body.appendChild(imgDiv); \r\n    \r\n            let camkeys = [];\r\n            const camAnim = new Animation(\r\n                \"camAnim\", \r\n                \"position\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n    \r\n            let rotkeys = [];\r\n            const rotationAnim = new Animation(\r\n                \"rotationAnim\",\r\n                \"rotation\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/05.Mt.Horn.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            \r\n            camkeys.push({frame:0, value:new Vector3(-23,7,-33)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(-21,9,-33)});\r\n            rotkeys.push({frame:0, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Don't call it a mess! Besides, I didn't ask you for your opinion!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_angry.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(-21,9,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-21,9,-33)});\r\n            rotkeys.push({frame:0, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/8,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: It's a mess, no matter how you look at it! So I will continue calling it a mess!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n\r\n            rotkeys = [];\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/8,-Math.PI/2,0)});\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: You should learn your place in this realm, human.\");\r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0, value:new Vector3(-21,9,-33)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-34,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-34,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: I own all the capital of the world, therefore, the things out of my reach are none. I can show you what I truly mean!\");\r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-34,6,-33)});\r\n            camkeys.push({frame:6*fps, value:new Vector3(-34,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: huh-huh?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: At first, we only had one mine, so we didn't have enough money...\");\r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-34,6,-33)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-32,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-32,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: So I built two others!\");\r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-32,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-32,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: How can you build a mine without gold to extract?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: With money! How else?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Wha-\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: With this much money, it was time to make profit!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_casual.png\";\r\n\r\n            camkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-32,6,-33)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-23,6,-33)});\r\n            camAnim.setKeys(camkeys);\r\n            this.camera.animations.push(camAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Therefore, I bought the lives of all the peasants of this village and built two market places, next to each other.\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-23,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n            rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: That is NOT how you make profi-\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:3*fps, value:new Vector3(-23,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n            rotkeys.push({frame:3*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Then I realized we wouldn't have enough water with only one water mill...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_sad.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-27,12,-18)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-27,12,-18)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/8,-Math.PI/4,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: So I built two others!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-27,12,-18)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-27,12,-18)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Then I had to build war buildings in order to rule the land with authority.\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-27,12,-18)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-29,20,-42)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(-29,20,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: I had to protect my most valuable ressources, so that the peasants wouldn't lay a hand on them!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Nazrin_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-29,20,-42)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-23,15,-42)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(-23,15,-42)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: ... Okay... And what are those mini-surrounded-by-water-hills-of-sand?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-23,15,-42)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-17,5,-33)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(-17,5,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/2,0,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Seaside resorts!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-17,5,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-17,5,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Damn, to think your dream is worse than Cirno's...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Do you now understand the power I hold?\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-17,5,-33)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(-23,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,-Math.PI/2,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Not at all!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            camkeys.push({frame:0*fps, value:new Vector3(-23,6,-33)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(-23,6,-33)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Of course, you are not worthy of my VISION.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Nazrin: Well, it doesn't matter! You will not be able to refuse it anyway.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'grey';\r\n            img.src = \"portraits/Nazrin_happy.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToSecondStageScene();\r\n        }\r\n\r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToSecondStageScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new SecondStageScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { SecondStageCutscene } from \"./SecondStageCutscene\";\r\n\r\nexport class TransitionCutsceneNazrin { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(69,0,16);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 5*Math.PI/4);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(69,0,19);\r\n        this.Reimu.position._z += 0.5;\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/4);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(62,5,18), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/4,Math.PI/2,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: Oh, it's Nazrin. What was she doing here?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        const camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n    const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(62,5,18)});\r\n        camkeys.push({frame:5*fps, value:new Vector3(62,5,18)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: You recognize her, Reimu?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/4);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Yeah, she is a professional dowser, and she can find pretty much any forgotten item.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: A dowser, huh? I wonder what her dream might be...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Yeah, it might be interesting to look at.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Reimu.rotate(Vector3.Up(), Math.PI/4);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Let's not waste anymore time, let's go!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToSecondStageCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    \r\n        switchToSecondStageCutscene() {\r\n            if (this.scene) {\r\n                this.scene.dispose();\r\n            }\r\n            this.engine.stopRenderLoop();\r\n            const next = new SecondStageCutscene(this.canvas).scene;\r\n            this.scene = next;\r\n        }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { TransitionCutsceneNazrin } from \"./TransitionCutsceneNazrin\";\r\n\r\nexport class SecondHubScene {\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        \r\n    }\r\n    \r\n    CreateScene(): Scene {\r\n        this.engine = new Engine(this.canvas, true);\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 2;\r\n\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        this.CreateCamera(scene);\r\n        \r\n        this.CreateMap();\r\n        \r\n        this.CreateReimu();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        leftWall.position = new Vector3(56,50,-143);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n        \r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        rightWall.position = new Vector3(56,50,89);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n        \r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        forthWall.position = new Vector3(181,50,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        backWall.position = new Vector3(-69,50,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n        \r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:300});\r\n        ceilling.position = new Vector3(20,250,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n\r\n        (async () => {\r\n        const music = await CreateSoundAsync(\"music\",\r\n                \"audio/02.RescueTeamBase.mp3\",\r\n                {\r\n                    volume: 0.15,\r\n                    loop:true\r\n                }\r\n            );\r\n        music.play();\r\n        \r\n        const trigger = MeshBuilder.CreateSphere(\"trigger\", {diameter: 15});\r\n        trigger.visibility = 0;\r\n        trigger.position = new Vector3(69,0,16);\r\n        setTimeout(() => {\r\n            this.scene.registerBeforeRender(() => {\r\n                if(trigger.intersectsMesh(this.Reimu)) {music.stop();this.switchToTransitionCutsceneNazrin();}\r\n            });\r\n        }, 2000);\r\n        })();\r\n\r\n        return scene;\r\n\r\n    }\r\n\r\n        CreateCamera(scene: Scene): void {\r\n            this.camera = new ArcRotateCamera(\"camera\", Math.PI/2, Math.PI/2, 12, Vector3.Zero(), scene);\r\n            this.camera.attachControl(this.canvas,true);\r\n            this.camera.checkCollisions = true;\r\n            this.camera.angularSensibilityX = 3000;\r\n            this.camera.angularSensibilityY = 3000;\r\n            this.camera.wheelPrecision = 50;\r\n            this.camera.minZ = 0.3;\r\n            this.camera.lowerRadiusLimit = 5;\r\n            this.camera.upperRadiusLimit = 15;\r\n            this.camera.panningSensibility = 0;\r\n        }\r\n    \r\n    \r\n        async CreateReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n              );\r\n            this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(27,1,-74);\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched--;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n        }\r\n    \r\n        async CreateMap(): Promise<void> {\r\n            const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n            map.meshes.forEach((mesh) => {\r\n                // Enable collisions for each imported mesh\r\n                mesh.checkCollisions = true;\r\n            });\r\n            \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[2].checkCollisions = true;\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].position._y-=0.2;\r\n        cirno.meshes[0].rotate(Vector3.Up(), Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(25,0,-78);\r\n        rumia.meshes[2].checkCollisions = true;\r\n        rumia.meshes[0].position._y-=0.2;\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Up(), -Math.PI/2);\r\n        \r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        doremy.meshes[0].scaling.setAll(0.4);\r\n        doremy.meshes[0].position = new Vector3(69,0,16);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        doremy.meshes[0].rotate(Vector3.Up(), 5*Math.PI/4);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n        \r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToTransitionCutsceneNazrin() {\r\n        const next = new TransitionCutsceneNazrin(this.canvas);\r\n        this.engine.stopRenderLoop();\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.scene = next.scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { SecondHubScene } from \"./SecondHubScene\";\r\n\r\nexport class TransitionCutsceneCirnoEnd { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Rumia!: AbstractMesh;\r\n    Cirno!: AbstractMesh;\r\n    Doremy!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        this.Doremy = doremy.meshes[0];\r\n        this.Doremy.scaling.setAll(0.4);\r\n        this.Doremy.position = new Vector3(27,0,-71);\r\n        this.Doremy.position._y-=0.2;\r\n        this.Doremy.rotate(Vector3.Up(), 3.1);\r\n        this.Doremy.rotate(Vector3.Up(), 5*Math.PI/8);\r\n        \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        this.Cirno = cirno.meshes[0];\r\n        this.Cirno.scaling.setAll(0.4);\r\n        this.Cirno.position = new Vector3(25,0,-75);\r\n        this.Cirno.position._y-=0.2;\r\n        this.Cirno.rotate(Vector3.Up(), 3.1);\r\n        this.Cirno.rotate(Vector3.Up(), -Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        this.Rumia = rumia.meshes[0];\r\n        this.Rumia.scaling.setAll(0.4);\r\n        this.Rumia.position = new Vector3(23,0,-75);\r\n        this.Rumia.position._y-=0.2;\r\n        this.Rumia.rotate(Vector3.Up(), 3.1);\r\n        this.Rumia.rotate(Vector3.Up(), -Math.PI/8);\r\n        \r\n        const nazrin = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"nazrin.glb\"\r\n        );\r\n        nazrin.meshes[0].scaling.setAll(0.4);\r\n        nazrin.meshes[0].position = new Vector3(66,0,18);\r\n        nazrin.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        nazrin.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(27,0,-74);\r\n        this.Reimu.position._y -= 0.2;\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/8);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(22,1,-71), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/16,3*Math.PI/4,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Cirno: Ow... Why is Reimu beating me up even in my dreams?\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Cirno_sad.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'blue';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(22,1,-71)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(22,1,-71)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        \r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: You're awake, Cirno! I'm so happy!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Can we go play now?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Rumia_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Cirno.rotate(Vector3.Up(), -Math.PI/2);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Cirno: Rumia? what do you mean? I was asleep?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'blue';\r\n        img.src = \"portraits/Cirno_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Yeah! And Reimu went in your dream to knock you down to wake you up!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        this.Cirno.rotate(Vector3.Up(),2*Math.PI/3);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Cirno: I don't really get what Rumia said, but thanks for your help Reimu!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'blue';\r\n        img.src = \"portraits/Cirno_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Don't mention it. It was actually a great way for me to unwind.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: And now that it's over, I can FINALLY take a break!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Rumia.rotate(Vector3.Up(), -Math.PI/8);\r\n        this.Reimu.rotate(Vector3.Up(), 4*Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: That, I fear, Reimu, is not possible for now!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(22,1,-71)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(20,1,-72)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(20,1,-72)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,3*Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,3*Math.PI/5,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,3*Math.PI/5,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Is that so?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_surprised.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(20,1,-72)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(20,1,-72)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,3*Math.PI/5,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,3*Math.PI/5,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: And WHY is that so?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Cirno isn't an isolated case, you see, other persons are currently stuck inside of their dreams.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: I-Is that so?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Cirno: But WHY are we stuck inside of our dreams?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'blue';\r\n        img.src = \"portraits/Cirno_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I know what's the reason, but I don't know what's causing this. It could be because of an unknowned influence.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: But even if we don't know what's causing this, we still have to help the persons in danger, Reimu!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        this.Rumia.rotate(Vector3.Left(), Math.PI);\r\n        this.Rumia.position._y += 1.6;\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: そうなのか。(Is that so)?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_reversed.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        this.Rumia.rotate(Vector3.Left(), Math.PI);\r\n        this.Rumia.position._y -= 1.6;\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Fine. It's my job to take care of this after all.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I am able to locate the persons asleep thanks to the wavelengths of their dreams.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: One is located inside that forest. Join me there when you are ready.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n\r\n        camkeys.push({frame:0*fps, value:new Vector3(20,1,-72)});\r\n        camkeys.push({frame:3*fps, value:new Vector3(30,15,-20)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(30,15,-20)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,3*Math.PI/5,0)});\r\n        rotkeys.push({frame:3*fps, value:new Vector3(Math.PI/8,Math.PI/4,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/8,Math.PI/4,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToSecondHubScene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n    \r\n    switchToSecondHubScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        this.scene = new SecondHubScene(this.canvas).scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport * as GUI from '@babylonjs/gui';\r\nimport { TransitionCutsceneCirnoEnd } from \"./TransitionCutsceneCirnoEnd\";\r\n\r\nexport class FirstStageScene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n    shooting!: number;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageOneScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n\r\n    /* ************************************************************************* */\r\n    //methods for stage one:\r\n\r\n\r\n    CreateStageOneScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        /*scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n          };*/\r\n        \r\n        scene.collisionsEnabled = true;\r\n        \r\n        this.CreateCamera(scene);\r\n        this.camera.position = new Vector3(10,10,0);\r\n\r\n        this.CreateReimuStageOne();\r\n\r\n        this.CreateStageOneMap();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        leftWall.position = new Vector3(20,10,-60);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        rightWall.position = new Vector3(20,10,20);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        forthWall.position = new Vector3(60,10,-20);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        backWall.position = new Vector3(-20,10,-20);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ceilling.position = new Vector3(20,50,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        scene.audioEnabled = true;\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateStageOneMap(): Promise<void> {\r\n\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_1.glb\");\r\n        map.meshes.forEach((mesh) => {\r\n            // Enable collisions for each imported mesh\r\n            mesh.checkCollisions = true;\r\n        });\r\n\r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(12,20,-20);\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[2].checkCollisions = true;\r\n        let health = 20;\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/04.TomboyishGirlinLove.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        const needles = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"needles.glb\"\r\n        );\r\n        const advancedTexture = GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\r\n\r\n        // Create a health bar container\r\n        const healthBarContainer = new GUI.Rectangle();\r\n        healthBarContainer.width = \"150px\";\r\n        healthBarContainer.height = \"20px\";\r\n        healthBarContainer.color = \"white\";\r\n        healthBarContainer.thickness = 2;\r\n        healthBarContainer.background = \"black\";\r\n        healthBarContainer.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\r\n        advancedTexture.addControl(healthBarContainer);\r\n\r\n        // Create the health bar\r\n        const healthBar = new GUI.Rectangle();\r\n        healthBar.width = \"140px\";\r\n        healthBar.height = \"14px\";\r\n        healthBar.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        healthBar.background = \"cyan\";\r\n        healthBarContainer.addControl(healthBar);\r\n\r\n        // Update health bar width based on health percentage\r\n        function updateHealthBar(health:number) {\r\n            healthBar.width = `${140 * (health / 100)}px`;\r\n        }\r\n\r\n        this.scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0 && this.shooting == 0) {\r\n                    this.engine.enterPointerlock();\r\n                    const x = this.Reimu.position._x;\r\n                    const y = this.Reimu.position._y;\r\n                    const z = this.Reimu.position._z;\r\n                    needles.meshes[0].position._x = x-2;\r\n                    needles.meshes[0].position._y = y;\r\n                    needles.meshes[0].position._z = z;\r\n                }\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n            };\r\n\r\n        needles.meshes[0].scaling.setAll(0.8);\r\n        needles.meshes[0].position = new Vector3(30,200,-20);\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            needles.meshes[0].moveWithCollisions(needles.meshes[0].right.scaleInPlace(0.6));\r\n            if (needles.meshes[2].intersectsMesh(cirno.meshes[2])) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n                health-=1;\r\n                updateHealthBar(health*100/20);\r\n            } \r\n            map.meshes.forEach((mesh) => {\r\n            if (needles.meshes[2].intersectsMesh(mesh)||needles.meshes[0].position._x<=10) {\r\n                needles.meshes[0].position = new Vector3(30,200,-20);\r\n            } \r\n        })\r\n            if(health == 0) {\r\n                health--;\r\n                cirno.meshes[0].visibility = 0;\r\n                \r\n                const newDiv = document.createElement(\"div\"); \r\n                const newContent = document.createTextNode(\"Boss Defeated\");\r\n                newDiv.appendChild(newContent);\r\n                newDiv.style.position= 'absolute';\r\n                newDiv.style.top= '60%';\r\n                newDiv.style.left= \"50%\";\r\n                newDiv.style.transform= \"translate(-50%, -0%)\";\r\n                newDiv.style.margin= 'auto';\r\n                newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n                newDiv.style.fontSize= '20px';\r\n                newDiv.style.width= '500px';\r\n                newDiv.style.height= '150px';\r\n                newDiv.style.borderRadius= '20px';\r\n                newDiv.style.textAlign= 'center';\r\n                newDiv.style.alignContent= 'center';\r\n                newDiv.style.borderColor= 'red';\r\n                newDiv.style.borderStyle= 'ridge';\r\n                newDiv.style.fontFamily= 'Lucida Console';\r\n                document.body.appendChild(newDiv); \r\n                setTimeout(()=> {\r\n                    document.body.removeChild(newDiv);\r\n                    music.stop();\r\n                    this.switchTransitionCutsceneCirnoEnd();\r\n                }, 3000\r\n                );\r\n            }\r\n    \r\n        });\r\n    }, 2000);\r\n    }\r\n\r\n    async CreateReimuStageOne(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(35,11,-21);\r\n        this.Reimu.scaling.setAll(0.4); // Scales the mesh to half its original size\r\n        this.camera.setTarget(meshes[2]);\r\n        console.log(\"animations\", animationGroups);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n\r\n        const flightSpeed = 0.2;\r\n        const soarSpeed = 0.2;\r\n        const focusFlightSpeed = 0.1;\r\n        const rotationSpeed = 0.05;\r\n        const normalAnimSpeed = 5;\r\n        const focusAnimSpeed = 0.5;\r\n\r\n        let speed: number;\r\n        let animSpeed: number;\r\n        let acceleration = 0;\r\n        let soarAcceleration = 0;\r\n        let rotationAcceleration = 0;\r\n\r\n        const keyStatus = {\r\n            z: false,\r\n            s: false,\r\n            q: false,\r\n            d: false,\r\n            c: false,\r\n            v: false, \r\n            Shift: false\r\n        };\r\n\r\n        this.scene.actionManager = new ActionManager(this.scene);\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = true;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        this.scene.actionManager.registerAction(\r\n            new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n            (event) => {\r\n                let key = event.sourceEvent.key;\r\n                if (key !== \"Shift\") {\r\n                    key = key.toLowerCase();\r\n                }\r\n                if (key in keyStatus) {\r\n                    keyStatus[key as keyof typeof keyStatus] = false;\r\n                }\r\n            }\r\n            )\r\n        );\r\n\r\n        let moving = false;\r\n        let soaring = false;\r\n        let turning = false;\r\n        let touched = 0;\r\n        this.shooting = 0;\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n\r\n            if(touched > 0) {\r\n                    touched-=2;\r\n                    this.shooting = (touched >=10)?1:0;\r\n                    this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n            }\r\n        else {\r\n            if(keyStatus.z ||\r\n            keyStatus.s ||\r\n            keyStatus.q ||\r\n            keyStatus.d ||\r\n            keyStatus.c ||\r\n            keyStatus.v) {\r\n                moving = true;\r\n                if(keyStatus.s && !keyStatus.z) {\r\n                    acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                    speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                    animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                    flightAnim.speedRatio = animSpeed;\r\n                    acceleration = Math.min(acceleration+0.01, speed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                }\r\n                if(keyStatus.q) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                else if(keyStatus.d) {\r\n                    turning = true;\r\n                    rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                    this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                }\r\n                if(keyStatus.c) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                else if(keyStatus.v) {\r\n                    soaring = true;\r\n                    soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                    this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                }\r\n                flightAnim.start(\r\n                    true, \r\n                    1, \r\n                    flightAnim.from, \r\n                    flightAnim.to, \r\n                    false\r\n                );\r\n            }\r\n            else  {\r\n                if(moving) {\r\n                    idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                    acceleration = 0;\r\n                    flightAnim.stop();\r\n                    moving = false; \r\n                }\r\n            }\r\n            if(!keyStatus.z && !keyStatus.s) {\r\n                if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n            }\r\n            if(!keyStatus.q && !keyStatus.d) {\r\n                if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n\r\n            }\r\n            if(!keyStatus.c && !keyStatus.v) {\r\n                if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n\r\n            }\r\n        }\r\n        });\r\n        //creating the bullets of the boss\r\n\r\n        this.Reimu.checkCollisions = true;\r\n        \r\n        const bull = MeshBuilder.CreateSphere(\"bull\");\r\n        bull.position = new Vector3(14,200,-20);\r\n        const bull2 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull2.position = new Vector3(14,200,-20);\r\n        const bull3 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull3.position = new Vector3(14,200,-20);\r\n        const bull4 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull4.position = new Vector3(14,200,-20);\r\n        const bull5 = MeshBuilder.CreateSphere(\"bull\");\r\n        bull5.position = new Vector3(14,200,-20);\r\n\r\n        let attackCycle = 0;\r\n        let direction = this.Reimu.position.subtract(bull.position).normalize();\r\n        let direction2 = this.Reimu.position.subtract(bull2.position).normalize();\r\n        let direction3 = this.Reimu.position.subtract(bull3.position).normalize();\r\n        let direction4 = this.Reimu.position.subtract(bull4.position).normalize();\r\n        let direction5 = this.Reimu.position.subtract(bull5.position).normalize();\r\n        \r\n        //checking collisions between player and bullets\r\n\r\n    setTimeout(() =>{\r\n        this.scene.onBeforeRenderObservable.add(() => {\r\n            if(attackCycle == 0) {\r\n                bull.position = new Vector3(14,20,-20)\r\n                direction = this.Reimu.position.subtract(bull.position).normalize();\r\n                attackCycle = 600;\r\n            }\r\n            bull.position.addInPlace(direction.scale(0.14));\r\n            if(attackCycle == 576) {\r\n                bull2.position = new Vector3(14,20,-20)\r\n                direction2 = this.Reimu.position.subtract(bull2.position).normalize();\r\n            }\r\n            bull2.position.addInPlace(direction2.scale(0.14));\r\n            if(attackCycle == 550) {\r\n                bull3.position = new Vector3(14,20,-20)\r\n                direction3 = this.Reimu.position.subtract(bull3.position).normalize();\r\n            }\r\n            bull3.position.addInPlace(direction3.scale(0.14));\r\n            if(attackCycle == 526) {\r\n                bull4.position = new Vector3(14,20,-20)\r\n                direction4 = this.Reimu.position.subtract(bull4.position).normalize();\r\n            }\r\n            bull4.position.addInPlace(direction4.scale(0.14));\r\n            if(attackCycle == 500) {\r\n                bull5.position = new Vector3(14,20,-20)\r\n                direction5 = this.Reimu.position.subtract(bull5.position).normalize();\r\n            }\r\n            bull5.position.addInPlace(direction5.scale(0.14));\r\n            attackCycle-=2;\r\n            if (meshes[2].intersectsMesh(bull) && touched == 0) {\r\n                touched = 256;\r\n                bull.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull2) && touched == 0) {\r\n                touched = 256;\r\n                bull2.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull3) && touched == 0) {\r\n                touched = 256;\r\n                bull3.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull4) && touched == 0) {\r\n                touched = 256;\r\n                bull4.position = new Vector3(14,200,-20);\r\n            } \r\n            if (meshes[2].intersectsMesh(bull5) && touched == 0) {\r\n                touched = 256;\r\n                bull5.position = new Vector3(14,200,-20);\r\n            }\r\n        });\r\n    }, 2000);\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new ArcRotateCamera(\"camera\", 0, Math.PI/2, 12, Vector3.Zero(), scene);\r\n        this.camera.attachControl(this.canvas,true);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.angularSensibilityX = 3000;\r\n        this.camera.angularSensibilityY = 3000;\r\n        this.camera.wheelPrecision = 50;\r\n        this.camera.minZ = 0.3;\r\n        this.camera.lowerRadiusLimit = 5;\r\n        this.camera.upperRadiusLimit = 15;\r\n        this.camera.panningSensibility = 0;\r\n    }\r\n    \r\n    switchTransitionCutsceneCirnoEnd() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new TransitionCutsceneCirnoEnd(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FirstStageScene } from \"./FirstStageScene\";\r\n\r\nexport class FirstStageCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateStageOneScene();\r\n        this.CreateSkybox();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n\r\n        this.CreateCutscene();\r\n    }\r\n\r\n    CreateStageOneScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 1;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n          };\r\n        \r\n        this.CreateCamera(scene);\r\n\r\n        this.CreateReimuStageOne();\r\n\r\n        this.CreateStageOneMap();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        leftWall.position = new Vector3(20,10,-60);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n\r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        rightWall.position = new Vector3(20,10,20);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n\r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        forthWall.position = new Vector3(60,10,-20);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        backWall.position = new Vector3(-20,10,-20);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n\r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:40});\r\n        ceilling.position = new Vector3(20,50,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateStageOneMap(): Promise<void> {\r\n\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_1.glb\");\r\n\r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(12,20,-20);\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n    }\r\n\r\n    async CreateReimuStageOne(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(30,11,-21);\r\n        this.Reimu.scaling.setAll(0.4); // Scales the mesh to half its original size\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n    \r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(26,13,-19), scene);\r\n        this.camera.checkCollisions = false;\r\n        this.camera.rotation = new Vector3(Math.PI/12,5*Math.PI/8,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n            \r\n            const fps = 60;\r\n    \r\n            const newDiv = document.createElement(\"div\"); \r\n            let newContent = document.createTextNode(\"Reimu: Wow, it's really cold in there, as expected.\");\r\n            newDiv.appendChild(newContent);\r\n            \r\n            const imgDiv = document.createElement(\"div\"); \r\n            const img = new Image();\r\n            img.src = \"portraits/Reimu_surprised.png\";\r\n            imgDiv.appendChild(img);\r\n            img.style.height = \"190px\";\r\n            imgDiv.style.top= '55%';\r\n            imgDiv.style.left= \"19%\";\r\n            imgDiv.style.margin= 'auto';\r\n            imgDiv.style.position= 'absolute';\r\n        \r\n            newDiv.style.position= 'absolute';\r\n            newDiv.style.top= '60%';\r\n            newDiv.style.left= \"50%\";  \r\n            newDiv.style.transform= \"translate(-50%, -0%)\";\r\n            newDiv.style.margin= 'auto';\r\n            newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n            newDiv.style.fontSize= '20px';\r\n            newDiv.style.width= '500px';\r\n            newDiv.style.height= '150px';\r\n            newDiv.style.borderRadius= '20px';\r\n            newDiv.style.textAlign= 'center';\r\n            newDiv.style.alignContent= 'center';\r\n            newDiv.style.borderColor= 'red';\r\n            newDiv.style.borderStyle= 'ridge ';\r\n            newDiv.style.fontFamily= 'Lucida Console';\r\n            document.body.appendChild(newDiv); \r\n            document.body.appendChild(imgDiv); \r\n    \r\n            let camkeys = [];\r\n            const camAnim = new Animation(\r\n                \"camAnim\", \r\n                \"position\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n    \r\n            let rotkeys = [];\r\n            const rotationAnim = new Animation(\r\n                \"rotationAnim\",\r\n                \"rotation\",\r\n                fps,\r\n                Animation.ANIMATIONTYPE_VECTOR3,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n                true\r\n            );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/03.CragsofLament.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n            camkeys.push({frame:0, value:new Vector3(26,13,-19)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(26,13,-19)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            this.camera.animations.push(camAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [Reimu! can you hear me?]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_casual.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Perfectly fine. I have entered Cirno's dream, althought I thought it would be a little more animated in there.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            camkeys = [];\r\n\r\n            camkeys.push({frame:0*fps, value:new Vector3(26,13,-19)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(32,12,-19)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(32,12,-19)});\r\n            rotkeys.push({frame:0, value:new Vector3(Math.PI/12,5*Math.PI/8,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Guess you can't imagine what's inside a fairy's dream.\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(32,12,-19)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(32,12,-19)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: [You now have to find Cirno, she can be anywhere, so stay focused!]\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: Welcome to my lair, human!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'blue';\r\n            img.src = \"portraits/Cirno_casual.png\";\r\n            \r\n            rotkeys = [];\r\n\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:1*fps, value:new Vector3(-Math.PI/16,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,11*Math.PI/8,0)});\r\n\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Yep, found her.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_casual.png\";\r\n            \r\n            rotkeys = [];\r\n\r\n            rotkeys.push({frame:1*fps, value:new Vector3(-Math.PI/16,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,11*Math.PI/8,0)});\r\n\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: I am the STRONGEST here, NO ONE can stand up against me!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'blue';\r\n            img.src = \"portraits/Cirno_casual.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(32,12,-19)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(16,21,-19)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(16,21,-19)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: Even you, a shrine maiden, can only bow down before my-aa-aaah-\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Cirno_happy.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n\r\n            camkeys.push({frame:0*fps, value:new Vector3(16,21,-19)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(16,21,-19)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: ATCHOO!!!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Cirno_surprised.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: ...\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_bored.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n\r\n            camkeys.push({frame:0*fps, value:new Vector3(16,21,-19)});\r\n            camkeys.push({frame:0.5*fps, value:new Vector3(20,15,-38)});\r\n            camkeys.push({frame:2*fps, value:new Vector3(20,15,-38)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,11*Math.PI/8,0)});\r\n            rotkeys.push({frame:0.5*fps, value:new Vector3(0,0,0)});\r\n            rotkeys.push({frame:2*fps, value:new Vector3(0,0,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: How can you sneeze? You're an ICE fairy!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(20,15,-38)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(20,15,-38)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,0,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,0,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: A 'bless you' would have been fine, you know!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'blue';\r\n            img.src = \"portraits/Cirno_angry.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Cirno: If you're not gonna praise me, then I might as well get rid of you!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Cirno_happy.png\";\r\n\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Please Doremy, tell me how I can wake her up!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_angry.png\";\r\n            \r\n            camkeys = [];\r\n            rotkeys = [];\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(20,15,-38)});\r\n            camkeys.push({frame:3*fps, value:new Vector3(24,15,-25)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(24,15,-25)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(0,0,0)});\r\n            rotkeys.push({frame:3*fps, value:new Vector3(Math.PI/7,Math.PI/3,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/7,Math.PI/3,0)});\r\n\r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: If I hear anymore from her, I could really send her dreaming inside her dream!\"); \r\n            newDiv.appendChild(newContent);\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n            \r\n            camkeys.push({frame:0*fps, value:new Vector3(24,15,-25)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(24,15,-25)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/7,Math.PI/3,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(Math.PI/7,Math.PI/3,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: The easiest way would be to cut the link between her and the dreamworld's version of her.\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'purple';\r\n            img.src = \"portraits/Doremy_sad.png\";\r\n            \r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Doremy: Fortunately, you can do that by knocking her out!\"); \r\n            newDiv.appendChild(newContent);\r\n            img.src = \"portraits/Doremy_happy.png\";\r\n\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n            newDiv.removeChild(newContent);\r\n            newContent = document.createTextNode(\"Reimu: Perfect! I'm an expert at this!\"); \r\n            newDiv.appendChild(newContent);\r\n            newDiv.style.borderColor= 'red';\r\n            img.src = \"portraits/Reimu_happy.png\";\r\n\r\n            camkeys = [];\r\n            rotkeys = [];\r\n\r\n            camkeys.push({frame:0*fps, value:new Vector3(24,15,-25)});\r\n            camkeys.push({frame:4*fps, value:new Vector3(35,12,-21)});\r\n            camkeys.push({frame:5*fps, value:new Vector3(35,12,-21)});\r\n            rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/7,Math.PI/3,0)});\r\n            rotkeys.push({frame:4*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            rotkeys.push({frame:5*fps, value:new Vector3(0,-Math.PI/2,0)});\r\n            \r\n            camAnim.setKeys(camkeys);\r\n            rotationAnim.setKeys(rotkeys);\r\n            this.camera.animations.push(camAnim);\r\n            this.camera.animations.push(rotationAnim);\r\n            await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n            \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFirstStageScene();\r\n        }\r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox_d\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n    \r\n    \r\n    switchToFirstStageScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FirstStageScene(this.canvas);\r\n        setTimeout(() => {this.scene = next.scene;}, 200);\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FirstStageCutscene } from \"./FirstStageCutscene\";\r\n\r\nexport class TransitionCutsceneCirno { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    Rumia!: AbstractMesh;\r\n    Doremy!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        \r\n        this.engine.runRenderLoop(()=>{\r\n            if (this.scene.activeCamera) this.scene.render();\r\n        });\r\n        \r\n        this.CreateCutscene();\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n\r\n        this.CreateReimu();\r\n        \r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const doremy = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"doremy.glb\"\r\n        );\r\n        this.Doremy = doremy.meshes[0];\r\n        this.Doremy.scaling.setAll(0.4);\r\n        this.Doremy.position = new Vector3(32,0,-75);\r\n        this.Doremy.position._y-=0.2;\r\n        this.Doremy.rotate(Vector3.Up(), 3.1);\r\n        this.Doremy.rotate(Vector3.Up(), Math.PI);\r\n        \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].rotate(Vector3.Up(), -Math.PI/3);\r\n        cirno.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        this.Rumia = rumia.meshes[0];\r\n        this.Rumia.scaling.setAll(0.4);\r\n        this.Rumia.position = new Vector3(24,0,-76);\r\n        this.Rumia.position._y-=0.2;\r\n        this.Rumia.rotate(Vector3.Up(), 3.1);\r\n        this.Rumia.rotate(Vector3.Up(), -Math.PI/4);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(27,0,-74);\r\n        this.Reimu.position._y -= 0.2;\r\n        this.Reimu.scaling.setAll(0.4); \r\n        this.Reimu.rotate(Vector3.Up(), -Math.PI/8);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(29,1,-77), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/16,-Math.PI/3,0);\r\n        this.camera.speed = 0.5;\r\n        scene.activeCamera = this.camera;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Rumia: Look, Reimu! Cirno has been like that for several days.\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Rumia_angry.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'black';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        music.play();\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(29,1,-77)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(29,1,-77)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I've never seen anything similar before.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Do you think she will wake up?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I don't know. Maybe it's a fairy thing to sleep on mud like this.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(29,1,-77)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(34,1,-77)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(34,1,-77)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-Math.PI/3,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,-2*Math.PI/5,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,-2*Math.PI/5,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"???: No, it isn't. It's actually much more complicated.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(34,1,-77)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(34,1,-77)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-2*Math.PI/5,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,-2*Math.PI/5,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        this.Rumia.rotate(Vector3.Up(), Math.PI/5);\r\n        this.Reimu.rotate(Vector3.Up(), -7*Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Oh, look at this. We have the perfect person for the job.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Who is she?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Her name is Doremy. She has the ability to visit the dreams of anyone.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(34,1,-77)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(30,1,-77)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(30,1,-77)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-2*Math.PI/5,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Your friend here isn't just sleeping like usual.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(30,1,-77)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(30,1,-77)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: But rather, she is stuck inside of her dream!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Really? How is that possible?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Well, you see, dreams are like a big box containing another box containing the thoughts of a person.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: The '3 dimension' interpretation was created 459 years ago to answer a lot of questions about dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,2*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: It was during my 234564th exploration that I first used this interpretation for my observations.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,1*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I remember That persons dream like it was yesterday. He dreamed of falling inside a lake and getting eaten by a giant fish! Can you imagine that?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,1*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I then presented all of my observations to Sagume who then talked about it to Yorihime who then talked about it to Toyohime who used them to create a new device to modify the wavelengths of a dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: They started experimenting on moon rabbits but the wavelength of their dreams were too fragile and they were waking up far too early.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: So we asked help from your rabbit friend from Eientei to stabilise the dream into a 'micro-capsule' state ; that was really impressive to look at. She even said her friend would be used for the experience, and that she agreed to participate!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: However, at first, I wasn't able to enter the dream because Toyo's machine was creating a lot of interference and I was seeing a lot of cryptic messages around me.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: It took so much time to fix that I got the time to remember one of the messages! it stated:\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1010111 1001000 1011001 100000 1000100 1001111 1001110 100111 1010100 100000 1001001 100000 1001101 1001001 1010011 1010011 100000 1011001 1001111 1010101 100000 1000001 100000 1001100 1001111 1010100 100000 1000110 1001111 1010010 1000101 1010110 1000101 1010010 111111\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I asked Toyo about it, and she said that was from a popular rock song popular on earth.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: It could be used in an superior hexagonal to triacontakaienneagonal matrix to find the value of π² with 2 digits to be able to morph a new trinary space in which all of Gensokyo and the moon could fit.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: She then detailled me how we could put the dream inside this new trinary space, but I lost track when the words 'I love peaches' appeared on the screen of the machine.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: When the maintenance finished, I was able to enter the dream and the modification of the wavelengths had an impact on what happened inside the dream.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: It first took place in a commercial advertissement for a 'Lipovitan G energy drink' and then we were moved to a sort of theater where everyone was singing to ask Eirin for help.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: But when I tried to exit, we realised that I couldn't escape because of the modifications we added to the wavelengths, and the path I usually take to travel was endless and a bright light was alternating between two colours permanently.\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Red\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Blue\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Red\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Blue\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: After fixing the wavelengths of the dream, I was able to get out, and we experimented for five days to find out what was happening. The determination of that rabbit was incredible but I think she got a little dizy after the 102th attempt, elle a commencé à parler avec un accent du sud en disant '誰もかつてなかったように、私は最高の存在になりたいです。'\");\r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: And thanks to our researchs we were able to conclude that if the wavelengths of a dream are being alternated by an exterior influence, The dream could become impossible to escape if thelink you have with your dreamworld self isn' broken.\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,0.3*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Was everything clear?\");\r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Doremy_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,3*fps).waitAsync();\r\n        \r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: ...\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(30,1,-77)});\r\n        camkeys.push({frame:1*fps, value:new Vector3(30,1,-75)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(30,1,-75)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n        rotkeys.push({frame:1*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Reimu? Can I eat her?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_bored.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(30,1,-75)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(30,1,-75)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,-Math.PI/2,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Guess I won't get my break today.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: What you need to understand is that the bond between Cirno and her dreamworld self needs to be broken.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(30,1,-77)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(28,1,-82)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(28,1,-82)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(Math.PI/16,0,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,0,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: However, without a dedicated device, we can't achieve this unless we get inside her dream directly.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(28,1,-82)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(28,1,-82)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/16,0,0)});\r\n        rotkeys.push({frame:6*fps, value:new Vector3(Math.PI/16,0,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Couldn't you say that from the beginning?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Then what are you waiting for to jump inside her dream head first?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Unfortunately, I am unable to interfere with one's dream, I am only allowed in as an observer.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: I have to send one of you two inside, and I think you are more fitted for the job, Reimu.\"); \r\n        newDiv.appendChild(newContent);\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,5*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Why was I seeing it coming?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        this.Rumia.rotate(Vector3.Up(),-Math.PI/8);\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Please Reimu, help Cirno get out of her dream!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_sad.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Ok. Ok. I imagine this isn't my day to relax.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Doremy: Get ready, Reimu. I'm sending you straight away!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'purple';\r\n        img.src = \"portraits/Doremy_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I'm ready! get me inside her dream!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFirstStageCutscene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n    \r\n    switchToFirstStageCutscene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FirstStageCutscene(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    ArcRotateCamera,\r\n    AbstractMesh,\r\n    ActionManager,\r\n    ExecuteCodeAction,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { TransitionCutsceneCirno } from \"./TransitionCutsceneCirno\";\r\n\r\nexport class FirstHubScene {\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: ArcRotateCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n        \r\n    }\r\n    \r\n    CreateScene(): Scene {\r\n        this.engine = new Engine(this.canvas, true);\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,0), scene);\r\n        hemiLight.intensity = 2;\r\n\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n\r\n        this.CreateCamera(scene);\r\n        \r\n        this.CreateMap();\r\n        \r\n        this.CreateReimu();\r\n        \r\n        const leftWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        leftWall.position = new Vector3(56,50,-143);\r\n        leftWall.checkCollisions = true;\r\n        leftWall.visibility = 0;\r\n        \r\n        const rightWall = MeshBuilder.CreateBox(\"wall\", {size:100});\r\n        rightWall.position = new Vector3(56,50,89);\r\n        rightWall.checkCollisions = true;\r\n        rightWall.visibility = 0;\r\n        \r\n        const forthWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        forthWall.position = new Vector3(181,50,-30);\r\n        forthWall.checkCollisions = true;\r\n        forthWall.visibility = 0;\r\n        \r\n        const backWall = MeshBuilder.CreateBox(\"wall\", {size:150});\r\n        backWall.position = new Vector3(-69,50,-30);\r\n        backWall.checkCollisions = true;\r\n        backWall.visibility = 0;\r\n        \r\n        const ceilling = MeshBuilder.CreateBox(\"wall\", {size:300});\r\n        ceilling.position = new Vector3(20,250,-20);\r\n        ceilling.checkCollisions = true;\r\n        ceilling.visibility = 0;\r\n        \r\n        \r\n        return scene;\r\n\r\n    }\r\n\r\n        CreateCamera(scene: Scene): void {\r\n            this.camera = new ArcRotateCamera(\"camera\", Math.PI/2, Math.PI/2, 12, Vector3.Zero(), scene);\r\n            this.camera.attachControl(this.canvas,true);\r\n            this.camera.checkCollisions = true;\r\n            this.camera.angularSensibilityX = 3000;\r\n            this.camera.angularSensibilityY = 3000;\r\n            this.camera.wheelPrecision = 50;\r\n            this.camera.minZ = 0.3;\r\n            this.camera.lowerRadiusLimit = 5;\r\n            this.camera.upperRadiusLimit = 15;\r\n            this.camera.panningSensibility = 0;\r\n        }\r\n    \r\n    \r\n        async CreateReimu(): Promise<void> {\r\n            const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n                \"\",\r\n                \"./models/\",\r\n                \"Reimu_animated.glb\"\r\n              );\r\n            this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(86,5,-14);\r\n            this.Reimu.scaling.setAll(0.4);\r\n            this.camera.setTarget(meshes[2]);\r\n            console.log(\"animations\", animationGroups);\r\n            \r\n            const idleAnim = animationGroups[1];\r\n            const flightAnim = animationGroups[0];\r\n            idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n            flightAnim.stop();\r\n    \r\n            const flightSpeed = 0.2;\r\n            const soarSpeed = 0.2;\r\n            const focusFlightSpeed = 0.1;\r\n            const rotationSpeed = 0.05;\r\n            const normalAnimSpeed = 5;\r\n            const focusAnimSpeed = 0.5;\r\n    \r\n            let speed: number;\r\n            let animSpeed: number;\r\n            let acceleration = 0;\r\n            let soarAcceleration = 0;\r\n            let rotationAcceleration = 0;\r\n    \r\n            const keyStatus = {\r\n                z: false,\r\n                s: false,\r\n                q: false,\r\n                d: false,\r\n                c: false,\r\n                v: false, \r\n                Shift: false\r\n            };\r\n    \r\n            this.scene.actionManager = new ActionManager(this.scene);\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyDownTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = true;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            this.scene.actionManager.registerAction(\r\n                new ExecuteCodeAction(ActionManager.OnKeyUpTrigger, \r\n                (event) => {\r\n                    let key = event.sourceEvent.key;\r\n                    if (key !== \"Shift\") {\r\n                        key = key.toLowerCase();\r\n                    }\r\n                    if (key in keyStatus) {\r\n                        keyStatus[key as keyof typeof keyStatus] = false;\r\n                    }\r\n                }\r\n                )\r\n            );\r\n    \r\n            let moving = false;\r\n            let soaring = false;\r\n            let turning = false;\r\n            let touched = 0;\r\n    \r\n            this.scene.onBeforeRenderObservable.add(() => {\r\n    \r\n                if(touched > 0) {\r\n                        touched--;\r\n                        this.Reimu.rotate(Vector3.Forward(), Math.PI/16);\r\n                }\r\n            else {\r\n                if(keyStatus.z ||\r\n                keyStatus.s ||\r\n                keyStatus.q ||\r\n                keyStatus.d ||\r\n                keyStatus.c ||\r\n                keyStatus.v) {\r\n                    moving = true;\r\n                    if(keyStatus.s && !keyStatus.z) {\r\n                        acceleration = Math.max(acceleration-0.01, -flightSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    else if(keyStatus.z || keyStatus.q || keyStatus.d) {\r\n                        speed = !keyStatus.Shift ? flightSpeed : focusFlightSpeed;\r\n                        animSpeed = !keyStatus.Shift ? normalAnimSpeed : focusAnimSpeed;\r\n                        flightAnim.speedRatio = animSpeed;\r\n                        acceleration = Math.min(acceleration+0.01, speed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.right.scaleInPlace(acceleration));\r\n                    }\r\n                    if(keyStatus.q) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.max(rotationAcceleration-0.002, -rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    else if(keyStatus.d) {\r\n                        turning = true;\r\n                        rotationAcceleration = Math.min(rotationAcceleration+0.002, rotationSpeed);\r\n                        this.Reimu.rotate(Vector3.Up(), rotationAcceleration);\r\n                    }\r\n                    if(keyStatus.c) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.min(soarAcceleration+0.01, soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    else if(keyStatus.v) {\r\n                        soaring = true;\r\n                        soarAcceleration = Math.max(soarAcceleration-0.01, -soarSpeed);\r\n                        this.Reimu.moveWithCollisions(this.Reimu.up.scaleInPlace(soarAcceleration));\r\n                    }\r\n                    flightAnim.start(\r\n                        true, \r\n                        1, \r\n                        flightAnim.from, \r\n                        flightAnim.to, \r\n                        false\r\n                    );\r\n                }\r\n                else  {\r\n                    if(moving) {\r\n                        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n                        acceleration = 0;\r\n                        flightAnim.stop();\r\n                        moving = false; \r\n                    }\r\n                }\r\n                if(!keyStatus.z && !keyStatus.s) {\r\n                    if(acceleration > 0) acceleration = Math.max(acceleration-0.01, 0);\r\n                    else if(acceleration < 0) acceleration = Math.min(acceleration+0.01, 0);\r\n                }\r\n                if(!keyStatus.q && !keyStatus.d) {\r\n                    if(rotationAcceleration > 0) rotationAcceleration = Math.max(rotationAcceleration-0.002, 0);\r\n                    if(rotationAcceleration < 0) rotationAcceleration = Math.min(rotationAcceleration+0.002, 0);\r\n    \r\n                }\r\n                if(!keyStatus.c && !keyStatus.v) {\r\n                    if(soarAcceleration > 0) soarAcceleration = Math.max(soarAcceleration-0.01, 0);\r\n                    if(soarAcceleration < 0) soarAcceleration = Math.min(soarAcceleration+0.01, 0);\r\n    \r\n                }\r\n            }\r\n            });\r\n        }\r\n    \r\n        async CreateMap(): Promise<void> {\r\n            const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n            map.meshes.forEach((mesh) => {\r\n                // Enable collisions for each imported mesh\r\n                mesh.checkCollisions = true;\r\n            });\r\n            \r\n        const cirno = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"cirno.glb\"\r\n        );\r\n        cirno.meshes[0].scaling.setAll(0.4);\r\n        cirno.meshes[0].position = new Vector3(25,0,-75);\r\n        cirno.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        cirno.meshes[0].rotate(Vector3.Up(), -Math.PI/3);\r\n        cirno.meshes[0].rotate(Vector3.Forward(), -Math.PI/2);\r\n        \r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(24,0,-76);\r\n        rumia.meshes[0].position._y-=0.2;\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Up(), -Math.PI/4);\r\n        const trigger = MeshBuilder.CreateSphere(\"trigger\", {diameter: 15});\r\n        trigger.visibility = 0;\r\n        trigger.position = new Vector3(24,0,-76);\r\n        const music = await CreateSoundAsync(\"music\",\r\n                \"audio/02.RescueTeamBase.mp3\",\r\n                {\r\n                    volume: 0.15,\r\n                    loop:true\r\n                }\r\n            );\r\n        music.play();\r\n        setTimeout(() => {\r\n            this.scene.registerBeforeRender(() => {\r\n                if(trigger.intersectsMesh(this.Reimu)) {music.stop();this.switchToTransitionCutsceneCirno();}\r\n            });\r\n        }, 2000);\r\n    }\r\n        \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n    \r\n    switchToTransitionCutsceneCirno() {\r\n        const next = new TransitionCutsceneCirno(this.canvas);\r\n        this.engine.stopRenderLoop();\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.scene = next.scene;\r\n    }\r\n}","import{\r\n    Scene, \r\n    Engine, \r\n    FreeCamera,\r\n    Vector3, \r\n    HemisphericLight, \r\n    SceneLoader,\r\n    AbstractMesh,\r\n    MeshBuilder,\r\n    StandardMaterial,\r\n    CubeTexture,\r\n    Texture,\r\n    Animation,\r\n    CreateAudioEngineAsync,\r\n    CreateSoundAsync,\r\n} from \"@babylonjs/core\";\r\nimport \"@babylonjs/loaders\";\r\nimport { FirstHubScene } from \"./FirstHubScene\";\r\n\r\nexport class IntroCutscene { \r\n\r\n    scene: Scene;\r\n    engine: Engine;\r\n    Reimu!: AbstractMesh;\r\n    camera!: FreeCamera;\r\n\r\n    constructor(private canvas:HTMLCanvasElement){\r\n        this.engine = new Engine(this.canvas, true);\r\n        this.scene = this.CreateScene();\r\n        this.CreateSkybox();\r\n        this.engine.setHardwareScalingLevel(1 / window.devicePixelRatio);\r\n\r\n        this.CreateCutscene();\r\n\r\n        this.engine.runRenderLoop(()=>{\r\n            this.scene.render();\r\n        })\r\n\r\n        window.addEventListener(\"resize\", () => {\r\n                this.engine.resize;\r\n        });\r\n    }\r\n\r\n    CreateScene(): Scene {\r\n        this.engine.stopRenderLoop();\r\n        const scene = new Scene(this.engine);\r\n        const hemiLight = new HemisphericLight(\"hemiLight\", new Vector3(0,1,1), scene);\r\n        hemiLight.intensity = 1.5;\r\n\r\n        scene.onPointerDown = (evt) => {\r\n            if (evt.button === 0) this.engine.enterPointerlock();\r\n            if (evt.button === 1) this.engine.exitPointerlock();\r\n        };\r\n        \r\n        this.CreateCamera(scene);\r\n        this.CreateMap();\r\n        this.CreateReimu();\r\n\r\n        return scene;\r\n\r\n    }\r\n\r\n    async CreateMap(): Promise<void> {\r\n        const map = await SceneLoader.ImportMeshAsync(\"\", \"./map/\", \"scene_hub_draft.glb\");\r\n\r\n        const rumia = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"rumia.glb\"\r\n        );\r\n        rumia.meshes[0].scaling.setAll(0.4);\r\n        rumia.meshes[0].position = new Vector3(78,8,-14);\r\n        rumia.meshes[0].rotate(Vector3.Up(), 3.1);\r\n        rumia.meshes[0].rotate(Vector3.Forward(), -Math.PI/16);\r\n    }\r\n\r\n    async CreateReimu(): Promise<void> {\r\n        const { meshes, animationGroups } = await SceneLoader.ImportMeshAsync(\r\n            \"\",\r\n            \"./models/\",\r\n            \"Reimu_animated.glb\"\r\n          );\r\n        this.Reimu = meshes[0];\r\n        this.Reimu.position = new Vector3(86,4,-14);\r\n        this.Reimu.position._z += 0.5;\r\n        this.Reimu.scaling.setAll(0.4); // Scales the mesh to half its original size\r\n        this.Reimu.rotate(Vector3.Forward(), Math.PI/4);\r\n        \r\n        const idleAnim = animationGroups[1];\r\n        const flightAnim = animationGroups[0];\r\n        idleAnim.start(true, 1, idleAnim.from, idleAnim.to, false);\r\n        flightAnim.stop();\r\n    }\r\n\r\n    CreateCamera(scene: Scene): void {\r\n        this.camera = new FreeCamera(\"camera\", new Vector3(83,8,-11), scene);\r\n        this.camera.checkCollisions = true;\r\n        this.camera.rotation = new Vector3(Math.PI/4,5*Math.PI/8,0);\r\n        this.camera.speed = 0.5;\r\n    }\r\n\r\n    async CreateCutscene(): Promise<void>{\r\n        \r\n        const fps = 60;\r\n\r\n        const newDiv = document.createElement(\"div\"); \r\n        let newContent = document.createTextNode(\"Reimu: *sigh* I finally get to relax!\");\r\n        newDiv.appendChild(newContent);\r\n\r\n        const imgDiv = document.createElement(\"div\"); \r\n        const img = new Image();\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        imgDiv.appendChild(img);\r\n        img.style.height = \"190px\";\r\n        imgDiv.style.top= '60%';\r\n        imgDiv.style.left= \"19%\";\r\n        imgDiv.style.margin= 'auto';\r\n        imgDiv.style.position= 'absolute';\r\n    \r\n        newDiv.style.position= 'absolute';\r\n        newDiv.style.top= '60%';\r\n        newDiv.style.left= \"50%\";\r\n        newDiv.style.transform= \"translate(-50%, -0%)\";\r\n        newDiv.style.margin= 'auto';\r\n        newDiv.style.background= 'linear-gradient(rgba(255, 255, 255, 0.93), rgba(135, 135, 135, 0.8))';\r\n        newDiv.style.fontSize= '20px';\r\n        newDiv.style.width= '500px';\r\n        newDiv.style.height= '150px';\r\n        newDiv.style.borderRadius= '20px';\r\n        newDiv.style.textAlign= 'center';\r\n        newDiv.style.alignContent= 'center';\r\n        newDiv.style.borderColor= 'red';\r\n        newDiv.style.borderStyle= 'ridge';\r\n        newDiv.style.fontFamily= 'Lucida Console';\r\n        document.body.appendChild(newDiv); \r\n        document.body.appendChild(imgDiv); \r\n\r\n        let camkeys = [];\r\n        const camAnim = new Animation(\r\n            \"camAnim\", \r\n            \"position\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n\r\n        let rotkeys = [];\r\n        const rotationAnim = new Animation(\r\n            \"rotationAnim\",\r\n            \"rotation\",\r\n            fps,\r\n            Animation.ANIMATIONTYPE_VECTOR3,\r\n            Animation.ANIMATIONLOOPMODE_CONSTANT,\r\n            true\r\n        );\r\n        \r\n        const audioEngine = await CreateAudioEngineAsync();\r\n\r\n        // Create sounds here, but don't call `play()` on them, yet ...\r\n        const music = await CreateSoundAsync(\"music\",\r\n            \"audio/01.RevolvingSecretGarden.mp3\",\r\n            {\r\n                volume: 0.25,\r\n            }\r\n        );\r\n        // Wait until audio engine is ready to play sounds.\r\n        await audioEngine.unlockAsync();\r\n\r\n        // Start sound playback ...\r\n        music.play();\r\n\r\n        camkeys.push({frame:0, value:new Vector3(83,8,-11)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(83,8,-11)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: the recent days have been rough, but I can finally get some slee-\"); \r\n        newDiv.appendChild(newContent);\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(83,8,-11)});\r\n        camkeys.push({frame:6*fps, value:new Vector3(77,12,-11)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,6*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"???: I finally found you, Reimu! I need your help!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_casual.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(77,12,-11)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(77,12,-11)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Well, it was fun while it lasted.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_sad.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(77,12,-11)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(77,12,-11)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        this.camera.animations.push(camAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: what do you want, Rumia?\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n        \r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(77,12,-11)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(81,8,-12)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(81,8,-12)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(Math.PI/4,5*Math.PI/8,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n        \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        this.Reimu.rotate(Vector3.Forward(), -Math.PI/4);\r\n        this.Reimu.position._z += 0.2;\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: I was supposed to play with Cirno today, but she is unable to wake up! Something must have happened to her!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_sad.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(81,8,-12)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(81,8,-12)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n        \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I admit, it's a little concerning. How long has she been asleep?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_surprised.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Three days a least.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_casual.png\";\r\n\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: What?! And you haven't asked for help until now?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_angry.png\";\r\n        \r\n        camkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(81,8,-12)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(87,5,-11)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(87,5,-11)});\r\n        \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: The previous days, we weren't supposed to play.\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_surprised.png\";\r\n        \r\n        camkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(87,5,-11)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(87,5,-11)});\r\n        \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: I shouldn't be surprised with you, and surprisingly, I am!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Can you help me, please?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_sad.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(87,5,-11)});\r\n        camkeys.push({frame:2*fps, value:new Vector3(82,7,-6)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(82,7,-6)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(-Math.PI/16,5*Math.PI/4,0)});\r\n        rotkeys.push({frame:2*fps, value:new Vector3(0,Math.PI,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI,0)});\r\n\r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Reimu: Fine, I will. But next time, ask for help sooner, okay?\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'red';\r\n        img.src = \"portraits/Reimu_bored.png\";\r\n\r\n        camkeys = [];\r\n        rotkeys = [];\r\n        \r\n        camkeys.push({frame:0*fps, value:new Vector3(82,7,-6)});\r\n        camkeys.push({frame:4*fps, value:new Vector3(82,7,-6)});\r\n        rotkeys.push({frame:0*fps, value:new Vector3(0,Math.PI,0)});\r\n        rotkeys.push({frame:4*fps, value:new Vector3(0,Math.PI,0)});\r\n        \r\n        camAnim.setKeys(camkeys);\r\n        rotationAnim.setKeys(rotkeys);\r\n        this.camera.animations.push(camAnim);\r\n        this.camera.animations.push(rotationAnim);\r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: Yay! Thank you, Reimu!\"); \r\n        newDiv.appendChild(newContent);\r\n        newDiv.style.borderColor= 'black';\r\n        img.src = \"portraits/Rumia_happy.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n        \r\n        newDiv.removeChild(newContent);\r\n        newContent = document.createTextNode(\"Rumia: I will wait for you inside the Youkai Forest (on your left) Where Cirno is!\"); \r\n        newDiv.appendChild(newContent);\r\n        img.src = \"portraits/Rumia_casual.png\";\r\n        \r\n        await this.scene.beginAnimation(this.camera,0,4*fps).waitAsync();\r\n\r\n        document.body.removeChild(newDiv);\r\n        document.body.removeChild(imgDiv);\r\n\r\n        music.stop();\r\n        this.switchToFirstHubScene();\r\n    }\r\n    \r\n    CreateSkybox(): void{\r\n        const skybox = MeshBuilder.CreateBox(\"skyBox\", { size: 1000.0 }, this.scene);\r\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this.scene);\r\n        skyboxMaterial.backFaceCulling = false;\r\n        skyboxMaterial.disableLighting = true;\r\n        skybox.material = skyboxMaterial;\r\n        skybox.infiniteDistance = true;\r\n        skyboxMaterial.disableLighting = true;\r\n        skyboxMaterial.reflectionTexture = new CubeTexture(\"textures/skybox\", this.scene);\r\n        skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        skybox.renderingGroupId = 0;\r\n    }\r\n\r\n    switchToFirstHubScene() {\r\n        if (this.scene) {\r\n            this.scene.dispose();\r\n        }\r\n        this.engine.stopRenderLoop();\r\n        const next = new FirstHubScene(this.canvas).scene;\r\n        this.scene = next;\r\n    }\r\n}","import { render } from \"./NemasuProject.vue?vue&type=template&id=5ccc05d3&scoped=true&ts=true\"\nimport script from \"./NemasuProject.vue?vue&type=script&lang=ts\"\nexport * from \"./NemasuProject.vue?vue&type=script&lang=ts\"\n\nimport \"./NemasuProject.vue?vue&type=style&index=0&id=5ccc05d3&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-5ccc05d3\"]])\n\nexport default __exports__","import { render } from \"./App.vue?vue&type=template&id=aa318c32&ts=true\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=aa318c32&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkproj\"] = self[\"webpackChunkproj\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], function() { return __webpack_require__(47340); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["render","_ctx","_cache","$props","$setup","$data","$options","_component_NemasuProject","canvas","this","engine","scene","CreateStageFiveScene","CreateSkybox","runRenderLoop","window","addEventListener","resize","skybox","CreateBox","size","skyboxMaterial","backFaceCulling","disableLighting","material","infiniteDistance","reflectionTexture","coordinatesMode","SKYBOX_MODE","renderingGroupId","stopRenderLoop","hemiLight","intensity","onPointerDown","evt","button","enterPointerlock","exitPointerlock","CreateCamera","ground","CreateGround","scaling","checkCollisions","texture","mat","diffuseTexture","speed","fireColors","CreateStageFiveReimu","CreateStageFiveMap","newDiv","document","createElement","newContent","createTextNode","appendChild","style","position","top","left","transform","margin","background","fontSize","width","height","borderRadius","textAlign","alignContent","borderColor","borderStyle","fontFamily","body","camera","rotation","Math","PI","Promise","ImportMeshAsync","sumireko","Sumireko","meshes","setAll","rotate","Up","volume","music","play","animationGroups","Reimu","_z","console","log","idleAnim","flightAnim","start","from","to","stop","leftWall","visibility","rightWall","backWall","forthWall","ceilling","updateHealthBar","health","healthBar","needles","advancedTexture","CreateFullscreenUI","healthBarContainer","color","thickness","verticalAlignment","VERTICAL_ALIGNMENT_TOP","addControl","horizontalAlignment","HORIZONTAL_ALIGNMENT_LEFT","shooting","x","_x","y","_y","z","setTimeout","onBeforeRenderObservable","add","moveWithCollisions","right","scaleInPlace","intersectsMesh","removeChild","switchToEndingScene","setTarget","flightSpeed","soarSpeed","focusFlightSpeed","rotationSpeed","normalAnimSpeed","focusAnimSpeed","acceleration","soarAcceleration","rotationAcceleration","keyStatus","s","q","d","c","v","Shift","actionManager","registerAction","OnKeyDownTrigger","event","key","sourceEvent","toLowerCase","OnKeyUpTrigger","moving","touched","Forward","max","animSpeed","speedRatio","min","up","Rmat","diffuseColor","Bmat","Pmat","bullR","CreateSphere","bullB","bull","random","bull1","bull2","bull3","bull4","bull5","bull6","bull7","bull8","bull9","bull10","directionR","subtract","normalize","directionB","accelR","modR","speedB","speedP","boss","drag","directionP","direction","direction1","direction2","direction3","direction4","direction5","direction6","direction7","direction8","direction9","direction10","abs","addInPlace","scale","Distance","Zero","attachControl","angularSensibilityX","angularSensibilityY","wheelPrecision","minZ","lowerRadiusLimit","upperRadiusLimit","panningSensibility","dispose","next","EndingScene","CreateCutscene","fps","imgDiv","img","Image","src","camkeys","camAnim","ANIMATIONTYPE_VECTOR3","ANIMATIONLOOPMODE_CONSTANT","rotkeys","rotationAnim","push","frame","value","setKeys","animations","beginAnimation","waitAsync","switchToFifthStageScene","FifthStageScene","CreateScene","setHardwareScalingLevel","devicePixelRatio","CreateMap","CreateReimu","doremy","sanae","switchToFifthStageCutscene","FifthStageCutscene","framesPerSecond","gravity","collisionsEnabled","enablePhysics","loop","trigger","diameter","registerBeforeRender","switchToTransitionCutsceneSumireko","map","forEach","mesh","cirno","rumia","nazrin","aya","TransitionCutsceneSumireko","Sanae","SwitchSkybox","switchToFifthHubScene","FifthHubScene","CreateStageFourScene","CreateStageFourMap","CreateReimuStageFour","switchTransitionCutsceneSanaeEnd","bull11","bull12","bull13","bull21","bull22","bull31","attackCycle","bulletSpeed","accel","accel1","accel2","accel3","direction11","direction12","direction13","direction21","direction22","direction31","TransitionCutsceneSanaeEnd","switchToFourthStageScene","FourthStageScene","switchToFourthStageCutscene","FourthStageCutscene","switchToTransitionCutsceneSanae","TransitionCutsceneSanae","Aya","switchToFourthHubScene","FourthHubScene","CreateStageThreeScene","CreateStageThreeMap","CreateReimuStageThree","switchTransitionCutsceneAyaEnd","matR","matG","matB","bull20","bull23","bull24","bull25","bull26","bull27","bull28","bull29","bull210","bull211","bull30","bull32","bull33","bull34","bull35","bull36","bull37","bull38","bull39","bull310","bull311","Rcycle","Gcycle","Bcycle","Rspeed","Gspeed","Bspeed","Rdirection","Gdirection","Bdirection","TransitionCutsceneAyaEnd","switchToThirdStageScene","ThirdStageScene","switchToThirdStageCutscene","ThirdStageCutscene","switchToTransitionCutsceneAya","TransitionCutsceneAya","Doremy","Nazrin","switchToThirdHubScene","ThirdHubScene","CreateStageTwoScene","CreateStageTwoMap","CreateReimuStageTwo","switchTransitionCutsceneNazrinEnd","bull14","bull15","TransitionCutsceneNazrinEnd","switchToSecondStageScene","SecondStageScene","switchToSecondStageCutscene","SecondStageCutscene","switchToTransitionCutsceneNazrin","TransitionCutsceneNazrin","Cirno","Rumia","Left","switchToSecondHubScene","SecondHubScene","CreateStageOneScene","CreateReimuStageOne","CreateStageOneMap","audioEnabled","switchTransitionCutsceneCirnoEnd","TransitionCutsceneCirnoEnd","switchToFirstStageScene","FirstStageScene","activeCamera","switchToFirstStageCutscene","FirstStageCutscene","switchToTransitionCutsceneCirno","TransitionCutsceneCirno","audioEngine","unlockAsync","switchToFirstHubScene","FirstHubScene","name","mounted","querySelector","IntroCutscene","__exports__","components","NemasuProject","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","deferred","O","result","chunkIds","fn","priority","notFulfilled","Infinity","i","length","fulfilled","j","Object","keys","every","splice","r","definition","o","defineProperty","enumerable","get","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","some","id","chunkLoadingGlobal","self","bind","__webpack_exports__"],"sourceRoot":""}